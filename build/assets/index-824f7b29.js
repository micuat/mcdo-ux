(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const f of s)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function r(s){const f={};return s.integrity&&(f.integrity=s.integrity),s.referrerPolicy&&(f.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?f.credentials="include":s.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(s){if(s.ep)return;s.ep=!0;const f=r(s);fetch(s.href,f)}})();const style="";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function o(){if(this instanceof o){var s=[null];s.push.apply(s,arguments);var f=Function.bind.apply(t,s);return new f}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(o){var s=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(r,o,s.get?s:{enumerable:!0,get:function(){return e[o]}})}),r}var scrollToAnchor_1=scrollToAnchor$1;function scrollToAnchor$1(e,t){if(e)try{var r=document.querySelector(e);r&&r.scrollIntoView(t)}catch{}}var documentReady$1=ready;function ready(e){if(typeof document>"u")throw new Error("document-ready only runs in the browser");var t=document.readyState;if(t==="complete"||t==="interactive")return setTimeout(e,0);document.addEventListener("DOMContentLoaded",function(){e()})}assert$e.notEqual=notEqual;assert$e.notOk=notOk;assert$e.equal=equal;assert$e.ok=assert$e;var nanoassert$1=assert$e;function equal(e,t,r){assert$e(e==t,r)}function notEqual(e,t,r){assert$e(e!=t,r)}function notOk(e,t){assert$e(!e,t)}function assert$e(e,t){if(!e)throw new Error(t||"AssertionError")}var assert$d=nanoassert$1,hasWindow=typeof window<"u";function createScheduler(){var e;return hasWindow?(window._nanoScheduler||(window._nanoScheduler=new NanoScheduler(!0)),e=window._nanoScheduler):e=new NanoScheduler,e}function NanoScheduler(e){this.hasWindow=e,this.hasIdle=this.hasWindow&&window.requestIdleCallback,this.method=this.hasIdle?window.requestIdleCallback.bind(window):this.setTimeout,this.scheduled=!1,this.queue=[]}NanoScheduler.prototype.push=function(e){assert$d.equal(typeof e,"function","nanoscheduler.push: cb should be type function"),this.queue.push(e),this.schedule()};NanoScheduler.prototype.schedule=function(){if(!this.scheduled){this.scheduled=!0;var e=this;this.method(function(t){for(var r;e.queue.length&&t.timeRemaining()>0;)r=e.queue.shift(),r(t);e.scheduled=!1,e.queue.length&&e.schedule()})}};NanoScheduler.prototype.setTimeout=function(e){setTimeout(e,0,{timeRemaining:function(){return 1}})};var nanoscheduler=createScheduler,scheduler=nanoscheduler(),assert$c=nanoassert$1,perf;nanotiming$3.disabled=!0;try{perf=window.performance,nanotiming$3.disabled=window.localStorage.DISABLE_NANOTIMING==="true"||!perf.mark}catch{}var browser$3=nanotiming$3;function nanotiming$3(e){if(assert$c.equal(typeof e,"string","nanotiming: name should be type string"),nanotiming$3.disabled)return noop;var t=(perf.now()*1e4).toFixed()%Number.MAX_SAFE_INTEGER,r="start-"+t+"-"+e;perf.mark(r);function o(s){var f="end-"+t+"-"+e;perf.mark(f),scheduler.push(function(){var g=null;try{var S=e+" ["+t+"]";perf.measure(S,r,f),perf.clearMarks(r),perf.clearMarks(f)}catch(P){g=P}s&&s(g,e)})}return o.uuid=t,o}function noop(e){e&&scheduler.push(function(){e(new Error("nanotiming: performance API unavailable"))})}var assert$b=nanoassert$1,trie$1=Trie;function Trie(){if(!(this instanceof Trie))return new Trie;this.trie={nodes:{}}}Trie.prototype.create=function(e){assert$b.equal(typeof e,"string","route should be a string");var t=e.replace(/^\//,"").split("/");function r(o,s){var f=has(t,o)&&t[o];if(f===!1)return s;var g=null;return/^:|^\*/.test(f)?(has(s.nodes,"$$")?g=s.nodes.$$:(g={nodes:{}},s.nodes.$$=g),f[0]==="*"&&(s.wildcard=!0),s.name=f.replace(/^:|^\*/,"")):has(s.nodes,f)?g=s.nodes[f]:(g={nodes:{}},s.nodes[f]=g),r(o+1,g)}return r(0,this.trie)};Trie.prototype.match=function(e){assert$b.equal(typeof e,"string","route should be a string");var t=e.replace(/^\//,"").split("/"),r={};function o(f,g){if(g!==void 0){var S=t[f];if(S===void 0)return g;if(has(g.nodes,S))return o(f+1,g.nodes[S]);if(g.name){try{r[g.name]=decodeURIComponent(S)}catch{return o(f,void 0)}return o(f+1,g.nodes.$$)}else if(g.wildcard){try{r.wildcard=decodeURIComponent(t.slice(f).join("/"))}catch{return o(f,void 0)}return g.nodes.$$}else return o(f+1)}}var s=o(0,this.trie);if(s)return s=Object.assign({},s),s.params=r,s};Trie.prototype.mount=function(e,t){assert$b.equal(typeof e,"string","route should be a string"),assert$b.equal(typeof t,"object","trie should be a object");var r=e.replace(/^\//,"").split("/"),o=null,s=null;if(r.length===1)s=r[0],o=this.create(s);else{var f=r.join("/");s=r[0],o=this.create(f)}Object.assign(o.nodes,t.nodes),t.name&&(o.name=t.name),o.nodes[""]&&(Object.keys(o.nodes[""]).forEach(function(g){g!=="nodes"&&(o[g]=o.nodes[""][g])}),Object.assign(o.nodes,o.nodes[""].nodes),delete o.nodes[""].nodes)};function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var assert$a=nanoassert$1,trie=trie$1,wayfarer$1=Wayfarer;function Wayfarer(e){if(!(this instanceof Wayfarer))return new Wayfarer(e);var t=(e||"").replace(/^\//,""),r=trie();return s._trie=r,s.on=o,s.emit=s,s.match=f,s._wayfarer=!0,s;function o(S,P){if(assert$a.equal(typeof S,"string"),assert$a.equal(typeof P,"function"),S=S||"/",P._wayfarer&&P._trie)r.mount(S,P._trie.trie);else{var G=r.create(S);G.cb=P,G.route=S}return s}function s(S){var P=f(S),G=new Array(arguments.length);G[0]=P.params;for(var le=1;le<G.length;le++)G[le]=arguments[le];return P.cb.apply(P.cb,G)}function f(S){assert$a.notEqual(S,void 0,"'route' must be defined");var P=r.match(S);if(P&&P.cb)return new g(P);var G=r.match(t);if(G&&G.cb)return new g(G);throw new Error("route '"+S+"' did not match")}function g(S){this.cb=S.cb,this.route=S.route,this.params=S.params}}var assert$9=nanoassert$1,wayfarer=wayfarer$1,isLocalFile=/file:\/\//.test(typeof window=="object"&&window.location&&window.location.origin),electron="^(file://|/)(.*.html?/?)?",protocol="^(http(s)?(://))?(www.)?",domain="[a-zA-Z0-9-_.]+(:[0-9]{1,5})?(/{1})?",qs$1="[?].*$",stripElectron=new RegExp(electron),prefix$1=new RegExp(protocol+domain),normalize=new RegExp("#"),suffix$1=new RegExp(qs$1),nanorouter$1=Nanorouter;function Nanorouter(e){if(!(this instanceof Nanorouter))return new Nanorouter(e);e=e||{},this.router=wayfarer(e.default||"/404")}Nanorouter.prototype.on=function(e,t){assert$9.equal(typeof e,"string"),e=e.replace(/^[#/]/,""),this.router.on(e,t)};Nanorouter.prototype.emit=function(e){return assert$9.equal(typeof e,"string"),e=pathname(e,isLocalFile),this.router.emit(e)};Nanorouter.prototype.match=function(e){return assert$9.equal(typeof e,"string"),e=pathname(e,isLocalFile),this.router.match(e)};function pathname(e,t){return t?e=e.replace(stripElectron,""):e=e.replace(prefix$1,""),decodeURI(e.replace(suffix$1,"").replace(normalize,"/"))}var events$2=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","onanimationend","onanimationiteration","onanimationstart","oncontextmenu","onfocusin","onfocusout"],events$1=events$2,eventsLength=events$1.length,ELEMENT_NODE=1,TEXT_NODE$1=3,COMMENT_NODE=8,morph_1=morph$2;function morph$2(e,t){var r=e.nodeType,o=e.nodeName;r===ELEMENT_NODE&&copyAttrs(e,t),(r===TEXT_NODE$1||r===COMMENT_NODE)&&t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),o==="INPUT"?updateInput(e,t):o==="OPTION"?updateOption(e,t):o==="TEXTAREA"&&updateTextarea(e,t),copyEvents(e,t)}function copyAttrs(e,t){for(var r=t.attributes,o=e.attributes,s=null,f=null,g=null,S=null,P=null,G=o.length-1;G>=0;--G)P=o[G],S=P.name,s=P.namespaceURI,f=P.value,s?(S=P.localName||S,g=t.getAttributeNS(s,S),g!==f&&t.setAttributeNS(s,S,f)):t.hasAttribute(S)?(g=t.getAttribute(S),g!==f&&(f==="null"||f==="undefined"?t.removeAttribute(S):t.setAttribute(S,f))):t.setAttribute(S,f);for(var le=r.length-1;le>=0;--le)P=r[le],P.specified!==!1&&(S=P.name,s=P.namespaceURI,s?(S=P.localName||S,e.hasAttributeNS(s,S)||t.removeAttributeNS(s,S)):e.hasAttributeNS(null,S)||t.removeAttribute(S))}function copyEvents(e,t){for(var r=0;r<eventsLength;r++){var o=events$1[r];e[o]?t[o]=e[o]:t[o]&&(t[o]=void 0)}}function updateOption(e,t){updateAttribute(e,t,"selected")}function updateInput(e,t){var r=e.value,o=t.value;updateAttribute(e,t,"checked"),updateAttribute(e,t,"disabled"),e.indeterminate!==t.indeterminate&&(t.indeterminate=e.indeterminate),t.type!=="file"&&(r!==o&&(t.setAttribute("value",r),t.value=r),r==="null"&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?t.type==="range"&&(t.value=r):t.removeAttribute("value"))}function updateTextarea(e,t){var r=e.value;if(r!==t.value&&(t.value=r),t.firstChild&&t.firstChild.nodeValue!==r){if(r===""&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=r}}function updateAttribute(e,t,r){e[r]!==t[r]&&(t[r]=e[r],e[r]?t.setAttribute(r,""):t.removeAttribute(r))}var assert$8=nanoassert$1,morph$1=morph_1,TEXT_NODE=3,nanomorph_1=nanomorph$1;function nanomorph$1(e,t,r){return assert$8.equal(typeof e,"object","nanomorph: oldTree should be an object"),assert$8.equal(typeof t,"object","nanomorph: newTree should be an object"),r&&r.childrenOnly?(updateChildren(t,e),e):(assert$8.notEqual(t.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),walk(t,e))}function walk(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||getComponentId(e)!==getComponentId(t)?e:(morph$1(e,t),updateChildren(e,t),t):null:e}function getComponentId(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function updateChildren(e,t){for(var r,o,s,f,g=0,S=0;r=t.childNodes[S],o=e.childNodes[S-g],!(!r&&!o);S++)if(!o)t.removeChild(r),S--;else if(!r)t.appendChild(o),g++;else if(same(o,r))s=walk(o,r),s!==r&&(t.replaceChild(s,r),g++);else{f=null;for(var P=S;P<t.childNodes.length;P++)if(same(t.childNodes[P],o)){f=t.childNodes[P];break}f?(s=walk(o,f),s!==f&&g++,t.insertBefore(s,r)):!o.id&&!r.id?(s=walk(o,r),s!==r&&(t.replaceChild(s,r),g++)):(t.insertBefore(o,r),g++)}}function same(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName!==t.tagName?!1:e.type===TEXT_NODE?e.nodeValue===t.nodeValue:!1}var reg=/([^?=&]+)(=([^&]*))?/g,assert$7=nanoassert$1,browser$2=qs;function qs(e){assert$7.equal(typeof e,"string","nanoquery: url should be type string");var t={};return e.replace(/^.*\?/,"").replace(reg,function(r,o,s,f){var g=decodeURIComponent(f),S=decodeURIComponent(o);t.hasOwnProperty(S)?Array.isArray(t[S])?t[S].push(g):t[S]=[t[S],g]:t[S]=g}),t}var assert$6=nanoassert$1,safeExternalLink=/(noopener|noreferrer) (noopener|noreferrer)/,protocolLink=/^[\w-_]+:/,nanohref$1=href;function href(e,t){assert$6.notEqual(typeof window,"undefined","nanohref: expected window to exist"),t=t||window.document,assert$6.equal(typeof e,"function","nanohref: cb should be type function"),assert$6.equal(typeof t,"object","nanohref: root should be type object"),window.addEventListener("click",function(r){if(!(r.button&&r.button!==0||r.ctrlKey||r.metaKey||r.altKey||r.shiftKey||r.defaultPrevented)){var o=function s(f){if(!(!f||f===t))return f.localName!=="a"||f.href===void 0?s(f.parentNode):f}(r.target);o&&(window.location.protocol!==o.protocol||window.location.hostname!==o.hostname||window.location.port!==o.port||o.hasAttribute("data-nanohref-ignore")||o.hasAttribute("download")||o.getAttribute("target")==="_blank"&&safeExternalLink.test(o.getAttribute("rel"))||protocolLink.test(o.getAttribute("href"))||(r.preventDefault(),e(o)))}})}var assert$5=nanoassert$1,nanoraf_1=nanoraf$1;function nanoraf$1(e,t){assert$5.equal(typeof e,"function","nanoraf: render should be a function"),assert$5.ok(typeof t=="function"||typeof t>"u","nanoraf: raf should be a function or undefined"),t||(t=window.requestAnimationFrame);var r=!1,o=null;return function(){o===null&&!r&&(r=!0,t(function(){r=!1;for(var g=o.length,S=new Array(g),P=0;P<g;P++)S[P]=o[P];e.apply(e,S),o=null})),o=arguments}}var removeArrayItems=function(t,r,o){var s,f=t.length;if(!(r>=f||o===0)){o=r+o>f?f-r:o;var g=f-o;for(s=r;s<g;++s)t[s]=t[s+o];t.length=g}},splice=removeArrayItems,nanotiming$2=browser$3,assert$4=nanoassert$1,nanobus$1=Nanobus;function Nanobus(e){if(!(this instanceof Nanobus))return new Nanobus(e);this._name=e||"nanobus",this._starListeners=[],this._listeners={}}Nanobus.prototype.emit=function(e){assert$4.ok(typeof e=="string"||typeof e=="symbol","nanobus.emit: eventName should be type string or symbol");for(var t=[],r=1,o=arguments.length;r<o;r++)t.push(arguments[r]);var s=nanotiming$2(this._name+"('"+e.toString()+"')"),f=this._listeners[e];return f&&f.length>0&&this._emit(this._listeners[e],t),this._starListeners.length>0&&this._emit(this._starListeners,e,t,s.uuid),s(),this};Nanobus.prototype.on=Nanobus.prototype.addListener=function(e,t){return assert$4.ok(typeof e=="string"||typeof e=="symbol","nanobus.on: eventName should be type string or symbol"),assert$4.equal(typeof t,"function","nanobus.on: listener should be type function"),e==="*"?this._starListeners.push(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)),this};Nanobus.prototype.prependListener=function(e,t){return assert$4.ok(typeof e=="string"||typeof e=="symbol","nanobus.prependListener: eventName should be type string or symbol"),assert$4.equal(typeof t,"function","nanobus.prependListener: listener should be type function"),e==="*"?this._starListeners.unshift(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].unshift(t)),this};Nanobus.prototype.once=function(e,t){assert$4.ok(typeof e=="string"||typeof e=="symbol","nanobus.once: eventName should be type string or symbol"),assert$4.equal(typeof t,"function","nanobus.once: listener should be type function");var r=this;this.on(e,o);function o(){t.apply(r,arguments),r.removeListener(e,o)}return this};Nanobus.prototype.prependOnceListener=function(e,t){assert$4.ok(typeof e=="string"||typeof e=="symbol","nanobus.prependOnceListener: eventName should be type string or symbol"),assert$4.equal(typeof t,"function","nanobus.prependOnceListener: listener should be type function");var r=this;this.prependListener(e,o);function o(){t.apply(r,arguments),r.removeListener(e,o)}return this};Nanobus.prototype.removeListener=function(e,t){if(assert$4.ok(typeof e=="string"||typeof e=="symbol","nanobus.removeListener: eventName should be type string or symbol"),assert$4.equal(typeof t,"function","nanobus.removeListener: listener should be type function"),e==="*")return this._starListeners=this._starListeners.slice(),r(this._starListeners,t);return typeof this._listeners[e]<"u"&&(this._listeners[e]=this._listeners[e].slice()),r(this._listeners[e],t);function r(o,s){if(o){var f=o.indexOf(s);if(f!==-1)return splice(o,f,1),!0}}};Nanobus.prototype.removeAllListeners=function(e){return e?e==="*"?this._starListeners=[]:this._listeners[e]=[]:(this._starListeners=[],this._listeners={}),this};Nanobus.prototype.listeners=function(e){var t=e!=="*"?this._listeners[e]:this._starListeners,r=[];if(t)for(var o=t.length,s=0;s<o;s++)r.push(t[s]);return r};Nanobus.prototype._emit=function(e,t,r,o){if(!(typeof e>"u")&&e.length!==0){r===void 0&&(r=t,t=null),t&&(o!==void 0?r=[t].concat(r,o):r=[t].concat(r));for(var s=e.length,f=0;f<s;f++){var g=e[f];g.apply(g,r)}}};var nanolru=LRU$1;function LRU$1(e){if(!(this instanceof LRU$1))return new LRU$1(e);typeof e=="number"&&(e={max:e}),e||(e={}),this.cache={},this.head=this.tail=null,this.length=0,this.max=e.max||1e3,this.maxAge=e.maxAge||0}Object.defineProperty(LRU$1.prototype,"keys",{get:function(){return Object.keys(this.cache)}});LRU$1.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0};LRU$1.prototype.remove=function(e){if(typeof e!="string"&&(e=""+e),!!this.cache.hasOwnProperty(e)){var t=this.cache[e];return delete this.cache[e],this._unlink(e,t.prev,t.next),t.value}};LRU$1.prototype._unlink=function(e,t,r){this.length--,this.length===0?this.head=this.tail=null:this.head===e?(this.head=t,this.cache[this.head].next=null):this.tail===e?(this.tail=r,this.cache[this.tail].prev=null):(this.cache[t].next=r,this.cache[r].prev=t)};LRU$1.prototype.peek=function(e){if(this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return t.value}};LRU$1.prototype.set=function(e,t){typeof e!="string"&&(e=""+e);var r;if(this.cache.hasOwnProperty(e)){if(r=this.cache[e],r.value=t,this.maxAge&&(r.modified=Date.now()),e===this.head)return t;this._unlink(e,r.prev,r.next)}else r={value:t,modified:0,next:null,prev:null},this.maxAge&&(r.modified=Date.now()),this.cache[e]=r,this.length===this.max&&this.evict();return this.length++,r.next=null,r.prev=this.head,this.head&&(this.cache[this.head].next=e),this.head=e,this.tail||(this.tail=e),t};LRU$1.prototype._checkAge=function(e,t){return this.maxAge&&Date.now()-t.modified>this.maxAge?(this.remove(e),!1):!0};LRU$1.prototype.get=function(e){if(typeof e!="string"&&(e=""+e),!!this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return this.head!==e&&(e===this.tail?(this.tail=t.next,this.cache[this.tail].prev=null):this.cache[t.prev].next=t.next,this.cache[t.next].prev=t.prev,this.cache[this.head].next=e,t.prev=this.head,t.next=null,this.head=e),t.value}};LRU$1.prototype.evict=function(){this.tail&&this.remove(this.tail)};var assert$3=nanoassert$1,LRU=nanolru,cache=ChooComponentCache;function ChooComponentCache(e,t,r){assert$3.ok(this instanceof ChooComponentCache,"ChooComponentCache should be created with `new`"),assert$3.equal(typeof e,"object","ChooComponentCache: state should be type object"),assert$3.equal(typeof t,"function","ChooComponentCache: emit should be type function"),typeof r=="number"?this.cache=new LRU(r):this.cache=r||new LRU(100),this.state=e,this.emit=t}ChooComponentCache.prototype.render=function(e,t){assert$3.equal(typeof e,"function","ChooComponentCache.render: Component should be type function"),assert$3.ok(typeof t=="string"||typeof t=="number","ChooComponentCache.render: id should be type string or type number");var r=this.cache.get(t);if(!r){for(var o=[],s=2,f=arguments.length;s<f;s++)o.push(arguments[s]);o.unshift(e,t,this.state,this.emit),r=newCall.apply(newCall,o),this.cache.set(t,r)}return r};function newCall(e){return new(e.bind.apply(e,arguments))}var scrollToAnchor=scrollToAnchor_1,documentReady=documentReady$1,nanotiming$1=browser$3,nanorouter=nanorouter$1,nanomorph=nanomorph_1,nanoquery=browser$2,nanohref=nanohref$1,nanoraf=nanoraf_1,nanobus=nanobus$1,assert$2=nanoassert$1,Cache=cache,choo=Choo,HISTORY_OBJECT={};function Choo(e){var t=nanotiming$1("choo.constructor");if(!(this instanceof Choo))return new Choo(e);e=e||{},assert$2.equal(typeof e,"object","choo: opts should be type object");var r=this;this._events={DOMCONTENTLOADED:"DOMContentLoaded",DOMTITLECHANGE:"DOMTitleChange",REPLACESTATE:"replaceState",PUSHSTATE:"pushState",NAVIGATE:"navigate",POPSTATE:"popState",RENDER:"render"},this._historyEnabled=e.history===void 0?!0:e.history,this._hrefEnabled=e.href===void 0?!0:e.href,this._hashEnabled=e.hash===void 0?!1:e.hash,this._hasWindow=typeof window<"u",this._cache=e.cache,this._loaded=!1,this._stores=[s],this._tree=null;var o={events:this._events,components:{}};this._hasWindow?(this.state=window.initialState?Object.assign({},window.initialState,o):o,delete window.initialState):this.state=o,this.router=nanorouter({curry:!0}),this.emitter=nanobus("choo.emit"),this.emit=this.emitter.emit.bind(this.emitter),this._hasWindow&&(this.state.title=document.title);function s(f){r.emitter.prependListener(r._events.DOMTITLECHANGE,function(g){assert$2.equal(typeof g,"string","events.DOMTitleChange: title should be type string"),f.title=g,r._hasWindow&&(document.title=g)})}t()}Choo.prototype.route=function(e,t){var r=nanotiming$1("choo.route('"+e+"')");assert$2.equal(typeof e,"string","choo.route: route should be type string"),assert$2.equal(typeof t,"function","choo.handler: route should be type function"),this.router.on(e,t),r()};Choo.prototype.use=function(e){assert$2.equal(typeof e,"function","choo.use: cb should be type function");var t=this;this._stores.push(function(r){var o="choo.use";o=e.storeName?o+"("+e.storeName+")":o;var s=nanotiming$1(o);e(r,t.emitter,t),s()})};Choo.prototype.start=function(){assert$2.equal(typeof window,"object","choo.start: window was not found. .start() must be called in a browser, use .toString() if running in Node");var e=nanotiming$1("choo.start"),t=this;return this._historyEnabled&&(this.emitter.prependListener(this._events.NAVIGATE,function(){t._matchRoute(t.state),t._loaded&&(t.emitter.emit(t._events.RENDER),setTimeout(scrollToAnchor.bind(null,window.location.hash),0))}),this.emitter.prependListener(this._events.POPSTATE,function(){t.emitter.emit(t._events.NAVIGATE)}),this.emitter.prependListener(this._events.PUSHSTATE,function(r){assert$2.equal(typeof r,"string","events.pushState: href should be type string"),window.history.pushState(HISTORY_OBJECT,null,r),t.emitter.emit(t._events.NAVIGATE)}),this.emitter.prependListener(this._events.REPLACESTATE,function(r){assert$2.equal(typeof r,"string","events.replaceState: href should be type string"),window.history.replaceState(HISTORY_OBJECT,null,r),t.emitter.emit(t._events.NAVIGATE)}),window.onpopstate=function(){t.emitter.emit(t._events.POPSTATE)},t._hrefEnabled&&nanohref(function(r){var o=r.href,s=r.hash;if(o===window.location.href){!t._hashEnabled&&s&&scrollToAnchor(s);return}t.emitter.emit(t._events.PUSHSTATE,o)})),this._setCache(this.state),this._matchRoute(this.state),this._stores.forEach(function(r){r(t.state)}),this._tree=this._prerender(this.state),assert$2.ok(this._tree,"choo.start: no valid DOM node returned for location "+this.state.href),this.emitter.prependListener(t._events.RENDER,nanoraf(function(){var r=nanotiming$1("choo.render"),o=t._prerender(t.state);assert$2.ok(o,"choo.render: no valid DOM node returned for location "+t.state.href),assert$2.equal(t._tree.nodeName,o.nodeName,"choo.render: The target node <"+t._tree.nodeName.toLowerCase()+"> is not the same type as the new node <"+o.nodeName.toLowerCase()+">.");var s=nanotiming$1("choo.morph");nanomorph(t._tree,o),s(),r()})),documentReady(function(){t.emitter.emit(t._events.DOMCONTENTLOADED),t._loaded=!0}),e(),this._tree};Choo.prototype.mount=function(t){var r=nanotiming$1("choo.mount('"+t+"')");if(typeof window!="object")return assert$2.ok(typeof t=="string","choo.mount: selector should be type String"),this.selector=t,r(),this;assert$2.ok(typeof t=="string"||typeof t=="object","choo.mount: selector should be type String or HTMLElement");var o=this;documentReady(function(){var s=nanotiming$1("choo.render"),f=o.start();typeof t=="string"?o._tree=document.querySelector(t):o._tree=t,assert$2.ok(o._tree,"choo.mount: could not query selector: "+t),assert$2.equal(o._tree.nodeName,f.nodeName,"choo.mount: The target node <"+o._tree.nodeName.toLowerCase()+"> is not the same type as the new node <"+f.nodeName.toLowerCase()+">.");var g=nanotiming$1("choo.morph");nanomorph(o._tree,f),g(),s()}),r()};Choo.prototype.toString=function(e,t){t=t||{},t.components=t.components||{},t.events=Object.assign({},t.events,this._events),assert$2.notEqual(typeof window,"object","choo.mount: window was found. .toString() must be called in Node, use .start() or .mount() if running in the browser"),assert$2.equal(typeof e,"string","choo.toString: location should be type string"),assert$2.equal(typeof t,"object","choo.toString: state should be type object"),this._setCache(t),this._matchRoute(t,e),this.emitter.removeAllListeners(),this._stores.forEach(function(o){o(t)});var r=this._prerender(t);return assert$2.ok(r,"choo.toString: no valid value returned for the route "+e),assert$2(!Array.isArray(r),"choo.toString: return value was an array for the route "+e),typeof r.outerHTML=="string"?r.outerHTML:r.toString()};Choo.prototype._matchRoute=function(e,t){var r,o;t?(r=t.replace(/\?.+$/,"").replace(/\/$/,""),this._hashEnabled||(r=r.replace(/#.+$/,"")),o=t):(r=window.location.pathname.replace(/\/$/,""),this._hashEnabled&&(r+=window.location.hash.replace(/^#/,"/")),o=window.location.search);var s=this.router.match(r);this._handler=s.cb,e.href=r,e.query=nanoquery(o),e.route=s.route,e.params=s.params};Choo.prototype._prerender=function(e){var t=nanotiming$1("choo.prerender('"+e.route+"')"),r=this._handler(e,this.emit);return t(),r};Choo.prototype._setCache=function(e){var t=new Cache(e,this.emitter.emit.bind(this.emitter),this._cache);e.cache=r;function r(o,s){assert$2.equal(typeof o,"function","choo.state.cache: Component should be type function");for(var f=[],g=0,S=arguments.length;g<S;g++)f.push(arguments[g]);return t.render.apply(t,f)}r.toJSON=function(){return null}};const choo$1=getDefaultExportFromCjs(choo);var hyperscriptAttributeToProperty=attributeToProperty,transform={class:"className",for:"htmlFor","http-equiv":"httpEquiv"};function attributeToProperty(e){return function(t,r,o){for(var s in r)s in transform&&(r[transform[s]]=r[s],delete r[s]);return e(t,r,o)}}var attrToProp=hyperscriptAttributeToProperty,VAR=0,TEXT=1,OPEN=2,CLOSE=3,ATTR=4,ATTR_KEY=5,ATTR_KEY_W=6,ATTR_VALUE_W=7,ATTR_VALUE=8,ATTR_VALUE_SQ=9,ATTR_VALUE_DQ=10,ATTR_EQ=11,ATTR_BREAK=12,COMMENT$1=13,hyperx$1=function(e,t){t||(t={});var r=t.concat||function(s,f){return String(s)+String(f)};return t.attrToProp!==!1&&(e=attrToProp(e)),function(s){for(var f=TEXT,g="",S=arguments.length,P=[],G=0;G<s.length;G++)if(G<S-1){var le=arguments[G+1],pe=bt(s[G]),Se=f;Se===ATTR_VALUE_DQ&&(Se=ATTR_VALUE),Se===ATTR_VALUE_SQ&&(Se=ATTR_VALUE),Se===ATTR_VALUE_W&&(Se=ATTR_VALUE),Se===ATTR&&(Se=ATTR_KEY),Se===OPEN?g==="/"?(pe.push([OPEN,"/",le]),g=""):pe.push([OPEN,le]):Se===COMMENT$1&&t.comments?g+=String(le):Se!==COMMENT$1&&pe.push([VAR,Se,le]),P.push.apply(P,pe)}else P.push.apply(P,bt(s[G]));for(var Ve=[null,{},[]],Ne=[[Ve,-1]],G=0;G<P.length;G++){var ge=Ne[Ne.length-1][0],pe=P[G],Je=pe[0];if(Je===OPEN&&/^\//.test(pe[1])){var He=Ne[Ne.length-1][1];Ne.length>1&&(Ne.pop(),Ne[Ne.length-1][0][2][He]=e(ge[0],ge[1],ge[2].length?ge[2]:void 0))}else if(Je===OPEN){var xe=[pe[1],{},[]];ge[2].push(xe),Ne.push([xe,ge[2].length-1])}else if(Je===ATTR_KEY||Je===VAR&&pe[1]===ATTR_KEY){for(var $e="",_t;G<P.length;G++)if(P[G][0]===ATTR_KEY)$e=r($e,P[G][1]);else if(P[G][0]===VAR&&P[G][1]===ATTR_KEY)if(typeof P[G][2]=="object"&&!$e)for(_t in P[G][2])P[G][2].hasOwnProperty(_t)&&!ge[1][_t]&&(ge[1][_t]=P[G][2][_t]);else $e=r($e,P[G][2]);else break;P[G][0]===ATTR_EQ&&G++;for(var at=G;G<P.length;G++)if(P[G][0]===ATTR_VALUE||P[G][0]===ATTR_KEY)ge[1][$e]?P[G][1]===""||(ge[1][$e]=r(ge[1][$e],P[G][1])):ge[1][$e]=o(P[G][1]);else if(P[G][0]===VAR&&(P[G][1]===ATTR_VALUE||P[G][1]===ATTR_KEY))ge[1][$e]?P[G][2]===""||(ge[1][$e]=r(ge[1][$e],P[G][2])):ge[1][$e]=o(P[G][2]);else{$e.length&&!ge[1][$e]&&G===at&&(P[G][0]===CLOSE||P[G][0]===ATTR_BREAK)&&(ge[1][$e]=$e.toLowerCase()),P[G][0]===CLOSE&&G--;break}}else if(Je===ATTR_KEY)ge[1][pe[1]]=!0;else if(Je===VAR&&pe[1]===ATTR_KEY)ge[1][pe[2]]=!0;else if(Je===CLOSE){if(selfClosing(ge[0])&&Ne.length){var He=Ne[Ne.length-1][1];Ne.pop(),Ne[Ne.length-1][0][2][He]=e(ge[0],ge[1],ge[2].length?ge[2]:void 0)}}else if(Je===VAR&&pe[1]===TEXT)pe[2]===void 0||pe[2]===null?pe[2]="":pe[2]||(pe[2]=r("",pe[2])),Array.isArray(pe[2][0])?ge[2].push.apply(ge[2],pe[2]):ge[2].push(pe[2]);else if(Je===TEXT)ge[2].push(pe[1]);else if(!(Je===ATTR_EQ||Je===ATTR_BREAK))throw new Error("unhandled: "+Je)}if(Ve[2].length>1&&/^\s*$/.test(Ve[2][0])&&Ve[2].shift(),Ve[2].length>2||Ve[2].length===2&&/\S/.test(Ve[2][1])){if(t.createFragment)return t.createFragment(Ve[2]);throw new Error("multiple root elements must be wrapped in an enclosing tag")}return Array.isArray(Ve[2][0])&&typeof Ve[2][0][0]=="string"&&Array.isArray(Ve[2][0][2])&&(Ve[2][0]=e(Ve[2][0][0],Ve[2][0][1],Ve[2][0][2])),Ve[2][0];function bt(Qe){var et=[];f===ATTR_VALUE_W&&(f=ATTR);for(var Ot=0;Ot<Qe.length;Ot++){var tt=Qe.charAt(Ot);f===TEXT&&tt==="<"?(g.length&&et.push([TEXT,g]),g="",f=OPEN):tt===">"&&!quot(f)&&f!==COMMENT$1?(f===OPEN&&g.length?et.push([OPEN,g]):f===ATTR_KEY?et.push([ATTR_KEY,g]):f===ATTR_VALUE&&g.length&&et.push([ATTR_VALUE,g]),et.push([CLOSE]),g="",f=TEXT):f===COMMENT$1&&/-$/.test(g)&&tt==="-"?(t.comments&&et.push([ATTR_VALUE,g.substr(0,g.length-1)]),g="",f=TEXT):f===OPEN&&/^!--$/.test(g)?(t.comments&&et.push([OPEN,g],[ATTR_KEY,"comment"],[ATTR_EQ]),g=tt,f=COMMENT$1):f===TEXT||f===COMMENT$1?g+=tt:f===OPEN&&tt==="/"&&g.length||(f===OPEN&&/\s/.test(tt)?(g.length&&et.push([OPEN,g]),g="",f=ATTR):f===OPEN?g+=tt:f===ATTR&&/[^\s"'=/]/.test(tt)?(f=ATTR_KEY,g=tt):f===ATTR&&/\s/.test(tt)?(g.length&&et.push([ATTR_KEY,g]),et.push([ATTR_BREAK])):f===ATTR_KEY&&/\s/.test(tt)?(et.push([ATTR_KEY,g]),g="",f=ATTR_KEY_W):f===ATTR_KEY&&tt==="="?(et.push([ATTR_KEY,g],[ATTR_EQ]),g="",f=ATTR_VALUE_W):f===ATTR_KEY?g+=tt:(f===ATTR_KEY_W||f===ATTR)&&tt==="="?(et.push([ATTR_EQ]),f=ATTR_VALUE_W):(f===ATTR_KEY_W||f===ATTR)&&!/\s/.test(tt)?(et.push([ATTR_BREAK]),/[\w-]/.test(tt)?(g+=tt,f=ATTR_KEY):f=ATTR):f===ATTR_VALUE_W&&tt==='"'?f=ATTR_VALUE_DQ:f===ATTR_VALUE_W&&tt==="'"?f=ATTR_VALUE_SQ:f===ATTR_VALUE_DQ&&tt==='"'?(et.push([ATTR_VALUE,g],[ATTR_BREAK]),g="",f=ATTR):f===ATTR_VALUE_SQ&&tt==="'"?(et.push([ATTR_VALUE,g],[ATTR_BREAK]),g="",f=ATTR):f===ATTR_VALUE_W&&!/\s/.test(tt)?(f=ATTR_VALUE,Ot--):f===ATTR_VALUE&&/\s/.test(tt)?(et.push([ATTR_VALUE,g],[ATTR_BREAK]),g="",f=ATTR):(f===ATTR_VALUE||f===ATTR_VALUE_SQ||f===ATTR_VALUE_DQ)&&(g+=tt))}return f===TEXT&&g.length?(et.push([TEXT,g]),g=""):f===ATTR_VALUE&&g.length?(et.push([ATTR_VALUE,g]),g=""):f===ATTR_VALUE_DQ&&g.length?(et.push([ATTR_VALUE,g]),g=""):f===ATTR_VALUE_SQ&&g.length?(et.push([ATTR_VALUE,g]),g=""):f===ATTR_KEY&&(et.push([ATTR_KEY,g]),g=""),et}};function o(s){return typeof s=="function"||typeof s=="string"||s&&typeof s=="object"||s==null?s:r("",s)}};function quot(e){return e===ATTR_VALUE_SQ||e===ATTR_VALUE_DQ}var closeRE=RegExp("^("+["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","!--","animate","animateTransform","circle","cursor","desc","ellipse","feBlend","feColorMatrix","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","font-face-format","font-face-name","font-face-uri","glyph","glyphRef","hkern","image","line","missing-glyph","mpath","path","polygon","polyline","rect","set","stop","tref","use","view","vkern"].join("|")+")(?:[.#][a-zA-Z0-9-￿_:-]+)*$");function selfClosing(e){return closeRE.test(e)}var trailingNewlineRegex=/\n[\s]+$/,leadingNewlineRegex=/^\n[\s]+/,trailingSpaceRegex=/[\s]+$/,leadingSpaceRegex=/^[\s]+/,multiSpaceRegex=/[\n\s]+/g,TEXT_TAGS=["a","abbr","b","bdi","bdo","br","cite","data","dfn","em","i","kbd","mark","q","rp","rt","rtc","ruby","s","amp","small","span","strong","sub","sup","time","u","var","wbr"],VERBATIM_TAGS=["code","pre","textarea"],appendChild$1=function e(t,r){if(Array.isArray(r))for(var o=t.nodeName.toLowerCase(),s=!1,f,g,S=0,P=r.length;S<P;S++){var G=r[S];if(Array.isArray(G)){e(t,G);continue}(typeof G=="number"||typeof G=="boolean"||typeof G=="function"||G instanceof Date||G instanceof RegExp)&&(G=G.toString());var le=t.childNodes[t.childNodes.length-1];if(typeof G=="string")s=!0,le&&le.nodeName==="#text"?le.nodeValue+=G:(G=t.ownerDocument.createTextNode(G),t.appendChild(G),le=G),S===P-1&&(s=!1,TEXT_TAGS.indexOf(o)===-1&&VERBATIM_TAGS.indexOf(o)===-1?(f=le.nodeValue.replace(leadingNewlineRegex,"").replace(trailingSpaceRegex,"").replace(trailingNewlineRegex,"").replace(multiSpaceRegex," "),f===""?t.removeChild(le):le.nodeValue=f):VERBATIM_TAGS.indexOf(o)===-1&&(g=S===0?"":" ",f=le.nodeValue.replace(leadingNewlineRegex,g).replace(leadingSpaceRegex," ").replace(trailingSpaceRegex,"").replace(trailingNewlineRegex,"").replace(multiSpaceRegex," "),le.nodeValue=f));else if(G&&G.nodeType){s&&(s=!1,TEXT_TAGS.indexOf(o)===-1&&VERBATIM_TAGS.indexOf(o)===-1?(f=le.nodeValue.replace(leadingNewlineRegex,"").replace(trailingNewlineRegex," ").replace(multiSpaceRegex," "),f===""?t.removeChild(le):le.nodeValue=f):VERBATIM_TAGS.indexOf(o)===-1&&(f=le.nodeValue.replace(leadingSpaceRegex," ").replace(leadingNewlineRegex,"").replace(trailingNewlineRegex," ").replace(multiSpaceRegex," "),le.nodeValue=f));var pe=G.nodeName;pe&&(o=pe.toLowerCase()),t.appendChild(G)}}},svgTags=["svg","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],boolProps=["async","autofocus","autoplay","checked","controls","default","defaultchecked","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","novalidate","open","playsinline","readonly","required","reversed","selected"],directProps=["indeterminate"],hyperx=hyperx$1,appendChild=appendChild$1,SVG_TAGS=svgTags,BOOL_PROPS=boolProps,DIRECT_PROPS=directProps,SVGNS="http://www.w3.org/2000/svg",XLINKNS="http://www.w3.org/1999/xlink",COMMENT_TAG="!--",dom=function(e){function t(s,f,g){var S;SVG_TAGS.indexOf(s)!==-1&&(f.namespace=SVGNS);var P=!1;f.namespace&&(P=f.namespace,delete f.namespace);var G=!1;if(f.is&&(G=f.is,delete f.is),P)G?S=e.createElementNS(P,s,{is:G}):S=e.createElementNS(P,s);else{if(s===COMMENT_TAG)return e.createComment(f.comment);G?S=e.createElement(s,{is:G}):S=e.createElement(s)}for(var le in f)if(f.hasOwnProperty(le)){var pe=le.toLowerCase(),Se=f[le];if(pe==="classname"&&(pe="class",le="class"),le==="htmlFor"&&(le="for"),BOOL_PROPS.indexOf(pe)!==-1){if(String(Se)==="true")Se=pe;else if(String(Se)==="false")continue}pe.slice(0,2)==="on"||DIRECT_PROPS.indexOf(pe)!==-1?S[le]=Se:P?le==="xlink:href"?S.setAttributeNS(XLINKNS,le,Se):/^xmlns($|:)/i.test(le)||S.setAttributeNS(null,le,Se):S.setAttribute(le,Se)}return appendChild(S,g),S}function r(s){for(var f=e.createDocumentFragment(),g=0;g<s.length;g++)s[g]!=null&&(Array.isArray(s[g])?f.appendChild(r(s[g])):(typeof s[g]=="string"&&(s[g]=e.createTextNode(s[g])),f.appendChild(s[g])));return f}var o=hyperx(t,{comments:!0,createFragment:r});return o.default=o,o.createComment=t,o},browser$1=dom(document),html=browser$1;const html$1=getDefaultExportFromCjs(html);function sheetForTag(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function createStyleElement(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var StyleSheet=function(){function e(r){var o=this;this._insertTag=function(s){var f;o.tags.length===0?o.insertionPoint?f=o.insertionPoint.nextSibling:o.prepend?f=o.container.firstChild:f=o.before:f=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(s,f),o.tags.push(s)},this.isSpeedy=r.speedy===void 0?!0:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(o){o.forEach(this._insertTag)},t.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(createStyleElement(this));var s=this.tags[this.tags.length-1];if(this.isSpeedy){var f=sheetForTag(s);try{f.insertRule(o,f.cssRules.length)}catch{}}else s.appendChild(document.createTextNode(o));this.ctr++},t.flush=function(){this.tags.forEach(function(o){return o.parentNode&&o.parentNode.removeChild(o)}),this.tags=[],this.ctr=0},e}(),MS="-ms-",MOZ="-moz-",WEBKIT="-webkit-",COMMENT="comm",RULESET="rule",DECLARATION="decl",IMPORT="@import",KEYFRAMES="@keyframes",LAYER="@layer",abs=Math.abs,from=String.fromCharCode,assign=Object.assign;function hash(e,t){return charat(e,0)^45?(((t<<2^charat(e,0))<<2^charat(e,1))<<2^charat(e,2))<<2^charat(e,3):0}function trim(e){return e.trim()}function match(e,t){return(e=t.exec(e))?e[0]:e}function replace(e,t,r){return e.replace(t,r)}function indexof(e,t){return e.indexOf(t)}function charat(e,t){return e.charCodeAt(t)|0}function substr(e,t,r){return e.slice(t,r)}function strlen(e){return e.length}function sizeof(e){return e.length}function append(e,t){return t.push(e),e}function combine(e,t){return e.map(t).join("")}var line=1,column=1,length=0,position=0,character=0,characters="";function node(e,t,r,o,s,f,g){return{value:e,root:t,parent:r,type:o,props:s,children:f,line,column,length:g,return:""}}function copy(e,t){return assign(node("",null,null,"",null,null,0),e,{length:-e.length},t)}function char(){return character}function prev(){return character=position>0?charat(characters,--position):0,column--,character===10&&(column=1,line--),character}function next(){return character=position<length?charat(characters,position++):0,column++,character===10&&(column=1,line++),character}function peek(){return charat(characters,position)}function caret(){return position}function slice(e,t){return substr(characters,e,t)}function token(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function alloc(e){return line=column=1,length=strlen(characters=e),position=0,[]}function dealloc(e){return characters="",e}function delimit(e){return trim(slice(position-1,delimiter(e===91?e+2:e===40?e+1:e)))}function whitespace(e){for(;(character=peek())&&character<33;)next();return token(e)>2||token(character)>3?"":" "}function escaping(e,t){for(;--t&&next()&&!(character<48||character>102||character>57&&character<65||character>70&&character<97););return slice(e,caret()+(t<6&&peek()==32&&next()==32))}function delimiter(e){for(;next();)switch(character){case e:return position;case 34:case 39:e!==34&&e!==39&&delimiter(character);break;case 40:e===41&&delimiter(e);break;case 92:next();break}return position}function commenter(e,t){for(;next()&&e+character!==47+10;)if(e+character===42+42&&peek()===47)break;return"/*"+slice(t,position-1)+"*"+from(e===47?e:next())}function identifier(e){for(;!token(peek());)next();return slice(e,position)}function compile(e){return dealloc(parse("",null,null,null,[""],e=alloc(e),0,[0],e))}function parse(e,t,r,o,s,f,g,S,P){for(var G=0,le=0,pe=g,Se=0,Ve=0,Ne=0,ge=1,Je=1,He=1,xe=0,$e="",_t=s,at=f,bt=o,Qe=$e;Je;)switch(Ne=xe,xe=next()){case 40:if(Ne!=108&&charat(Qe,pe-1)==58){indexof(Qe+=replace(delimit(xe),"&","&\f"),"&\f")!=-1&&(He=-1);break}case 34:case 39:case 91:Qe+=delimit(xe);break;case 9:case 10:case 13:case 32:Qe+=whitespace(Ne);break;case 92:Qe+=escaping(caret()-1,7);continue;case 47:switch(peek()){case 42:case 47:append(comment(commenter(next(),caret()),t,r),P);break;default:Qe+="/"}break;case 123*ge:S[G++]=strlen(Qe)*He;case 125*ge:case 59:case 0:switch(xe){case 0:case 125:Je=0;case 59+le:He==-1&&(Qe=replace(Qe,/\f/g,"")),Ve>0&&strlen(Qe)-pe&&append(Ve>32?declaration(Qe+";",o,r,pe-1):declaration(replace(Qe," ","")+";",o,r,pe-2),P);break;case 59:Qe+=";";default:if(append(bt=ruleset(Qe,t,r,G,le,s,S,$e,_t=[],at=[],pe),f),xe===123)if(le===0)parse(Qe,t,bt,bt,_t,f,pe,S,at);else switch(Se===99&&charat(Qe,3)===110?100:Se){case 100:case 108:case 109:case 115:parse(e,bt,bt,o&&append(ruleset(e,bt,bt,0,0,s,S,$e,s,_t=[],pe),at),s,at,pe,S,o?_t:at);break;default:parse(Qe,bt,bt,bt,[""],at,0,S,at)}}G=le=Ve=0,ge=He=1,$e=Qe="",pe=g;break;case 58:pe=1+strlen(Qe),Ve=Ne;default:if(ge<1){if(xe==123)--ge;else if(xe==125&&ge++==0&&prev()==125)continue}switch(Qe+=from(xe),xe*ge){case 38:He=le>0?1:(Qe+="\f",-1);break;case 44:S[G++]=(strlen(Qe)-1)*He,He=1;break;case 64:peek()===45&&(Qe+=delimit(next())),Se=peek(),le=pe=strlen($e=Qe+=identifier(caret())),xe++;break;case 45:Ne===45&&strlen(Qe)==2&&(ge=0)}}return f}function ruleset(e,t,r,o,s,f,g,S,P,G,le){for(var pe=s-1,Se=s===0?f:[""],Ve=sizeof(Se),Ne=0,ge=0,Je=0;Ne<o;++Ne)for(var He=0,xe=substr(e,pe+1,pe=abs(ge=g[Ne])),$e=e;He<Ve;++He)($e=trim(ge>0?Se[He]+" "+xe:replace(xe,/&\f/g,Se[He])))&&(P[Je++]=$e);return node(e,t,r,s===0?RULESET:S,P,G,le)}function comment(e,t,r){return node(e,t,r,COMMENT,from(char()),substr(e,2,-2),0)}function declaration(e,t,r,o){return node(e,t,r,DECLARATION,substr(e,0,o),substr(e,o+1,-1),o)}function serialize(e,t){for(var r="",o=sizeof(e),s=0;s<o;s++)r+=t(e[s],s,e,t)||"";return r}function stringify(e,t,r,o){switch(e.type){case LAYER:if(e.children.length)break;case IMPORT:case DECLARATION:return e.return=e.return||e.value;case COMMENT:return"";case KEYFRAMES:return e.return=e.value+"{"+serialize(e.children,o)+"}";case RULESET:e.value=e.props.join(",")}return strlen(r=serialize(e.children,o))?e.return=e.value+"{"+r+"}":""}function middleware(e){var t=sizeof(e);return function(r,o,s,f){for(var g="",S=0;S<t;S++)g+=e[S](r,o,s,f)||"";return g}}function rulesheet(e){return function(t){t.root||(t=t.return)&&e(t)}}function memoize(e){var t=Object.create(null);return function(r){return t[r]===void 0&&(t[r]=e(r)),t[r]}}var identifierWithPointTracking=function(t,r,o){for(var s=0,f=0;s=f,f=peek(),s===38&&f===12&&(r[o]=1),!token(f);)next();return slice(t,position)},toRules=function(t,r){var o=-1,s=44;do switch(token(s)){case 0:s===38&&peek()===12&&(r[o]=1),t[o]+=identifierWithPointTracking(position-1,r,o);break;case 2:t[o]+=delimit(s);break;case 4:if(s===44){t[++o]=peek()===58?"&\f":"",r[o]=t[o].length;break}default:t[o]+=from(s)}while(s=next());return t},getRules=function(t,r){return dealloc(toRules(alloc(t),r))},fixedElements=new WeakMap,compat=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var r=t.value,o=t.parent,s=t.column===o.column&&t.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(t.props.length===1&&r.charCodeAt(0)!==58&&!fixedElements.get(o))&&!s){fixedElements.set(t,!0);for(var f=[],g=getRules(r,f),S=o.props,P=0,G=0;P<g.length;P++)for(var le=0;le<S.length;le++,G++)t.props[G]=f[P]?g[P].replace(/&\f/g,S[le]):S[le]+" "+g[P]}}},removeLabel=function(t){if(t.type==="decl"){var r=t.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(t.return="",t.value="")}};function prefix(e,t){switch(hash(e,t)){case 5103:return WEBKIT+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return WEBKIT+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return WEBKIT+e+MOZ+e+MS+e+e;case 6828:case 4268:return WEBKIT+e+MS+e+e;case 6165:return WEBKIT+e+MS+"flex-"+e+e;case 5187:return WEBKIT+e+replace(e,/(\w+).+(:[^]+)/,WEBKIT+"box-$1$2"+MS+"flex-$1$2")+e;case 5443:return WEBKIT+e+MS+"flex-item-"+replace(e,/flex-|-self/,"")+e;case 4675:return WEBKIT+e+MS+"flex-line-pack"+replace(e,/align-content|flex-|-self/,"")+e;case 5548:return WEBKIT+e+MS+replace(e,"shrink","negative")+e;case 5292:return WEBKIT+e+MS+replace(e,"basis","preferred-size")+e;case 6060:return WEBKIT+"box-"+replace(e,"-grow","")+WEBKIT+e+MS+replace(e,"grow","positive")+e;case 4554:return WEBKIT+replace(e,/([^-])(transform)/g,"$1"+WEBKIT+"$2")+e;case 6187:return replace(replace(replace(e,/(zoom-|grab)/,WEBKIT+"$1"),/(image-set)/,WEBKIT+"$1"),e,"")+e;case 5495:case 3959:return replace(e,/(image-set\([^]*)/,WEBKIT+"$1$`$1");case 4968:return replace(replace(e,/(.+:)(flex-)?(.*)/,WEBKIT+"box-pack:$3"+MS+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+WEBKIT+e+e;case 4095:case 3583:case 4068:case 2532:return replace(e,/(.+)-inline(.+)/,WEBKIT+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(strlen(e)-1-t>6)switch(charat(e,t+1)){case 109:if(charat(e,t+4)!==45)break;case 102:return replace(e,/(.+:)(.+)-([^]+)/,"$1"+WEBKIT+"$2-$3$1"+MOZ+(charat(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~indexof(e,"stretch")?prefix(replace(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(charat(e,t+1)!==115)break;case 6444:switch(charat(e,strlen(e)-3-(~indexof(e,"!important")&&10))){case 107:return replace(e,":",":"+WEBKIT)+e;case 101:return replace(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+WEBKIT+(charat(e,14)===45?"inline-":"")+"box$3$1"+WEBKIT+"$2$3$1"+MS+"$2box$3")+e}break;case 5936:switch(charat(e,t+11)){case 114:return WEBKIT+e+MS+replace(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return WEBKIT+e+MS+replace(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return WEBKIT+e+MS+replace(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return WEBKIT+e+MS+e+e}return e}var prefixer=function(t,r,o,s){if(t.length>-1&&!t.return)switch(t.type){case DECLARATION:t.return=prefix(t.value,t.length);break;case KEYFRAMES:return serialize([copy(t,{value:replace(t.value,"@","@"+WEBKIT)})],s);case RULESET:if(t.length)return combine(t.props,function(f){switch(match(f,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return serialize([copy(t,{props:[replace(f,/:(read-\w+)/,":"+MOZ+"$1")]})],s);case"::placeholder":return serialize([copy(t,{props:[replace(f,/:(plac\w+)/,":"+WEBKIT+"input-$1")]}),copy(t,{props:[replace(f,/:(plac\w+)/,":"+MOZ+"$1")]}),copy(t,{props:[replace(f,/:(plac\w+)/,MS+"input-$1")]})],s)}return""})}},defaultStylisPlugins=[prefixer],createCache=function(t){var r=t.key;if(r==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(ge){var Je=ge.getAttribute("data-emotion");Je.indexOf(" ")!==-1&&(document.head.appendChild(ge),ge.setAttribute("data-s",""))})}var s=t.stylisPlugins||defaultStylisPlugins,f={},g,S=[];g=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(ge){for(var Je=ge.getAttribute("data-emotion").split(" "),He=1;He<Je.length;He++)f[Je[He]]=!0;S.push(ge)});var P,G=[compat,removeLabel];{var le,pe=[stringify,rulesheet(function(ge){le.insert(ge)})],Se=middleware(G.concat(s,pe)),Ve=function(Je){return serialize(compile(Je),Se)};P=function(Je,He,xe,$e){le=xe,Ve(Je?Je+"{"+He.styles+"}":He.styles),$e&&(Ne.inserted[He.name]=!0)}}var Ne={key:r,sheet:new StyleSheet({key:r,container:g,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:f,registered:{},insert:P};return Ne.sheet.hydrate(S),Ne};function murmur2(e){for(var t=0,r,o=0,s=e.length;s>=4;++o,s-=4)r=e.charCodeAt(o)&255|(e.charCodeAt(++o)&255)<<8|(e.charCodeAt(++o)&255)<<16|(e.charCodeAt(++o)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,t=(r&65535)*1540483477+((r>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(s){case 3:t^=(e.charCodeAt(o+2)&255)<<16;case 2:t^=(e.charCodeAt(o+1)&255)<<8;case 1:t^=e.charCodeAt(o)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var unitlessKeys={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},hyphenateRegex=/[A-Z]|^ms/g,animationRegex=/_EMO_([^_]+?)_([^]*?)_EMO_/g,isCustomProperty=function(t){return t.charCodeAt(1)===45},isProcessableValue=function(t){return t!=null&&typeof t!="boolean"},processStyleName=memoize(function(e){return isCustomProperty(e)?e:e.replace(hyphenateRegex,"-$&").toLowerCase()}),processStyleValue=function(t,r){switch(t){case"animation":case"animationName":if(typeof r=="string")return r.replace(animationRegex,function(o,s,f){return cursor={name:s,styles:f,next:cursor},s})}return unitlessKeys[t]!==1&&!isCustomProperty(t)&&typeof r=="number"&&r!==0?r+"px":r},noComponentSelectorMessage="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function handleInterpolation(e,t,r){if(r==null)return"";if(r.__emotion_styles!==void 0)return r;switch(typeof r){case"boolean":return"";case"object":{if(r.anim===1)return cursor={name:r.name,styles:r.styles,next:cursor},r.name;if(r.styles!==void 0){var o=r.next;if(o!==void 0)for(;o!==void 0;)cursor={name:o.name,styles:o.styles,next:cursor},o=o.next;var s=r.styles+";";return s}return createStringFromObject(e,t,r)}case"function":{if(e!==void 0){var f=cursor,g=r(e);return cursor=f,handleInterpolation(e,t,g)}break}}if(t==null)return r;var S=t[r];return S!==void 0?S:r}function createStringFromObject(e,t,r){var o="";if(Array.isArray(r))for(var s=0;s<r.length;s++)o+=handleInterpolation(e,t,r[s])+";";else for(var f in r){var g=r[f];if(typeof g!="object")t!=null&&t[g]!==void 0?o+=f+"{"+t[g]+"}":isProcessableValue(g)&&(o+=processStyleName(f)+":"+processStyleValue(f,g)+";");else if(Array.isArray(g)&&typeof g[0]=="string"&&(t==null||t[g[0]]===void 0))for(var S=0;S<g.length;S++)isProcessableValue(g[S])&&(o+=processStyleName(f)+":"+processStyleValue(f,g[S])+";");else{var P=handleInterpolation(e,t,g);switch(f){case"animation":case"animationName":{o+=processStyleName(f)+":"+P+";";break}default:o+=f+"{"+P+"}"}}}return o}var labelPattern=/label:\s*([^\s;\n{]+)\s*(;|$)/g,cursor,serializeStyles=function(t,r,o){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var s=!0,f="";cursor=void 0;var g=t[0];g==null||g.raw===void 0?(s=!1,f+=handleInterpolation(o,r,g)):f+=g[0];for(var S=1;S<t.length;S++)f+=handleInterpolation(o,r,t[S]),s&&(f+=g[S]);labelPattern.lastIndex=0;for(var P="",G;(G=labelPattern.exec(f))!==null;)P+="-"+G[1];var le=murmur2(f)+P;return{name:le,styles:f,next:cursor}},isBrowser=!0;function getRegisteredStyles(e,t,r){var o="";return r.split(" ").forEach(function(s){e[s]!==void 0?t.push(e[s]+";"):o+=s+" "}),o}var registerStyles=function(t,r,o){var s=t.key+"-"+r.name;(o===!1||isBrowser===!1)&&t.registered[s]===void 0&&(t.registered[s]=r.styles)},insertStyles=function(t,r,o){registerStyles(t,r,o);var s=t.key+"-"+r.name;if(t.inserted[r.name]===void 0){var f=r;do t.insert(r===f?"."+s:"",f,t.sheet,!0),f=f.next;while(f!==void 0)}};function insertWithoutScoping(e,t){if(e.inserted[t.name]===void 0)return e.insert("",t,e.sheet,!0)}function merge(e,t,r){var o=[],s=getRegisteredStyles(e,o,r);return o.length<2?r:s+t(o)}var createEmotion=function(t){var r=createCache(t);r.sheet.speedy=function(S){this.isSpeedy=S},r.compat=!0;var o=function(){for(var P=arguments.length,G=new Array(P),le=0;le<P;le++)G[le]=arguments[le];var pe=serializeStyles(G,r.registered,void 0);return insertStyles(r,pe,!1),r.key+"-"+pe.name},s=function(){for(var P=arguments.length,G=new Array(P),le=0;le<P;le++)G[le]=arguments[le];var pe=serializeStyles(G,r.registered),Se="animation-"+pe.name;return insertWithoutScoping(r,{name:pe.name,styles:"@keyframes "+Se+"{"+pe.styles+"}"}),Se},f=function(){for(var P=arguments.length,G=new Array(P),le=0;le<P;le++)G[le]=arguments[le];var pe=serializeStyles(G,r.registered);insertWithoutScoping(r,pe)},g=function(){for(var P=arguments.length,G=new Array(P),le=0;le<P;le++)G[le]=arguments[le];return merge(r.registered,o,classnames(G))};return{css:o,cx:g,injectGlobal:f,keyframes:s,hydrate:function(P){P.forEach(function(G){r.inserted[G]=!0})},flush:function(){r.registered={},r.inserted={},r.sheet.flush()},sheet:r.sheet,cache:r,getRegisteredStyles:getRegisteredStyles.bind(null,r.registered),merge:merge.bind(null,r.registered,o)}},classnames=function e(t){for(var r="",o=0;o<t.length;o++){var s=t[o];if(s!=null){var f=void 0;switch(typeof s){case"boolean":break;case"object":{if(Array.isArray(s))f=e(s);else{f="";for(var g in s)s[g]&&g&&(f&&(f+=" "),f+=g)}break}default:f=s}f&&(r&&(r+=" "),r+=f)}}return r},_createEmotion=createEmotion({key:"css"}),css=_createEmotion.css;const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var topLevel=typeof commonjsGlobal<"u"?commonjsGlobal:typeof window<"u"?window:{},minDoc=require$$0,doccy;typeof document<"u"?doccy=document:(doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"],doccy||(doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc));var document_1=doccy,onLoad={exports:{}},win;typeof window<"u"?win=window:typeof commonjsGlobal<"u"?win=commonjsGlobal:typeof self<"u"?win=self:win={};var window_1=win,document$2=document_1,window$1=window_1,watch=Object.create(null),KEY_ID="onloadid"+Math.random().toString(36).slice(2),KEY_ATTR="data-"+KEY_ID,INDEX=0;if(window$1&&window$1.MutationObserver){var observer=new MutationObserver(function(e){if(!(Object.keys(watch).length<1))for(var t=0;t<e.length;t++){if(e[t].attributeName===KEY_ATTR){eachAttr(e[t],turnon,turnoff);continue}eachMutation(e[t].removedNodes,function(r,o){document$2.documentElement.contains(o)||turnoff(r,o)}),eachMutation(e[t].addedNodes,function(r,o){document$2.documentElement.contains(o)&&turnon(r,o)})}});observer.observe(document$2.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:[KEY_ATTR]})}onLoad.exports=function e(t,r,o,s){return r=r||function(){},o=o||function(){},t.setAttribute(KEY_ATTR,"o"+INDEX),watch["o"+INDEX]=[r,o,0,s||e.caller],INDEX+=1,t};onLoad.exports.KEY_ATTR=KEY_ATTR;onLoad.exports.KEY_ID=KEY_ID;function turnon(e,t){watch[e][0]&&watch[e][2]===0&&(watch[e][0](t),watch[e][2]=1)}function turnoff(e,t){watch[e][1]&&watch[e][2]===1&&(watch[e][1](t),watch[e][2]=0)}function eachAttr(e,t,r){var o=e.target.getAttribute(KEY_ATTR);if(sameOrigin(e.oldValue,o)){watch[o]=watch[e.oldValue];return}watch[e.oldValue]&&r(e.oldValue,e.target),watch[o]&&t(o,e.target)}function sameOrigin(e,t){return!e||!t?!1:watch[e][3]===watch[t][3]}function eachMutation(e,t){for(var r=Object.keys(watch),o=0;o<e.length;o++){if(e[o]&&e[o].getAttribute&&e[o].getAttribute(KEY_ATTR)){var s=e[o].getAttribute(KEY_ATTR);r.forEach(function(f){s===f&&t(f,e[o])})}e[o]&&e[o].childNodes.length>0&&eachMutation(e[o].childNodes,t)}}var onLoadExports=onLoad.exports,nanoassert=assert$1;class AssertionError extends Error{}AssertionError.prototype.name="AssertionError";function assert$1(e,t){if(!e){var r=new AssertionError(t);throw Error.captureStackTrace&&Error.captureStackTrace(r,assert$1),r}}const document$1=document_1,nanotiming=browser$3,morph=nanomorph_1,onload=onLoadExports,assert=nanoassert,OL_KEY_ID=onload.KEY_ID,OL_ATTR_ID=onload.KEY_ATTR;var nanocomponent=Nanocomponent;function makeID(){return"ncid-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)}Nanocomponent.makeID=makeID;function Nanocomponent(e){this._hasWindow=typeof window<"u",this._id=null,this._ncID=null,this._olID=null,this._proxy=null,this._loaded=!1,this._rootNodeName=null,this._name=e||"nanocomponent",this._rerender=!1,this._handleLoad=this._handleLoad.bind(this),this._handleUnload=this._handleUnload.bind(this),this._arguments=[];const t=this;Object.defineProperty(this,"element",{get:function(){const r=document$1.getElementById(t._id);if(r)return r.dataset.nanocomponent===t._ncID?r:void 0}})}Nanocomponent.prototype.render=function(){const e=nanotiming(this._name+".render"),t=this,r=new Array(arguments.length);let o;for(let s=0;s<arguments.length;s++)r[s]=arguments[s];if(this._hasWindow)if(this.element){o=this.element;const s=nanotiming(this._name+".update"),f=this._rerender||this.update.apply(this,r);if(s(),this._rerender&&(this._rerender=!1),f){const g=this._handleRender(r),S=nanotiming(this._name+".morph");morph(o,g),S(),this.afterupdate&&this.afterupdate(o)}return this._proxy||(this._proxy=this._createProxy()),e(),this._proxy}else return this._reset(),o=this._handleRender(r),this.beforerender&&this.beforerender(o),(this.load||this.unload||this.afterreorder)&&(onload(o,t._handleLoad,t._handleUnload,t._ncID),this._olID=o.dataset[OL_KEY_ID]),e(),o;else{const s=nanotiming(this._name+".create");return o=this.createElement.apply(this,r),s(),e(),o}};Nanocomponent.prototype.rerender=function(){assert(this.element,"nanocomponent: cant rerender on an unmounted dom node"),this._rerender=!0,this.render.apply(this,this._arguments)};Nanocomponent.prototype._handleRender=function(e){const t=nanotiming(this._name+".createElement"),r=this.createElement.apply(this,e);return t(),this._rootNodeName||(this._rootNodeName=r.nodeName),assert(r instanceof window.Element,"nanocomponent: createElement should return a single DOM node"),assert(this._rootNodeName===r.nodeName,"nanocomponent: root node types cannot differ between re-renders"),this._arguments=e,this._brandNode(this._ensureID(r))};Nanocomponent.prototype._createProxy=function(){const e=document$1.createElement(this._rootNodeName),t=this;return this._brandNode(e),e.id=this._id,e.setAttribute("data-proxy",""),e.isSameNode=function(r){return r&&r.dataset.nanocomponent===t._ncID},e};Nanocomponent.prototype._reset=function(){this._ncID=Nanocomponent.makeID(),this._olID=null,this._id=null,this._proxy=null,this._rootNodeName=null};Nanocomponent.prototype._brandNode=function(e){return e.setAttribute("data-nanocomponent",this._ncID),this._olID&&e.setAttribute(OL_ATTR_ID,this._olID),e};Nanocomponent.prototype._ensureID=function(e){return e.id?this._id=e.id:e.id=this._id=this._ncID,this._proxy&&this._proxy.id!==this._id&&(this._proxy.id=this._id),e};Nanocomponent.prototype._handleLoad=function(e){if(this._loaded){this.afterreorder&&this.afterreorder(e);return}this._loaded=!0,this.load&&this.load(e)};Nanocomponent.prototype._handleUnload=function(e){this.element||(this._loaded=!1,this.unload&&this.unload(e))};Nanocomponent.prototype.createElement=function(){throw new Error("nanocomponent: createElement should be implemented!")};Nanocomponent.prototype.update=function(){throw new Error("nanocomponent: update should be implemented!")};var component=nanocomponent;const Component=getDefaultExportFromCjs(component);var Output=function({regl:e,precision:t,label:r="",width:o,height:s}){this.regl=e,this.precision=t,this.label=r,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map(()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:o,height:s,format:"rgba"}),depthStencil:!1}))};Output.prototype.resize=function(e,t){this.fbos.forEach(r=>{r.resize(e,t)})};Output.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]};Output.prototype.getTexture=function(){var e=this.pingPongIndex?0:1;return this.fbos[e]};Output.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody="",this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this};Output.prototype.render=function(e){let t=e[0];var r=this,o=Object.assign(t.uniforms,{prevBuffer:()=>r.fbos[r.pingPongIndex]});r.draw=r.regl({frag:t.frag,vert:r.vert,attributes:r.attributes,uniforms:o,count:3,framebuffer:()=>(r.pingPongIndex=r.pingPongIndex?0:1,r.fbos[r.pingPongIndex])})};Output.prototype.tick=function(e){this.draw(e)};var inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(t,r){if(r){t.super_=r;var o=function(){};o.prototype=r.prototype,t.prototype=new o,t.prototype.constructor=t}};var inherits_browserExports=inherits_browser.exports;function EventEmitter$1(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var events=EventEmitter$1;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._maxListeners=void 0;EventEmitter$1.defaultMaxListeners=10;EventEmitter$1.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this};EventEmitter$1.prototype.emit=function(e){var t,r,o,s,f,g;if(this._events||(this._events={}),e==="error"&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var S=new Error('Uncaught, unspecified "error" event. ('+t+")");throw S.context=t,S}if(r=this._events[e],isUndefined(r))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(isObject(r))for(s=Array.prototype.slice.call(arguments,1),g=r.slice(),o=g.length,f=0;f<o;f++)g[f].apply(this,s);return!0};EventEmitter$1.prototype.addListener=function(e,t){var r;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(isUndefined(this._maxListeners)?r=EventEmitter$1.defaultMaxListeners:r=this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),typeof console.trace=="function"&&console.trace())),this};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.once=function(e,t){if(!isFunction(t))throw TypeError("listener must be a function");var r=!1;function o(){this.removeListener(e,o),r||(r=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this};EventEmitter$1.prototype.removeListener=function(e,t){var r,o,s,f;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,o=-1,r===t||isFunction(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(r)){for(f=s;f-- >0;)if(r[f]===t||r[f].listener&&r[f].listener===t){o=f;break}if(o<0)return this;r.length===1?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this};EventEmitter$1.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[e]&&delete this._events[e],this;if(arguments.length===0){for(t in this._events)t!=="removeListener"&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],isFunction(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this};EventEmitter$1.prototype.listeners=function(e){var t;return!this._events||!this._events[e]?t=[]:isFunction(this._events[e])?t=[this._events[e]]:t=this._events[e].slice(),t};EventEmitter$1.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0};EventEmitter$1.listenerCount=function(e,t){return e.listenerCount(t)};function isFunction(e){return typeof e=="function"}function isNumber(e){return typeof e=="number"}function isObject(e){return typeof e=="object"&&e!==null}function isUndefined(e){return e===void 0}var browser=commonjsGlobal.performance&&commonjsGlobal.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},raf$2={exports:{}},performanceNow={exports:{}};(function(){var e,t,r,o,s,f;typeof performance<"u"&&performance!==null&&performance.now?performanceNow.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(performanceNow.exports=function(){return(e()-s)/1e6},t=process.hrtime,e=function(){var g;return g=t(),g[0]*1e9+g[1]},o=e(),f=process.uptime()*1e9,s=o-f):Date.now?(performanceNow.exports=function(){return Date.now()-r},r=Date.now()):(performanceNow.exports=function(){return new Date().getTime()-r},r=new Date().getTime())}).call(commonjsGlobal);var performanceNowExports=performanceNow.exports,now$1=performanceNowExports,root=typeof window>"u"?commonjsGlobal:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf$1=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf$1&&i<vendors.length;i++)raf$1=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf$1||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf$1=function(e){if(queue.length===0){var t=now$1(),r=Math.max(0,frameDuration-(t-last));last=r+t,setTimeout(function(){var o=queue.slice(0);queue.length=0;for(var s=0;s<o.length;s++)if(!o[s].cancelled)try{o[s].callback(last)}catch(f){setTimeout(function(){throw f},0)}},Math.round(r))}return queue.push({handle:++id,callback:e,cancelled:!1}),id},caf=function(e){for(var t=0;t<queue.length;t++)queue[t].handle===e&&(queue[t].cancelled=!0)}}raf$2.exports=function(e){return raf$1.call(root,e)};raf$2.exports.cancel=function(){caf.apply(root,arguments)};raf$2.exports.polyfill=function(e){e||(e=root),e.requestAnimationFrame=raf$1,e.cancelAnimationFrame=caf};var rafExports=raf$2.exports,inherits=inherits_browserExports,EventEmitter=events.EventEmitter,now=browser,raf=rafExports,rafLoop=Engine;function Engine(e){if(!(this instanceof Engine))return new Engine(e);this.running=!1,this.last=now(),this._frame=0,this._tick=this.tick.bind(this),e&&this.on("tick",e)}inherits(Engine,EventEmitter);Engine.prototype.start=function(){if(!this.running)return this.running=!0,this.last=now(),this._frame=raf(this._tick),this};Engine.prototype.stop=function(){return this.running=!1,this._frame!==0&&raf.cancel(this._frame),this._frame=0,this};Engine.prototype.tick=function(){this._frame=raf(this._tick);var e=now(),t=e-this.last;this.emit("tick",t),this.last=e};const loop=getDefaultExportFromCjs(rafLoop);function Webcam(e){return navigator.mediaDevices.enumerateDevices().then(t=>t.filter(r=>r.kind==="videoinput")).then(t=>{let r={audio:!1,video:!0};return t[e]&&(r.video={deviceId:{exact:t[e].deviceId}}),window.navigator.mediaDevices.getUserMedia(r)}).then(t=>{const r=document.createElement("video");return r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.setAttribute("playsinline",""),r.srcObject=t,new Promise((o,s)=>{r.addEventListener("loadedmetadata",()=>{r.play().then(()=>o({video:r}))})})}).catch(console.log.bind(console))}function Screen(e){return new Promise(function(t,r){navigator.mediaDevices.getDisplayMedia(e).then(o=>{const s=document.createElement("video");s.srcObject=o,s.addEventListener("loadedmetadata",()=>{s.play(),t({video:s})})}).catch(o=>r(o))})}class HydraSource{constructor({regl:t,width:r,height:o,pb:s,label:f=""}){this.label=f,this.regl=t,this.src=null,this.dynamic=!0,this.width=r,this.height=o,this.tex=this.regl.texture({shape:[1,1]}),this.pb=s}init(t,r){"src"in t&&(this.src=t.src,this.tex=this.regl.texture({data:this.src,...r})),"dynamic"in t&&(this.dynamic=t.dynamic)}initCam(t,r){const o=this;Webcam(t).then(s=>{o.src=s.video,o.dynamic=!0,o.tex=o.regl.texture({data:o.src,...r})}).catch(s=>console.log("could not get camera",s))}initVideo(t="",r){const o=document.createElement("video");o.crossOrigin="anonymous",o.autoplay=!0,o.loop=!0,o.muted=!0,o.addEventListener("loadeddata",()=>{this.src=o,o.play(),this.tex=this.regl.texture({data:this.src,...r}),this.dynamic=!0}),o.src=t}initImage(t="",r){const o=document.createElement("img");o.crossOrigin="anonymous",o.src=t,o.onload=()=>{this.src=o,this.dynamic=!1,this.tex=this.regl.texture({data:this.src,...r})}}initStream(t,r){let o=this;t&&this.pb&&(this.pb.initSource(t),this.pb.on("got video",function(s,f){s===t&&(o.src=f,o.dynamic=!0,o.tex=o.regl.texture({data:o.src,...r}))}))}initScreen(t=0,r){const o=this;Screen().then(function(s){o.src=s.video,o.tex=o.regl.texture({data:o.src,...r}),o.dynamic=!0}).catch(s=>console.log("could not get screen",s))}resize(t,r){this.width=t,this.height=r}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(t=>t.stop()),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(t){this.src!==null&&this.dynamic===!0&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}}const mouse={};function mouseButtons(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}else if("button"in e){var t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}}return 0}mouse.buttons=mouseButtons;function mouseElement(e){return e.target||e.srcElement||window}mouse.element=mouseElement;function mouseRelativeX(e){return typeof e=="object"&&"pageX"in e?e.pageX:0}mouse.x=mouseRelativeX;function mouseRelativeY(e){return typeof e=="object"&&"pageY"in e?e.pageY:0}mouse.y=mouseRelativeY;function mouseListen(e,t){t||(t=e,e=window);var r=0,o=0,s=0,f={shift:!1,alt:!1,control:!1,meta:!1},g=!1;function S(xe){var $e=!1;return"altKey"in xe&&($e=$e||xe.altKey!==f.alt,f.alt=!!xe.altKey),"shiftKey"in xe&&($e=$e||xe.shiftKey!==f.shift,f.shift=!!xe.shiftKey),"ctrlKey"in xe&&($e=$e||xe.ctrlKey!==f.control,f.control=!!xe.ctrlKey),"metaKey"in xe&&($e=$e||xe.metaKey!==f.meta,f.meta=!!xe.metaKey),$e}function P(xe,$e){var _t=mouse.x($e),at=mouse.y($e);"buttons"in $e&&(xe=$e.buttons|0),(xe!==r||_t!==o||at!==s||S($e))&&(r=xe|0,o=_t||0,s=at||0,t&&t(r,o,s,f))}function G(xe){P(0,xe)}function le(){(r||o||s||f.shift||f.alt||f.meta||f.control)&&(o=s=0,r=0,f.shift=f.alt=f.control=f.meta=!1,t&&t(0,0,0,f))}function pe(xe){S(xe)&&t&&t(r,o,s,f)}function Se(xe){mouse.buttons(xe)===0?P(0,xe):P(r,xe)}function Ve(xe){P(r|mouse.buttons(xe),xe)}function Ne(xe){P(r&~mouse.buttons(xe),xe)}function ge(){g||(g=!0,e.addEventListener("mousemove",Se),e.addEventListener("mousedown",Ve),e.addEventListener("mouseup",Ne),e.addEventListener("mouseleave",G),e.addEventListener("mouseenter",G),e.addEventListener("mouseout",G),e.addEventListener("mouseover",G),e.addEventListener("blur",le),e.addEventListener("keyup",pe),e.addEventListener("keydown",pe),e.addEventListener("keypress",pe),e!==window&&(window.addEventListener("blur",le),window.addEventListener("keyup",pe),window.addEventListener("keydown",pe),window.addEventListener("keypress",pe)))}function Je(){g&&(g=!1,e.removeEventListener("mousemove",Se),e.removeEventListener("mousedown",Ve),e.removeEventListener("mouseup",Ne),e.removeEventListener("mouseleave",G),e.removeEventListener("mouseenter",G),e.removeEventListener("mouseout",G),e.removeEventListener("mouseover",G),e.removeEventListener("blur",le),e.removeEventListener("keyup",pe),e.removeEventListener("keydown",pe),e.removeEventListener("keypress",pe),e!==window&&(window.removeEventListener("blur",le),window.removeEventListener("keyup",pe),window.removeEventListener("keydown",pe),window.removeEventListener("keypress",pe)))}ge();var He={element:e};return Object.defineProperties(He,{enabled:{get:function(){return g},set:function(xe){xe?ge():Je()},enumerable:!0},buttons:{get:function(){return r},enumerable:!0},x:{get:function(){return o},enumerable:!0},y:{get:function(){return s},enumerable:!0},mods:{get:function(){return f},enumerable:!0}}),He}var meyda_min={exports:{}};(function(e,t){(function(r,o){e.exports=o()})(commonjsGlobal,function(){function r(O,T,q){if(q||arguments.length===2)for(var D,ae=0,ve=T.length;ae<ve;ae++)!D&&ae in T||(D||(D=Array.prototype.slice.call(T,0,ae)),D[ae]=T[ae]);return O.concat(D||Array.prototype.slice.call(T))}var o=Object.freeze({__proto__:null,blackman:function(O){for(var T=new Float32Array(O),q=2*Math.PI/(O-1),D=2*q,ae=0;ae<O/2;ae++)T[ae]=.42-.5*Math.cos(ae*q)+.08*Math.cos(ae*D);for(ae=Math.ceil(O/2);ae>0;ae--)T[O-ae]=T[ae-1];return T},sine:function(O){for(var T=Math.PI/(O-1),q=new Float32Array(O),D=0;D<O;D++)q[D]=Math.sin(T*D);return q},hanning:function(O){for(var T=new Float32Array(O),q=0;q<O;q++)T[q]=.5-.5*Math.cos(2*Math.PI*q/(O-1));return T},hamming:function(O){for(var T=new Float32Array(O),q=0;q<O;q++)T[q]=.54-.46*Math.cos(2*Math.PI*(q/O-1));return T}}),s={};function f(O){for(;O%2==0&&O>1;)O/=2;return O===1}function g(O,T){if(T!=="rect"){if(T!==""&&T||(T="hanning"),s[T]||(s[T]={}),!s[T][O.length])try{s[T][O.length]=o[T](O.length)}catch{throw new Error("Invalid windowing function")}O=function(q,D){for(var ae=[],ve=0;ve<Math.min(q.length,D.length);ve++)ae[ve]=q[ve]*D[ve];return ae}(O,s[T][O.length])}return O}function S(O,T,q){for(var D=new Float32Array(O),ae=0;ae<D.length;ae++)D[ae]=ae*T/q,D[ae]=13*Math.atan(D[ae]/1315.8)+3.5*Math.atan(Math.pow(D[ae]/7518,2));return D}function P(O){return Float32Array.from(O)}function G(O){return 1125*Math.log(1+O/700)}function le(O,T,q){for(var D,ae=new Float32Array(O+2),ve=new Float32Array(O+2),Oe=T/2,ze=G(0),Me=(G(Oe)-ze)/(O+1),Fe=new Array(O+2),qe=0;qe<ae.length;qe++)ae[qe]=qe*Me,ve[qe]=(D=ae[qe],700*(Math.exp(D/1125)-1)),Fe[qe]=Math.floor((q+1)*ve[qe]/T);for(var gt=new Array(O),We=0;We<gt.length;We++){for(gt[We]=new Array(q/2+1).fill(0),qe=Fe[We];qe<Fe[We+1];qe++)gt[We][qe]=(qe-Fe[We])/(Fe[We+1]-Fe[We]);for(qe=Fe[We+1];qe<Fe[We+2];qe++)gt[We][qe]=(Fe[We+2]-qe)/(Fe[We+2]-Fe[We+1])}return gt}function pe(O,T,q,D,ae,ve,Oe){D===void 0&&(D=5),ae===void 0&&(ae=2),ve===void 0&&(ve=!0),Oe===void 0&&(Oe=440);var ze=Math.floor(q/2)+1,Me=new Array(q).fill(0).map(function(ft,Et){return O*function(wt,Bt){return Math.log2(16*wt/Bt)}(T*Et/q,Oe)});Me[0]=Me[1]-1.5*O;var Fe,qe,gt,We=Me.slice(1).map(function(ft,Et){return Math.max(ft-Me[Et])},1).concat([1]),Nt=Math.round(O/2),Ft=new Array(O).fill(0).map(function(ft,Et){return Me.map(function(wt){return(10*O+Nt+wt-Et)%O-Nt})}),Mt=Ft.map(function(ft,Et){return ft.map(function(wt,Bt){return Math.exp(-.5*Math.pow(2*Ft[Et][Bt]/We[Bt],2))})});if(qe=(Fe=Mt)[0].map(function(){return 0}),gt=Fe.reduce(function(ft,Et){return Et.forEach(function(wt,Bt){ft[Bt]+=Math.pow(wt,2)}),ft},qe).map(Math.sqrt),Mt=Fe.map(function(ft,Et){return ft.map(function(wt,Bt){return wt/(gt[Bt]||1)})}),ae){var Cr=Me.map(function(ft){return Math.exp(-.5*Math.pow((ft/O-D)/ae,2))});Mt=Mt.map(function(ft){return ft.map(function(Et,wt){return Et*Cr[wt]})})}return ve&&(Mt=r(r([],Mt.slice(3),!0),Mt.slice(0,3),!0)),Mt.map(function(ft){return ft.slice(0,ze)})}function Se(O,T){for(var q=0,D=0,ae=0;ae<T.length;ae++)q+=Math.pow(ae,O)*Math.abs(T[ae]),D+=T[ae];return q/D}function Ve(O){var T=O.ampSpectrum,q=O.barkScale,D=O.numberOfBarkBands,ae=D===void 0?24:D;if(typeof T!="object"||typeof q!="object")throw new TypeError;var ve=ae,Oe=new Float32Array(ve),ze=0,Me=T,Fe=new Int32Array(ve+1);Fe[0]=0;for(var qe=q[Me.length-1]/ve,gt=1,We=0;We<Me.length;We++)for(;q[We]>qe;)Fe[gt++]=We,qe=gt*q[Me.length-1]/ve;for(Fe[ve]=Me.length-1,We=0;We<ve;We++){for(var Nt=0,Ft=Fe[We];Ft<Fe[We+1];Ft++)Nt+=Me[Ft];Oe[We]=Math.pow(Nt,.23)}for(We=0;We<Oe.length;We++)ze+=Oe[We];return{specific:Oe,total:ze}}function Ne(O){var T=O.ampSpectrum;if(typeof T!="object")throw new TypeError;for(var q=new Float32Array(T.length),D=0;D<q.length;D++)q[D]=Math.pow(T[D],2);return q}function ge(O){var T=O.ampSpectrum,q=O.melFilterBank,D=O.bufferSize;if(typeof T!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof q!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var ae=Ne({ampSpectrum:T}),ve=q.length,Oe=Array(ve),ze=new Float32Array(ve),Me=0;Me<ze.length;Me++){Oe[Me]=new Float32Array(D/2),ze[Me]=0;for(var Fe=0;Fe<D/2;Fe++)Oe[Me][Fe]=q[Me][Fe]*ae[Fe],ze[Me]+=Oe[Me][Fe];ze[Me]=Math.log(ze[Me]+1)}return Array.prototype.slice.call(ze)}function Je(O){return O&&O.__esModule&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O}var He={},xe=null,$e=function(O,T){var q=O.length;return T=T||2,xe&&xe[q]||function(D){(xe=xe||{})[D]=new Array(D*D);for(var ae=Math.PI/D,ve=0;ve<D;ve++)for(var Oe=0;Oe<D;Oe++)xe[D][Oe+ve*D]=Math.cos(ae*(Oe+.5)*ve)}(q),O.map(function(){return 0}).map(function(D,ae){return T*O.reduce(function(ve,Oe,ze,Me){return ve+Oe*xe[q][ze+ae*q]},0)})};(function(O){O.exports=$e})({get exports(){return He},set exports(O){He=O}});var _t=Je(He),at=Object.freeze({__proto__:null,buffer:function(O){return O.signal},rms:function(O){var T=O.signal;if(typeof T!="object")throw new TypeError;for(var q=0,D=0;D<T.length;D++)q+=Math.pow(T[D],2);return q/=T.length,q=Math.sqrt(q)},energy:function(O){var T=O.signal;if(typeof T!="object")throw new TypeError;for(var q=0,D=0;D<T.length;D++)q+=Math.pow(Math.abs(T[D]),2);return q},complexSpectrum:function(O){return O.complexSpectrum},spectralSlope:function(O){var T=O.ampSpectrum,q=O.sampleRate,D=O.bufferSize;if(typeof T!="object")throw new TypeError;for(var ae=0,ve=0,Oe=new Float32Array(T.length),ze=0,Me=0,Fe=0;Fe<T.length;Fe++){ae+=T[Fe];var qe=Fe*q/D;Oe[Fe]=qe,ze+=qe*qe,ve+=qe,Me+=qe*T[Fe]}return(T.length*Me-ve*ae)/(ae*(ze-Math.pow(ve,2)))},spectralCentroid:function(O){var T=O.ampSpectrum;if(typeof T!="object")throw new TypeError;return Se(1,T)},spectralRolloff:function(O){var T=O.ampSpectrum,q=O.sampleRate;if(typeof T!="object")throw new TypeError;for(var D=T,ae=q/(2*(D.length-1)),ve=0,Oe=0;Oe<D.length;Oe++)ve+=D[Oe];for(var ze=.99*ve,Me=D.length-1;ve>ze&&Me>=0;)ve-=D[Me],--Me;return(Me+1)*ae},spectralFlatness:function(O){var T=O.ampSpectrum;if(typeof T!="object")throw new TypeError;for(var q=0,D=0,ae=0;ae<T.length;ae++)q+=Math.log(T[ae]),D+=T[ae];return Math.exp(q/T.length)*T.length/D},spectralSpread:function(O){var T=O.ampSpectrum;if(typeof T!="object")throw new TypeError;return Math.sqrt(Se(2,T)-Math.pow(Se(1,T),2))},spectralSkewness:function(O){var T=O.ampSpectrum;if(typeof T!="object")throw new TypeError;var q=Se(1,T),D=Se(2,T),ae=Se(3,T);return(2*Math.pow(q,3)-3*q*D+ae)/Math.pow(Math.sqrt(D-Math.pow(q,2)),3)},spectralKurtosis:function(O){var T=O.ampSpectrum;if(typeof T!="object")throw new TypeError;var q=T,D=Se(1,q),ae=Se(2,q),ve=Se(3,q),Oe=Se(4,q);return(-3*Math.pow(D,4)+6*D*ae-4*D*ve+Oe)/Math.pow(Math.sqrt(ae-Math.pow(D,2)),4)},amplitudeSpectrum:function(O){return O.ampSpectrum},zcr:function(O){var T=O.signal;if(typeof T!="object")throw new TypeError;for(var q=0,D=1;D<T.length;D++)(T[D-1]>=0&&T[D]<0||T[D-1]<0&&T[D]>=0)&&q++;return q},loudness:Ve,perceptualSpread:function(O){for(var T=Ve({ampSpectrum:O.ampSpectrum,barkScale:O.barkScale}),q=0,D=0;D<T.specific.length;D++)T.specific[D]>q&&(q=T.specific[D]);return Math.pow((T.total-q)/T.total,2)},perceptualSharpness:function(O){for(var T=Ve({ampSpectrum:O.ampSpectrum,barkScale:O.barkScale}),q=T.specific,D=0,ae=0;ae<q.length;ae++)D+=ae<15?(ae+1)*q[ae+1]:.066*Math.exp(.171*(ae+1));return D*=.11/T.total},powerSpectrum:Ne,mfcc:function(O){var T=O.ampSpectrum,q=O.melFilterBank,D=O.numberOfMFCCCoefficients,ae=O.bufferSize,ve=Math.min(40,Math.max(1,D||13));if(q.length<ve)throw new Error("Insufficient filter bank for requested number of coefficients");var Oe=ge({ampSpectrum:T,melFilterBank:q,bufferSize:ae});return _t(Oe).slice(0,ve)},chroma:function(O){var T=O.ampSpectrum,q=O.chromaFilterBank;if(typeof T!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof q!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var D=q.map(function(ve,Oe){return T.reduce(function(ze,Me,Fe){return ze+Me*ve[Fe]},0)}),ae=Math.max.apply(Math,D);return ae?D.map(function(ve){return ve/ae}):D},spectralFlux:function(O){var T=O.signal,q=O.previousSignal,D=O.bufferSize;if(typeof T!="object"||typeof q!="object")throw new TypeError;for(var ae=0,ve=-D/2;ve<T.length/2-1;ve++)x=Math.abs(T[ve])-Math.abs(q[ve]),ae+=(x+Math.abs(x))/2;return ae},spectralCrest:function(O){var T=O.ampSpectrum;if(typeof T!="object")throw new TypeError;var q=0,D=-1/0;return T.forEach(function(ae){q+=Math.pow(ae,2),D=ae>D?ae:D}),q/=T.length,q=Math.sqrt(q),D/q},melBands:ge});function bt(O){if(Array.isArray(O)){for(var T=0,q=Array(O.length);T<O.length;T++)q[T]=O[T];return q}return Array.from(O)}var Qe={},et={},Ot={bitReverseArray:function(O){if(Qe[O]===void 0){for(var T=(O-1).toString(2).length,q="0".repeat(T),D={},ae=0;ae<O;ae++){var ve=ae.toString(2);ve=q.substr(ve.length)+ve,ve=[].concat(bt(ve)).reverse().join(""),D[ae]=parseInt(ve,2)}Qe[O]=D}return Qe[O]},multiply:function(O,T){return{real:O.real*T.real-O.imag*T.imag,imag:O.real*T.imag+O.imag*T.real}},add:function(O,T){return{real:O.real+T.real,imag:O.imag+T.imag}},subtract:function(O,T){return{real:O.real-T.real,imag:O.imag-T.imag}},euler:function(O,T){var q=-2*Math.PI*O/T;return{real:Math.cos(q),imag:Math.sin(q)}},conj:function(O){return O.imag*=-1,O},constructComplexArray:function(O){var T={};T.real=O.real===void 0?O.slice():O.real.slice();var q=T.real.length;return et[q]===void 0&&(et[q]=Array.apply(null,Array(q)).map(Number.prototype.valueOf,0)),T.imag=et[q].slice(),T}},tt=function(O){var T={};O.real===void 0||O.imag===void 0?T=Ot.constructComplexArray(O):(T.real=O.real.slice(),T.imag=O.imag.slice());var q=T.real.length,D=Math.log2(q);if(Math.round(D)!=D)throw new Error("Input size must be a power of 2.");if(T.real.length!=T.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var ae=Ot.bitReverseArray(q),ve={real:[],imag:[]},Oe=0;Oe<q;Oe++)ve.real[ae[Oe]]=T.real[Oe],ve.imag[ae[Oe]]=T.imag[Oe];for(var ze=0;ze<q;ze++)T.real[ze]=ve.real[ze],T.imag[ze]=ve.imag[ze];for(var Me=1;Me<=D;Me++)for(var Fe=Math.pow(2,Me),qe=0;qe<Fe/2;qe++)for(var gt=Ot.euler(qe,Fe),We=0;We<q/Fe;We++){var Nt=Fe*We+qe,Ft=Fe*We+qe+Fe/2,Mt={real:T.real[Nt],imag:T.imag[Nt]},Cr={real:T.real[Ft],imag:T.imag[Ft]},ft=Ot.multiply(gt,Cr),Et=Ot.subtract(Mt,ft);T.real[Ft]=Et.real,T.imag[Ft]=Et.imag;var wt=Ot.add(ft,Mt);T.real[Nt]=wt.real,T.imag[Nt]=wt.imag}return T},Sn=tt,Hr=function(){function O(T,q){var D=this;if(this._m=q,!T.audioContext)throw this._m.errors.noAC;if(T.bufferSize&&!f(T.bufferSize))throw this._m._errors.notPow2;if(!T.source)throw this._m._errors.noSource;this._m.audioContext=T.audioContext,this._m.bufferSize=T.bufferSize||this._m.bufferSize||256,this._m.hopSize=T.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=T.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=T.callback,this._m.windowingFunction=T.windowingFunction||"hanning",this._m.featureExtractors=at,this._m.EXTRACTION_STARTED=T.startImmediately||!1,this._m.channel=typeof T.channel=="number"?T.channel:0,this._m.inputs=T.inputs||1,this._m.outputs=T.outputs||1,this._m.numberOfMFCCCoefficients=T.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=T.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=T.featureExtractors||[],this._m.barkScale=S(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=le(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(T.source),this._m.spn.onaudioprocess=function(ae){var ve;D._m.inputData!==null&&(D._m.previousInputData=D._m.inputData),D._m.inputData=ae.inputBuffer.getChannelData(D._m.channel),D._m.previousInputData?((ve=new Float32Array(D._m.previousInputData.length+D._m.inputData.length-D._m.hopSize)).set(D._m.previousInputData.slice(D._m.hopSize)),ve.set(D._m.inputData,D._m.previousInputData.length-D._m.hopSize)):ve=D._m.inputData,function(Oe,ze,Me){if(Oe.length<ze)throw new Error("Buffer is too short for frame length");if(Me<1)throw new Error("Hop length cannot be less that 1");if(ze<1)throw new Error("Frame length cannot be less that 1");var Fe=1+Math.floor((Oe.length-ze)/Me);return new Array(Fe).fill(0).map(function(qe,gt){return Oe.slice(gt*Me,gt*Me+ze)})}(ve,D._m.bufferSize,D._m.hopSize).forEach(function(Oe){D._m.frame=Oe;var ze=D._m.extract(D._m._featuresToExtract,D._m.frame,D._m.previousFrame);typeof D._m.callback=="function"&&D._m.EXTRACTION_STARTED&&D._m.callback(ze),D._m.previousFrame=D._m.frame})}}return O.prototype.start=function(T){this._m._featuresToExtract=T||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},O.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},O.prototype.setSource=function(T){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=T,this._m.source.connect(this._m.spn)},O.prototype.setChannel=function(T){T<=this._m.inputs?this._m.channel=T:console.error("Channel ".concat(T," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(T," when instantiating the MeydaAnalyzer"))},O.prototype.get=function(T){return this._m.inputData?this._m.extract(T||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},O}(),Lr={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:at,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:g,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(O){return new Hr(O,Object.assign({},Lr))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(O,T,q){var D=this;if(!T)throw this._errors.invalidInput;if(typeof T!="object")throw this._errors.invalidInput;if(!O)throw this._errors.featureUndef;if(!f(T.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=S(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=le(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=pe(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in T&&T.buffer===void 0?this.signal=P(T):this.signal=T;var ae=Jt(T,this.windowingFunction,this.bufferSize);if(this.signal=ae.windowedSignal,this.complexSpectrum=ae.complexSpectrum,this.ampSpectrum=ae.ampSpectrum,q){var ve=Jt(q,this.windowingFunction,this.bufferSize);this.previousSignal=ve.windowedSignal,this.previousComplexSpectrum=ve.complexSpectrum,this.previousAmpSpectrum=ve.ampSpectrum}var Oe=function(ze){return D.featureExtractors[ze]({ampSpectrum:D.ampSpectrum,chromaFilterBank:D.chromaFilterBank,complexSpectrum:D.complexSpectrum,signal:D.signal,bufferSize:D.bufferSize,sampleRate:D.sampleRate,barkScale:D.barkScale,melFilterBank:D.melFilterBank,previousSignal:D.previousSignal,previousAmpSpectrum:D.previousAmpSpectrum,previousComplexSpectrum:D.previousComplexSpectrum,numberOfMFCCCoefficients:D.numberOfMFCCCoefficients,numberOfBarkBands:D.numberOfBarkBands})};if(typeof O=="object")return O.reduce(function(ze,Me){var Fe;return Object.assign({},ze,((Fe={})[Me]=Oe(Me),Fe))},{});if(typeof O=="string")return Oe(O);throw this._errors.invalidFeatureFmt}},Jt=function(O,T,q){var D={};O.buffer===void 0?D.signal=P(O):D.signal=O,D.windowedSignal=g(D.signal,T),D.complexSpectrum=Sn(D.windowedSignal),D.ampSpectrum=new Float32Array(q/2);for(var ae=0;ae<q/2;ae++)D.ampSpectrum[ae]=Math.sqrt(Math.pow(D.complexSpectrum.real[ae],2)+Math.pow(D.complexSpectrum.imag[ae],2));return D};return typeof window<"u"&&(window.Meyda=Lr),Lr})})(meyda_min);var meyda_minExports=meyda_min.exports;const Meyda=getDefaultExportFromCjs(meyda_minExports);class Audio{constructor({numBins:t=4,cutoff:r=2,smooth:o=.4,max:s=15,scale:f=10,isDrawing:g=!1,parentEl:S=document.body}){this.vol=0,this.scale=f,this.max=s,this.cutoff=r,this.smooth=o,this.setBins(t),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",S.appendChild(this.canvas),this.isDrawing=g,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(P=>{this.stream=P,this.context=new AudioContext;let G=this.context.createMediaStreamSource(P);this.meyda=Meyda.createMeydaAnalyzer({audioContext:this.context,source:G,featureExtractors:["loudness"]})}).catch(P=>console.log("ERROR",P))}detectBeat(t){t>this.beat._cutoff&&t>this.beat.threshold?(this.onBeat(),this.beat._cutoff=t*1.2,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var t=this.meyda.get();if(t&&t!==null){this.vol=t.loudness.total,this.detectBeat(this.vol);const r=(s,f)=>s+f;let o=Math.floor(t.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((s,f)=>t.loudness.specific.slice(f*o,(f+1)*o).reduce(r)).map((s,f)=>s*(1-this.settings[f].smooth)+this.prevBins[f]*this.settings[f].smooth),this.fft=this.bins.map((s,f)=>Math.max(0,(s-this.settings[f].cutoff)/this.settings[f].scale)),this.isDrawing&&this.draw()}}}setCutoff(t){this.cutoff=t,this.settings=this.settings.map(r=>(r.cutoff=t,r))}setSmooth(t){this.smooth=t,this.settings=this.settings.map(r=>(r.smooth=t,r))}setBins(t){this.bins=Array(t).fill(0),this.prevBins=Array(t).fill(0),this.fft=Array(t).fill(0),this.settings=Array(t).fill(0).map(()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth})),this.bins.forEach((r,o)=>{window["a"+o]=(s=1,f=0)=>()=>a.fft[o]*s+f})}setScale(t){this.scale=t,this.settings=this.settings.map(r=>(r.scale=t,r))}setMax(t){this.max=t,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var t=this.canvas.width/this.bins.length,r=this.canvas.height/(this.max*2);this.bins.forEach((o,s)=>{var f=o*r;this.ctx.fillRect(s*t,this.canvas.height-f,t,f);var g=this.canvas.height-r*this.settings[s].cutoff;this.ctx.beginPath(),this.ctx.moveTo(s*t,g),this.ctx.lineTo((s+1)*t,g),this.ctx.stroke();var S=this.canvas.height-r*(this.settings[s].scale+this.settings[s].cutoff);this.ctx.beginPath(),this.ctx.moveTo(s*t,S),this.ctx.lineTo((s+1)*t,S),this.ctx.stroke()})}}class VideoRecorder{constructor(t){this.mediaSource=new MediaSource,this.stream=t,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let r=this;this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),r.sourceBuffer=r.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)})}start(){let t={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,t)}catch(r){console.log("Unable to create MediaRecorder with options Object: ",r);try{t={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,t)}catch(o){console.log("Unable to create MediaRecorder with options Object: ",o);try{t="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,t)}catch(s){alert(`MediaRecorder is not supported by this browser.

Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.`),console.error("Exception while creating MediaRecorder:",s);return}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",t),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){const t=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),r=window.URL.createObjectURL(t);this.output.src=r;const o=document.createElement("a");o.style.display="none",o.href=r;let s=new Date;o.download=`hydra-${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}-${s.getHours()}.${s.getMinutes()}.${s.getSeconds()}.webm`,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(r)},300)}_handleDataAvailable(t){t.data&&t.data.size>0&&this.recordedBlobs.push(t.data)}}const easing={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:-1+(4-2*e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}};var map=(e,t,r,o,s)=>(e-t)*(s-o)/(r-t)+o;const ArrayUtils={init:()=>{Array.prototype.fast=function(e=1){return this._speed=e,this},Array.prototype.smooth=function(e=1){return this._smooth=e,this},Array.prototype.ease=function(e="linear"){return typeof e=="function"?(this._smooth=1,this._ease=e):easing[e]&&(this._smooth=1,this._ease=easing[e]),this},Array.prototype.offset=function(e=.5){return this._offset=e%1,this},Array.prototype.fit=function(e=0,t=1){let r=Math.min(...this),o=Math.max(...this);var s=this.map(f=>map(f,r,o,e,t));return s._speed=this._speed,s._smooth=this._smooth,s._ease=this._ease,s}},getValue:(e=[])=>({time:t,bpm:r})=>{let o=e._speed?e._speed:1,s=e._smooth?e._smooth:0,f=t*o*(r/60)+(e._offset||0);if(s!==0){let g=e._ease?e._ease:easing.linear,S=f-s/2,P=e[Math.floor(S%e.length)],G=e[Math.floor((S+1)%e.length)],le=Math.min(S%1/s,1);return g(le)*(G-P)+P}else return e[Math.floor(f%e.length)],e[Math.floor(f%e.length)]}},Sandbox=parent=>{var initialCode="",sandbox=createSandbox(initialCode),addToContext=(e,t)=>{initialCode+=`
      var ${e} = ${t}
    `,sandbox=createSandbox(initialCode)};return{addToContext,eval:e=>sandbox.eval(e)};function createSandbox(initial){eval(initial);var localEval=function(code){eval(code)};return{eval:localEval}}};class EvalSandbox{constructor(t,r,o=[]){this.makeGlobal=r,this.sandbox=Sandbox(),this.parent=t;var s=Object.keys(t);s.forEach(f=>this.add(f)),this.userProps=o}add(t){this.makeGlobal&&(window[t]=this.parent[t]),this.sandbox.addToContext(t,`parent.${t}`)}set(t,r){this.makeGlobal&&(window[t]=r),this.parent[t]=r}tick(){this.makeGlobal&&this.userProps.forEach(t=>{this.parent[t]=window[t]})}eval(t){this.sandbox.eval(t)}}const DEFAULT_CONVERSIONS={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}},ensure_decimal_dot=e=>(e=e.toString(),e.indexOf(".")<0&&(e+="."),e);function formatArguments(e,t,r){const o=e.transform.inputs,s=e.userArgs,{generators:f}=e.synth,{src:g}=f;return o.map((S,P)=>{const G={value:S.default,type:S.type,isUniform:!1,name:S.name,vecLen:0};if(G.type==="float"&&(G.value=ensure_decimal_dot(S.default)),S.type.startsWith("vec"))try{G.vecLen=Number.parseInt(S.type.substr(3))}catch{console.log(`Error determining length of vector input type ${S.type} (${S.name})`)}if(s.length>P&&(G.value=s[P],typeof s[P]=="function"?(G.value=(Se,Ve,Ne)=>{try{const ge=s[P](Ve);return typeof ge=="number"?ge:(console.warn("function does not return a number",s[P]),S.default)}catch(ge){return console.warn("ERROR",ge),S.default}},G.isUniform=!0):s[P].constructor===Array&&(G.value=(Se,Ve,Ne)=>ArrayUtils.getValue(s[P])(Ve),G.isUniform=!0)),!(t<0)){if(G.value&&G.value.transforms){const Se=G.value.transforms[G.value.transforms.length-1];if(Se.transform.glsl_return_type!==S.type){const Ve=DEFAULT_CONVERSIONS[S.type];if(typeof Ve<"u"){const Ne=Ve[Se.transform.glsl_return_type];if(typeof Ne<"u"){const{name:ge,args:Je}=Ne;G.value=G.value[ge](...Je)}}}G.isUniform=!1}else if(G.type==="float"&&typeof G.value=="number")G.value=ensure_decimal_dot(G.value);else if(G.type.startsWith("vec")&&typeof G.value=="object"&&Array.isArray(G.value))G.isUniform=!1,G.value=`${G.type}(${G.value.map(ensure_decimal_dot).join(", ")})`;else if(S.type==="sampler2D"){var le=G.value;G.value=()=>le.getTexture(),G.isUniform=!0}else if(G.value.getTexture&&S.type==="vec4"){var pe=G.value;G.value=g(pe),G.isUniform=!1}G.isUniform&&(G.name+=t)}return G})}function generateGlsl(e){var t={uniforms:[],glslFunctions:[],fragColor:""},r=generateGlsl$1(e,t)("st");t.fragColor=r;let o={};return t.uniforms.forEach(s=>o[s.name]=s),t.uniforms=Object.values(o),t}function generateGlsl$1(e,t){var r=()=>"";return e.forEach(o=>{var s=formatArguments(o,t.uniforms.length);s.forEach(S=>{S.isUniform&&t.uniforms.push(S)}),contains(o,t.glslFunctions)||t.glslFunctions.push(o);var f=r;if(o.transform.type==="src")r=S=>`${shaderString(S,o.name,s,t)}`;else if(o.transform.type==="coord")r=S=>`${f(`${shaderString(S,o.name,s,t)}`)}`;else if(o.transform.type==="color")r=S=>`${shaderString(`${f(S)}`,o.name,s,t)}`;else if(o.transform.type==="combine"){var g=s[0].value&&s[0].value.transforms?S=>`${generateGlsl$1(s[0].value.transforms,t)(S)}`:s[0].isUniform?()=>s[0].name:()=>s[0].value;r=S=>`${shaderString(`${f(S)}, ${g(S)}`,o.name,s.slice(1),t)}`}else if(o.transform.type==="combineCoord"){var g=s[0].value&&s[0].value.transforms?P=>`${generateGlsl$1(s[0].value.transforms,t)(P)}`:s[0].isUniform?()=>s[0].name:()=>s[0].value;r=P=>`${f(`${shaderString(`${P}, ${g(P)}`,o.name,s.slice(1),t)}`)}`}}),r}function shaderString(e,t,r,o){const s=r.map(f=>f.isUniform?f.name:f.value&&f.value.transforms?`${generateGlsl$1(f.value.transforms,o)("st")}`:f.value).reduce((f,g)=>`${f}, ${g}`,"");return`${t}(${e}${s})`}function contains(e,t){for(var r=0;r<t.length;r++)if(e.name==t[r].name)return!0;return!1}const utilityGlsl={_luminance:{type:"util",glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }`},_noise:{type:"util",glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    `},_rgbToHsv:{type:"util",glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }`},_hsvToRgb:{type:"util",glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }`}};var GlslSource=function(e){return this.transforms=[],this.transforms.push(e),this.defaultOutput=e.defaultOutput,this.synth=e.synth,this.type="GlslSource",this.defaultUniforms=e.defaultUniforms,this};GlslSource.prototype.addTransform=function(e){this.transforms.push(e)};GlslSource.prototype.out=function(e){var t=e||this.defaultOutput,r=this.glsl(t);if(this.synth.currentFunctions=[],t)try{t.render(r)}catch(o){console.log("shader could not compile",o)}};GlslSource.prototype.glsl=function(){var e=[],t=[];return this.transforms.forEach(r=>{r.transform.type==="renderpass"?console.warn("no support for renderpass"):t.push(r)}),t.length>0&&e.push(this.compile(t)),e};GlslSource.prototype.compile=function(e){var t=generateGlsl(e,this.synth),r={};t.uniforms.forEach(s=>{r[s.name]=s.value});var o=`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(t.uniforms).map(s=>{let f=s.type;switch(s.type){case"texture":f="sampler2D";break}return`
      uniform ${f} ${s.name};`}).join("")}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(utilityGlsl).map(s=>`
            ${s.glsl}
          `).join("")}

  ${t.glslFunctions.map(s=>`
            ${s.transform.glsl}
          `).join("")}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${t.fragColor};
  }
  `;return{frag:o,uniforms:Object.assign({},this.defaultUniforms,r)}};const glslFunctions=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}];class GeneratorFactory{constructor({defaultUniforms:t,defaultOutput:r,extendTransforms:o=[],changeListener:s=()=>{}}={}){this.defaultOutput=r,this.defaultUniforms=t,this.changeListener=s,this.extendTransforms=o,this.generators={},this.init()}init(){const t=glslFunctions();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((r,[o,s])=>(this.changeListener({type:"remove",synth:this,method:o}),r),{}),this.sourceClass=(()=>class extends GlslSource{})(),Array.isArray(this.extendTransforms)?t.concat(this.extendTransforms):typeof this.extendTransforms=="object"&&this.extendTransforms.type&&t.push(this.extendTransforms),t.map(r=>this.setFunction(r))}_addMethod(t,r){const o=this;if(this.glslTransforms[t]=r,r.type==="src"){const s=(...f)=>new this.sourceClass({name:t,transform:r,userArgs:f,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:o});return this.generators[t]=s,this.changeListener({type:"add",synth:this,method:t}),s}else this.sourceClass.prototype[t]=function(...s){return this.transforms.push({name:t,transform:r,userArgs:s,synth:o}),this}}setFunction(t){var r=processGlsl(t);r&&this._addMethod(t.name,r)}}const typeLookup={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};function processGlsl(e){let t=typeLookup[e.type];if(t){let r=t.args.map(g=>g).join(", "),o=e.inputs.map(g=>`${g.type} ${g.name}`).join(", "),s=`${r}${o.length>0?", "+o:""}`,f=`
  ${t.returnType} ${e.name}(${s}) {
      ${e.glsl}
  }
`;return(e.type==="combine"||e.type==="combineCoord")&&e.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},e,{glsl:f})}else console.warn(`type ${e.type} not recognized`,e)}var regl$1={exports:{}};(function(e,t){(function(r,o){e.exports=o()})(commonjsGlobal,function(){var r=function(n){return n instanceof Uint8Array||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array||n instanceof Float32Array||n instanceof Float64Array||n instanceof Uint8ClampedArray},o=function(n,c){for(var v=Object.keys(c),N=0;N<v.length;++N)n[v[N]]=c[v[N]];return n},s=`
`;function f(n){return typeof atob<"u"?atob(n):"base64:"+n}function g(n){var c=new Error("(regl) "+n);throw console.error(c),c}function S(n,c){n||g(c)}function P(n){return n?": "+n:""}function G(n,c,v){n in c||g("unknown parameter ("+n+")"+P(v)+". possible values: "+Object.keys(c).join())}function le(n,c){r(n)||g("invalid parameter type"+P(c)+". must be a typed array")}function pe(n,c){switch(c){case"number":return typeof n=="number";case"object":return typeof n=="object";case"string":return typeof n=="string";case"boolean":return typeof n=="boolean";case"function":return typeof n=="function";case"undefined":return typeof n>"u";case"symbol":return typeof n=="symbol"}}function Se(n,c,v){pe(n,c)||g("invalid parameter type"+P(v)+". expected "+c+", got "+typeof n)}function Ve(n,c){n>=0&&(n|0)===n||g("invalid parameter type, ("+n+")"+P(c)+". must be a nonnegative integer")}function Ne(n,c,v){c.indexOf(n)<0&&g("invalid value"+P(v)+". must be one of: "+c)}var ge=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Je(n){Object.keys(n).forEach(function(c){ge.indexOf(c)<0&&g('invalid regl constructor argument "'+c+'". must be one of '+ge)})}function He(n,c){for(n=n+"";n.length<c;)n=" "+n;return n}function xe(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function $e(n,c){this.number=n,this.line=c,this.errors=[]}function _t(n,c,v){this.file=n,this.line=c,this.message=v}function at(){var n=new Error,c=(n.stack||n).toString(),v=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(c);if(v)return v[1];var N=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(c);return N?N[1]:"unknown"}function bt(){var n=new Error,c=(n.stack||n).toString(),v=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(c);if(v)return v[1];var N=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(c);return N?N[1]:"unknown"}function Qe(n,c){var v=n.split(`
`),N=1,V=0,I={unknown:new xe,0:new xe};I.unknown.name=I[0].name=c||at(),I.unknown.lines.push(new $e(0,""));for(var k=0;k<v.length;++k){var K=v[k],Z=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(K);if(Z)switch(Z[1]){case"line":var re=/(\d+)(\s+\d+)?/.exec(Z[2]);re&&(N=re[1]|0,re[2]&&(V=re[2]|0,V in I||(I[V]=new xe)));break;case"define":var J=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Z[2]);J&&(I[V].name=J[1]?f(J[2]):J[2]);break}I[V].lines.push(new $e(N++,K))}return Object.keys(I).forEach(function(ie){var ue=I[ie];ue.lines.forEach(function(Q){ue.index[Q.number]=Q})}),I}function et(n){var c=[];return n.split(`
`).forEach(function(v){if(!(v.length<5)){var N=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(v);N?c.push(new _t(N[1]|0,N[2]|0,N[3].trim())):v.length>0&&c.push(new _t("unknown",0,v))}}),c}function Ot(n,c){c.forEach(function(v){var N=n[v.file];if(N){var V=N.index[v.line];if(V){V.errors.push(v),N.hasErrors=!0;return}}n.unknown.hasErrors=!0,n.unknown.lines[0].errors.push(v)})}function tt(n,c,v,N,V){if(!n.getShaderParameter(c,n.COMPILE_STATUS)){var I=n.getShaderInfoLog(c),k=N===n.FRAGMENT_SHADER?"fragment":"vertex";q(v,"string",k+" shader source must be a string",V);var K=Qe(v,V),Z=et(I);Ot(K,Z),Object.keys(K).forEach(function(re){var J=K[re];if(!J.hasErrors)return;var ie=[""],ue=[""];function Q(oe,L){ie.push(oe),ue.push(L||"")}Q("file number "+re+": "+J.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),J.lines.forEach(function(oe){if(oe.errors.length>0){Q(He(oe.number,4)+"|  ","background-color:yellow; font-weight:bold"),Q(oe.line+s,"color:red; background-color:yellow; font-weight:bold");var L=0;oe.errors.forEach(function(B){var te=B.message,he=/^\s*'(.*)'\s*:\s*(.*)$/.exec(te);if(he){var W=he[1];switch(te=he[2],W){case"assign":W="=";break}L=Math.max(oe.line.indexOf(W,L),0)}else L=0;Q(He("| ",6)),Q(He("^^^",L+3)+s,"font-weight:bold"),Q(He("| ",6)),Q(te+s,"font-weight:bold")}),Q(He("| ",6)+s)}else Q(He(oe.number,4)+"|  "),Q(oe.line+s,"color:red")}),typeof document<"u"&&!window.chrome?(ue[0]=ie.join("%c"),console.log.apply(console,ue)):console.log(ie.join(""))}),S.raise("Error compiling "+k+" shader, "+K[0].name)}}function Sn(n,c,v,N,V){if(!n.getProgramParameter(c,n.LINK_STATUS)){var I=n.getProgramInfoLog(c),k=Qe(v,V),K=Qe(N,V),Z='Error linking program with vertex shader, "'+K[0].name+'", and fragment shader "'+k[0].name+'"';typeof document<"u"?console.log("%c"+Z+s+"%c"+I,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Z+s+I),S.raise(Z)}}function Hr(n){n._commandRef=at()}function Lr(n,c,v,N){Hr(n);function V(Z){return Z?N.id(Z):0}n._fragId=V(n.static.frag),n._vertId=V(n.static.vert);function I(Z,re){Object.keys(re).forEach(function(J){Z[N.id(J)]=!0})}var k=n._uniformSet={};I(k,c.static),I(k,c.dynamic);var K=n._attributeSet={};I(K,v.static),I(K,v.dynamic),n._hasCount="count"in n.static||"count"in n.dynamic||"elements"in n.static||"elements"in n.dynamic}function Jt(n,c){var v=bt();g(n+" in command "+(c||at())+(v==="unknown"?"":" called from "+v))}function O(n,c,v){n||Jt(c,v||at())}function T(n,c,v,N){n in c||Jt("unknown parameter ("+n+")"+P(v)+". possible values: "+Object.keys(c).join(),N||at())}function q(n,c,v,N){pe(n,c)||Jt("invalid parameter type"+P(v)+". expected "+c+", got "+typeof n,N||at())}function D(n){n()}function ae(n,c,v){n.texture?Ne(n.texture._texture.internalformat,c,"unsupported texture format for attachment"):Ne(n.renderbuffer._renderbuffer.format,v,"unsupported renderbuffer format for attachment")}var ve=33071,Oe=9728,ze=9984,Me=9985,Fe=9986,qe=9987,gt=5120,We=5121,Nt=5122,Ft=5123,Mt=5124,Cr=5125,ft=5126,Et=32819,wt=32820,Bt=33635,Ta=34042,Ao=36193,Dt={};Dt[gt]=Dt[We]=1,Dt[Nt]=Dt[Ft]=Dt[Ao]=Dt[Bt]=Dt[Et]=Dt[wt]=2,Dt[Mt]=Dt[Cr]=Dt[ft]=Dt[Ta]=4;function Aa(n,c){return n===wt||n===Et||n===Bt?2:n===Ta?4:Dt[n]*c}function Yr(n){return!(n&n-1)&&!!n}function wo(n,c,v){var N,V=c.width,I=c.height,k=c.channels;S(V>0&&V<=v.maxTextureSize&&I>0&&I<=v.maxTextureSize,"invalid texture shape"),(n.wrapS!==ve||n.wrapT!==ve)&&S(Yr(V)&&Yr(I),"incompatible wrap mode for texture, both width and height must be power of 2"),c.mipmask===1?V!==1&&I!==1&&S(n.minFilter!==ze&&n.minFilter!==Fe&&n.minFilter!==Me&&n.minFilter!==qe,"min filter requires mipmap"):(S(Yr(V)&&Yr(I),"texture must be a square power of 2 to support mipmapping"),S(c.mipmask===(V<<1)-1,"missing or incomplete mipmap data")),c.type===ft&&(v.extensions.indexOf("oes_texture_float_linear")<0&&S(n.minFilter===Oe&&n.magFilter===Oe,"filter not supported, must enable oes_texture_float_linear"),S(!n.genMipmaps,"mipmap generation not supported with float textures"));var K=c.images;for(N=0;N<16;++N)if(K[N]){var Z=V>>N,re=I>>N;S(c.mipmask&1<<N,"missing mipmap data");var J=K[N];if(S(J.width===Z&&J.height===re,"invalid shape for mip images"),S(J.format===c.format&&J.internalformat===c.internalformat&&J.type===c.type,"incompatible type for mip image"),!J.compressed)if(J.data){var ie=Math.ceil(Aa(J.type,k)*Z/J.unpackAlignment)*J.unpackAlignment;S(J.data.byteLength===ie*re,"invalid data for image, buffer size is inconsistent with image format")}else J.element||J.copy}else n.genMipmaps||S((c.mipmask&1<<N)===0,"extra mipmap data");c.compressed&&S(!n.genMipmaps,"mipmap generation for compressed images not supported")}function So(n,c,v,N){var V=n.width,I=n.height,k=n.channels;S(V>0&&V<=N.maxTextureSize&&I>0&&I<=N.maxTextureSize,"invalid texture shape"),S(V===I,"cube map must be square"),S(c.wrapS===ve&&c.wrapT===ve,"wrap mode not supported by cube map");for(var K=0;K<v.length;++K){var Z=v[K];S(Z.width===V&&Z.height===I,"inconsistent cube map face shape"),c.genMipmaps&&(S(!Z.compressed,"can not generate mipmap for compressed textures"),S(Z.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var re=Z.images,J=0;J<16;++J){var ie=re[J];if(ie){var ue=V>>J,Q=I>>J;S(Z.mipmask&1<<J,"missing mipmap data"),S(ie.width===ue&&ie.height===Q,"invalid shape for mip images"),S(ie.format===n.format&&ie.internalformat===n.internalformat&&ie.type===n.type,"incompatible type for mip image"),ie.compressed||(ie.data?S(ie.data.byteLength===ue*Q*Math.max(Aa(ie.type,k),ie.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ie.element||ie.copy)}}}}var m=o(S,{optional:D,raise:g,commandRaise:Jt,command:O,parameter:G,commandParameter:T,constructor:Je,type:Se,commandType:q,isTypedArray:le,nni:Ve,oneOf:Ne,shaderError:tt,linkError:Sn,callSite:bt,saveCommandRef:Hr,saveDrawInfo:Lr,framebufferFormat:ae,guessCommand:at,texture2D:wo,textureCube:So}),Ro=0,Lo=0,Co=5,Oo=6;function er(n,c){this.id=Ro++,this.type=n,this.data=c}function wa(n){return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Or(n){if(n.length===0)return[];var c=n.charAt(0),v=n.charAt(n.length-1);if(n.length>1&&c===v&&(c==='"'||c==="'"))return['"'+wa(n.substr(1,n.length-2))+'"'];var N=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(n);if(N)return Or(n.substr(0,N.index)).concat(Or(N[1])).concat(Or(n.substr(N.index+N[0].length)));var V=n.split(".");if(V.length===1)return['"'+wa(n)+'"'];for(var I=[],k=0;k<V.length;++k)I=I.concat(Or(V[k]));return I}function Sa(n){return"["+Or(n).join("][")+"]"}function Fo(n,c){return new er(n,Sa(c+""))}function Mo(n){return typeof n=="function"&&!n._reglType||n instanceof er}function Ra(n,c){if(typeof n=="function")return new er(Lo,n);if(typeof n=="number"||typeof n=="boolean")return new er(Co,n);if(Array.isArray(n))return new er(Oo,n.map((v,N)=>Ra(v,c+"["+N+"]")));if(n instanceof er)return n;m(!1,"invalid option type in uniform "+c)}var It={DynamicVariable:er,define:Fo,isDynamic:Mo,unbox:Ra,accessor:Sa},Rn={next:typeof requestAnimationFrame=="function"?function(n){return requestAnimationFrame(n)}:function(n){return setTimeout(n,16)},cancel:typeof cancelAnimationFrame=="function"?function(n){return cancelAnimationFrame(n)}:clearTimeout},La=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Do(){var n={"":0},c=[""];return{id:function(v){var N=n[v];return N||(N=n[v]=c.length,c.push(v),N)},str:function(v){return c[v]}}}function Io(n,c,v){var N=document.createElement("canvas");o(N.style,{border:0,margin:0,padding:0,top:0,left:0}),n.appendChild(N),n===document.body&&(N.style.position="absolute",o(n.style,{margin:0,padding:0}));function V(){var K=window.innerWidth,Z=window.innerHeight;if(n!==document.body){var re=n.getBoundingClientRect();K=re.right-re.left,Z=re.bottom-re.top}N.width=v*K,N.height=v*Z,o(N.style,{width:K+"px",height:Z+"px"})}var I;n!==document.body&&typeof ResizeObserver=="function"?(I=new ResizeObserver(function(){setTimeout(V)}),I.observe(n)):window.addEventListener("resize",V,!1);function k(){I?I.disconnect():window.removeEventListener("resize",V),n.removeChild(N)}return V(),{canvas:N,onDestroy:k}}function Go(n,c){function v(N){try{return n.getContext(N,c)}catch{return null}}return v("webgl")||v("experimental-webgl")||v("webgl-experimental")}function No(n){return typeof n.nodeName=="string"&&typeof n.appendChild=="function"&&typeof n.getBoundingClientRect=="function"}function $o(n){return typeof n.drawArrays=="function"||typeof n.drawElements=="function"}function Ca(n){return typeof n=="string"?n.split():(m(Array.isArray(n),"invalid extension array"),n)}function Oa(n){return typeof n=="string"?(m(typeof document<"u","not supported outside of DOM"),document.querySelector(n)):n}function ko(n){var c=n||{},v,N,V,I,k={},K=[],Z=[],re=typeof window>"u"?1:window.devicePixelRatio,J=!1,ie=function(oe){oe&&m.raise(oe)},ue=function(){};if(typeof c=="string"?(m(typeof document<"u","selector queries only supported in DOM enviroments"),v=document.querySelector(c),m(v,"invalid query string for element")):typeof c=="object"?No(c)?v=c:$o(c)?(I=c,V=I.canvas):(m.constructor(c),"gl"in c?I=c.gl:"canvas"in c?V=Oa(c.canvas):"container"in c&&(N=Oa(c.container)),"attributes"in c&&(k=c.attributes,m.type(k,"object","invalid context attributes")),"extensions"in c&&(K=Ca(c.extensions)),"optionalExtensions"in c&&(Z=Ca(c.optionalExtensions)),"onDone"in c&&(m.type(c.onDone,"function","invalid or missing onDone callback"),ie=c.onDone),"profile"in c&&(J=!!c.profile),"pixelRatio"in c&&(re=+c.pixelRatio,m(re>0,"invalid pixel ratio"))):m.raise("invalid arguments to regl"),v&&(v.nodeName.toLowerCase()==="canvas"?V=v:N=v),!I){if(!V){m(typeof document<"u","must manually specify webgl context outside of DOM environments");var Q=Io(N||document.body,ie,re);if(!Q)return null;V=Q.canvas,ue=Q.onDestroy}k.premultipliedAlpha===void 0&&(k.premultipliedAlpha=!0),I=Go(V,k)}return I?{gl:I,canvas:V,container:N,extensions:K,optionalExtensions:Z,pixelRatio:re,profile:J,onDone:ie,onDestroy:ue}:(ue(),ie("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Bo(n,c){var v={};function N(k){m.type(k,"string","extension name must be string");var K=k.toLowerCase(),Z;try{Z=v[K]=n.getExtension(K)}catch{}return!!Z}for(var V=0;V<c.extensions.length;++V){var I=c.extensions[V];if(!N(I))return c.onDestroy(),c.onDone('"'+I+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return c.optionalExtensions.forEach(N),{extensions:v,restore:function(){Object.keys(v).forEach(function(k){if(v[k]&&!N(k))throw new Error("(regl): error restoring extension "+k)})}}}function Lt(n,c){for(var v=Array(n),N=0;N<n;++N)v[N]=c(N);return v}var Po=5120,Uo=5121,jo=5122,Vo=5123,zo=5124,Xo=5125,qo=5126;function Wo(n){for(var c=16;c<=1<<28;c*=16)if(n<=c)return c;return 0}function Fa(n){var c,v;return c=(n>65535)<<4,n>>>=c,v=(n>255)<<3,n>>>=v,c|=v,v=(n>15)<<2,n>>>=v,c|=v,v=(n>3)<<1,n>>>=v,c|=v,c|n>>1}function Ma(){var n=Lt(8,function(){return[]});function c(I){var k=Wo(I),K=n[Fa(k)>>2];return K.length>0?K.pop():new ArrayBuffer(k)}function v(I){n[Fa(I.byteLength)>>2].push(I)}function N(I,k){var K=null;switch(I){case Po:K=new Int8Array(c(k),0,k);break;case Uo:K=new Uint8Array(c(k),0,k);break;case jo:K=new Int16Array(c(2*k),0,k);break;case Vo:K=new Uint16Array(c(2*k),0,k);break;case zo:K=new Int32Array(c(4*k),0,k);break;case Xo:K=new Uint32Array(c(4*k),0,k);break;case qo:K=new Float32Array(c(4*k),0,k);break;default:return null}return K.length!==k?K.subarray(0,k):K}function V(I){v(I.buffer)}return{alloc:c,free:v,allocType:N,freeType:V}}var ut=Ma();ut.zero=Ma();var Ho=3408,Yo=3410,Ko=3411,Qo=3412,Zo=3413,Jo=3414,es=3415,ts=33901,rs=33902,ns=3379,as=3386,is=34921,os=36347,ss=36348,fs=35661,us=35660,cs=34930,ls=36349,hs=34076,ds=34024,ms=7936,ps=7937,vs=7938,ys=35724,_s=34047,bs=36063,gs=34852,Kr=3553,Da=34067,Es=34069,xs=33984,Fr=6408,Ln=5126,Ia=5121,Cn=36160,Ts=36053,As=36064,ws=16384,Ss=function(n,c){var v=1;c.ext_texture_filter_anisotropic&&(v=n.getParameter(_s));var N=1,V=1;c.webgl_draw_buffers&&(N=n.getParameter(gs),V=n.getParameter(bs));var I=!!c.oes_texture_float;if(I){var k=n.createTexture();n.bindTexture(Kr,k),n.texImage2D(Kr,0,Fr,1,1,0,Fr,Ln,null);var K=n.createFramebuffer();if(n.bindFramebuffer(Cn,K),n.framebufferTexture2D(Cn,As,Kr,k,0),n.bindTexture(Kr,null),n.checkFramebufferStatus(Cn)!==Ts)I=!1;else{n.viewport(0,0,1,1),n.clearColor(1,0,0,1),n.clear(ws);var Z=ut.allocType(Ln,4);n.readPixels(0,0,1,1,Fr,Ln,Z),n.getError()?I=!1:(n.deleteFramebuffer(K),n.deleteTexture(k),I=Z[0]===1),ut.freeType(Z)}}var re=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),J=!0;if(!re){var ie=n.createTexture(),ue=ut.allocType(Ia,36);n.activeTexture(xs),n.bindTexture(Da,ie),n.texImage2D(Es,0,Fr,3,3,0,Fr,Ia,ue),ut.freeType(ue),n.bindTexture(Da,null),n.deleteTexture(ie),J=!n.getError()}return{colorBits:[n.getParameter(Yo),n.getParameter(Ko),n.getParameter(Qo),n.getParameter(Zo)],depthBits:n.getParameter(Jo),stencilBits:n.getParameter(es),subpixelBits:n.getParameter(Ho),extensions:Object.keys(c).filter(function(Q){return!!c[Q]}),maxAnisotropic:v,maxDrawbuffers:N,maxColorAttachments:V,pointSizeDims:n.getParameter(ts),lineWidthDims:n.getParameter(rs),maxViewportDims:n.getParameter(as),maxCombinedTextureUnits:n.getParameter(fs),maxCubeMapSize:n.getParameter(hs),maxRenderbufferSize:n.getParameter(ds),maxTextureUnits:n.getParameter(cs),maxTextureSize:n.getParameter(ns),maxAttributes:n.getParameter(is),maxVertexUniforms:n.getParameter(os),maxVertexTextureUnits:n.getParameter(us),maxVaryingVectors:n.getParameter(ss),maxFragmentUniforms:n.getParameter(ls),glsl:n.getParameter(ys),renderer:n.getParameter(ps),vendor:n.getParameter(ms),version:n.getParameter(vs),readFloat:I,npotTextureCube:J}};function Pt(n){return!!n&&typeof n=="object"&&Array.isArray(n.shape)&&Array.isArray(n.stride)&&typeof n.offset=="number"&&n.shape.length===n.stride.length&&(Array.isArray(n.data)||r(n.data))}var Gt=function(n){return Object.keys(n).map(function(c){return n[c]})},Qr={shape:Os,flatten:Cs};function Rs(n,c,v){for(var N=0;N<c;++N)v[N]=n[N]}function Ls(n,c,v,N){for(var V=0,I=0;I<c;++I)for(var k=n[I],K=0;K<v;++K)N[V++]=k[K]}function Ga(n,c,v,N,V,I){for(var k=I,K=0;K<c;++K)for(var Z=n[K],re=0;re<v;++re)for(var J=Z[re],ie=0;ie<N;++ie)V[k++]=J[ie]}function Na(n,c,v,N,V){for(var I=1,k=v+1;k<c.length;++k)I*=c[k];var K=c[v];if(c.length-v===4){var Z=c[v+1],re=c[v+2],J=c[v+3];for(k=0;k<K;++k)Ga(n[k],Z,re,J,N,V),V+=I}else for(k=0;k<K;++k)Na(n[k],c,v+1,N,V),V+=I}function Cs(n,c,v,N){var V=1;if(c.length)for(var I=0;I<c.length;++I)V*=c[I];else V=0;var k=N||ut.allocType(v,V);switch(c.length){case 0:break;case 1:Rs(n,c[0],k);break;case 2:Ls(n,c[0],c[1],k);break;case 3:Ga(n,c[0],c[1],c[2],k,0);break;default:Na(n,c,0,k,0)}return k}function Os(n){for(var c=[],v=n;v.length;v=v[0])c.push(v.length);return c}var On={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Fs=5120,Ms=5122,Ds=5124,Is=5121,Gs=5123,Ns=5125,$s=5126,ks=5126,tr={int8:Fs,int16:Ms,int32:Ds,uint8:Is,uint16:Gs,uint32:Ns,float:$s,float32:ks},Bs=35048,Ps=35040,Zr={dynamic:Bs,stream:Ps,static:35044},Fn=Qr.flatten,$a=Qr.shape,ka=35044,Us=35040,Mn=5121,Dn=5126,Ht=[];Ht[5120]=1,Ht[5122]=2,Ht[5124]=4,Ht[5121]=1,Ht[5123]=2,Ht[5125]=4,Ht[5126]=4;function Jr(n){return On[Object.prototype.toString.call(n)]|0}function Ba(n,c){for(var v=0;v<c.length;++v)n[v]=c[v]}function Pa(n,c,v,N,V,I,k){for(var K=0,Z=0;Z<v;++Z)for(var re=0;re<N;++re)n[K++]=c[V*Z+I*re+k]}function js(n,c,v,N){var V=0,I={};function k(L){this.id=V++,this.buffer=n.createBuffer(),this.type=L,this.usage=ka,this.byteLength=0,this.dimension=1,this.dtype=Mn,this.persistentData=null,v.profile&&(this.stats={size:0})}k.prototype.bind=function(){n.bindBuffer(this.type,this.buffer)},k.prototype.destroy=function(){ue(this)};var K=[];function Z(L,B){var te=K.pop();return te||(te=new k(L)),te.bind(),ie(te,B,Us,0,1,!1),te}function re(L){K.push(L)}function J(L,B,te){L.byteLength=B.byteLength,n.bufferData(L.type,B,te)}function ie(L,B,te,he,W,de){var Y;if(L.usage=te,Array.isArray(B)){if(L.dtype=he||Dn,B.length>0){var se;if(Array.isArray(B[0])){Y=$a(B);for(var H=1,fe=1;fe<Y.length;++fe)H*=Y[fe];L.dimension=H,se=Fn(B,Y,L.dtype),J(L,se,te),de?L.persistentData=se:ut.freeType(se)}else if(typeof B[0]=="number"){L.dimension=W;var Ee=ut.allocType(L.dtype,B.length);Ba(Ee,B),J(L,Ee,te),de?L.persistentData=Ee:ut.freeType(Ee)}else r(B[0])?(L.dimension=B[0].length,L.dtype=he||Jr(B[0])||Dn,se=Fn(B,[B.length,B[0].length],L.dtype),J(L,se,te),de?L.persistentData=se:ut.freeType(se)):m.raise("invalid buffer data")}}else if(r(B))L.dtype=he||Jr(B),L.dimension=W,J(L,B,te),de&&(L.persistentData=new Uint8Array(new Uint8Array(B.buffer)));else if(Pt(B)){Y=B.shape;var Re=B.stride,ce=B.offset,ne=0,X=0,we=0,De=0;Y.length===1?(ne=Y[0],X=1,we=Re[0],De=0):Y.length===2?(ne=Y[0],X=Y[1],we=Re[0],De=Re[1]):m.raise("invalid shape"),L.dtype=he||Jr(B.data)||Dn,L.dimension=X;var ye=ut.allocType(L.dtype,ne*X);Pa(ye,B.data,ne,X,we,De,ce),J(L,ye,te),de?L.persistentData=ye:ut.freeType(ye)}else B instanceof ArrayBuffer?(L.dtype=Mn,L.dimension=W,J(L,B,te),de&&(L.persistentData=new Uint8Array(new Uint8Array(B)))):m.raise("invalid buffer data")}function ue(L){c.bufferCount--,N(L);var B=L.buffer;m(B,"buffer must not be deleted already"),n.deleteBuffer(B),L.buffer=null,delete I[L.id]}function Q(L,B,te,he){c.bufferCount++;var W=new k(B);I[W.id]=W;function de(H){var fe=ka,Ee=null,Re=0,ce=0,ne=1;return Array.isArray(H)||r(H)||Pt(H)||H instanceof ArrayBuffer?Ee=H:typeof H=="number"?Re=H|0:H&&(m.type(H,"object","buffer arguments must be an object, a number or an array"),"data"in H&&(m(Ee===null||Array.isArray(Ee)||r(Ee)||Pt(Ee),"invalid data for buffer"),Ee=H.data),"usage"in H&&(m.parameter(H.usage,Zr,"invalid buffer usage"),fe=Zr[H.usage]),"type"in H&&(m.parameter(H.type,tr,"invalid buffer type"),ce=tr[H.type]),"dimension"in H&&(m.type(H.dimension,"number","invalid dimension"),ne=H.dimension|0),"length"in H&&(m.nni(Re,"buffer length must be a nonnegative integer"),Re=H.length|0)),W.bind(),Ee?ie(W,Ee,fe,ce,ne,he):(Re&&n.bufferData(W.type,Re,fe),W.dtype=ce||Mn,W.usage=fe,W.dimension=ne,W.byteLength=Re),v.profile&&(W.stats.size=W.byteLength*Ht[W.dtype]),de}function Y(H,fe){m(fe+H.byteLength<=W.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+H.byteLength+" starting from offset "+fe+" to a buffer of size "+W.byteLength),n.bufferSubData(W.type,fe,H)}function se(H,fe){var Ee=(fe||0)|0,Re;if(W.bind(),r(H)||H instanceof ArrayBuffer)Y(H,Ee);else if(Array.isArray(H)){if(H.length>0)if(typeof H[0]=="number"){var ce=ut.allocType(W.dtype,H.length);Ba(ce,H),Y(ce,Ee),ut.freeType(ce)}else if(Array.isArray(H[0])||r(H[0])){Re=$a(H);var ne=Fn(H,Re,W.dtype);Y(ne,Ee),ut.freeType(ne)}else m.raise("invalid buffer data")}else if(Pt(H)){Re=H.shape;var X=H.stride,we=0,De=0,ye=0,Be=0;Re.length===1?(we=Re[0],De=1,ye=X[0],Be=0):Re.length===2?(we=Re[0],De=Re[1],ye=X[0],Be=X[1]):m.raise("invalid shape");var Le=Array.isArray(H.data)?W.dtype:Jr(H.data),ke=ut.allocType(Le,we*De);Pa(ke,H.data,we,De,ye,Be,H.offset),Y(ke,Ee),ut.freeType(ke)}else m.raise("invalid data for buffer subdata");return de}return te||de(L),de._reglType="buffer",de._buffer=W,de.subdata=se,v.profile&&(de.stats=W.stats),de.destroy=function(){ue(W)},de}function oe(){Gt(I).forEach(function(L){L.buffer=n.createBuffer(),n.bindBuffer(L.type,L.buffer),n.bufferData(L.type,L.persistentData||L.byteLength,L.usage)})}return v.profile&&(c.getTotalBufferSize=function(){var L=0;return Object.keys(I).forEach(function(B){L+=I[B].stats.size}),L}),{create:Q,createStream:Z,destroyStream:re,clear:function(){Gt(I).forEach(ue),K.forEach(ue)},getBuffer:function(L){return L&&L._buffer instanceof k?L._buffer:null},restore:oe,_initBuffer:ie}}var Vs=0,zs=0,Xs=1,Ws=1,Hs=4,Ys=4,hr={points:Vs,point:zs,lines:Xs,line:Ws,triangles:Hs,triangle:Ys,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ks=0,Qs=1,Mr=4,Zs=5120,dr=5121,Ua=5122,mr=5123,ja=5124,rr=5125,In=34963,Js=35040,ef=35044;function tf(n,c,v,N){var V={},I=0,k={uint8:dr,uint16:mr};c.oes_element_index_uint&&(k.uint32=rr);function K(oe){this.id=I++,V[this.id]=this,this.buffer=oe,this.primType=Mr,this.vertCount=0,this.type=0}K.prototype.bind=function(){this.buffer.bind()};var Z=[];function re(oe){var L=Z.pop();return L||(L=new K(v.create(null,In,!0,!1)._buffer)),ie(L,oe,Js,-1,-1,0,0),L}function J(oe){Z.push(oe)}function ie(oe,L,B,te,he,W,de){oe.buffer.bind();var Y;if(L){var se=de;!de&&(!r(L)||Pt(L)&&!r(L.data))&&(se=c.oes_element_index_uint?rr:mr),v._initBuffer(oe.buffer,L,B,se,3)}else n.bufferData(In,W,B),oe.buffer.dtype=Y||dr,oe.buffer.usage=B,oe.buffer.dimension=3,oe.buffer.byteLength=W;if(Y=de,!de){switch(oe.buffer.dtype){case dr:case Zs:Y=dr;break;case mr:case Ua:Y=mr;break;case rr:case ja:Y=rr;break;default:m.raise("unsupported type for element array")}oe.buffer.dtype=Y}oe.type=Y,m(Y!==rr||!!c.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var H=he;H<0&&(H=oe.buffer.byteLength,Y===mr?H>>=1:Y===rr&&(H>>=2)),oe.vertCount=H;var fe=te;if(te<0){fe=Mr;var Ee=oe.buffer.dimension;Ee===1&&(fe=Ks),Ee===2&&(fe=Qs),Ee===3&&(fe=Mr)}oe.primType=fe}function ue(oe){N.elementsCount--,m(oe.buffer!==null,"must not double destroy elements"),delete V[oe.id],oe.buffer.destroy(),oe.buffer=null}function Q(oe,L){var B=v.create(null,In,!0),te=new K(B._buffer);N.elementsCount++;function he(W){if(!W)B(),te.primType=Mr,te.vertCount=0,te.type=dr;else if(typeof W=="number")B(W),te.primType=Mr,te.vertCount=W|0,te.type=dr;else{var de=null,Y=ef,se=-1,H=-1,fe=0,Ee=0;Array.isArray(W)||r(W)||Pt(W)?de=W:(m.type(W,"object","invalid arguments for elements"),"data"in W&&(de=W.data,m(Array.isArray(de)||r(de)||Pt(de),"invalid data for element buffer")),"usage"in W&&(m.parameter(W.usage,Zr,"invalid element buffer usage"),Y=Zr[W.usage]),"primitive"in W&&(m.parameter(W.primitive,hr,"invalid element buffer primitive"),se=hr[W.primitive]),"count"in W&&(m(typeof W.count=="number"&&W.count>=0,"invalid vertex count for elements"),H=W.count|0),"type"in W&&(m.parameter(W.type,k,"invalid buffer type"),Ee=k[W.type]),"length"in W?fe=W.length|0:(fe=H,Ee===mr||Ee===Ua?fe*=2:(Ee===rr||Ee===ja)&&(fe*=4))),ie(te,de,Y,se,H,fe,Ee)}return he}return he(oe),he._reglType="elements",he._elements=te,he.subdata=function(W,de){return B.subdata(W,de),he},he.destroy=function(){ue(te)},he}return{create:Q,createStream:re,destroyStream:J,getElements:function(oe){return typeof oe=="function"&&oe._elements instanceof K?oe._elements:null},clear:function(){Gt(V).forEach(ue)}}}var Va=new Float32Array(1),rf=new Uint32Array(Va.buffer),nf=5123;function za(n){for(var c=ut.allocType(nf,n.length),v=0;v<n.length;++v)if(isNaN(n[v]))c[v]=65535;else if(n[v]===1/0)c[v]=31744;else if(n[v]===-1/0)c[v]=64512;else{Va[0]=n[v];var N=rf[0],V=N>>>31<<15,I=(N<<1>>>24)-127,k=N>>13&1024-1;if(I<-24)c[v]=V;else if(I<-14){var K=-14-I;c[v]=V+(k+1024>>K)}else I>15?c[v]=V+31744:c[v]=V+(I+15<<10)+k}return c}function it(n){return Array.isArray(n)||r(n)}var Xa=function(n){return!(n&n-1)&&!!n},af=34467,Vt=3553,Gn=34067,en=34069,nr=6408,Nn=6406,tn=6407,Dr=6409,rn=6410,qa=32854,$n=32855,Wa=36194,of=32819,sf=32820,ff=33635,uf=34042,kn=6402,nn=34041,Bn=35904,Pn=35906,pr=36193,Un=33776,jn=33777,Vn=33778,zn=33779,Ha=35986,Ya=35987,Ka=34798,Qa=35840,Za=35841,Ja=35842,ei=35843,ti=36196,vr=5121,Xn=5123,qn=5125,Ir=5126,cf=10242,lf=10243,hf=10497,Wn=33071,df=33648,mf=10240,pf=10241,Hn=9728,vf=9729,Yn=9984,ri=9985,ni=9986,Kn=9987,yf=33170,an=4352,_f=4353,bf=4354,gf=34046,Ef=3317,xf=37440,Tf=37441,Af=37443,ai=37444,Gr=33984,wf=[Yn,ni,ri,Kn],on=[0,Dr,rn,tn,nr],$t={};$t[Dr]=$t[Nn]=$t[kn]=1,$t[nn]=$t[rn]=2,$t[tn]=$t[Bn]=3,$t[nr]=$t[Pn]=4;function yr(n){return"[object "+n+"]"}var ii=yr("HTMLCanvasElement"),oi=yr("OffscreenCanvas"),si=yr("CanvasRenderingContext2D"),fi=yr("ImageBitmap"),ui=yr("HTMLImageElement"),ci=yr("HTMLVideoElement"),Sf=Object.keys(On).concat([ii,oi,si,fi,ui,ci]),_r=[];_r[vr]=1,_r[Ir]=4,_r[pr]=2,_r[Xn]=2,_r[qn]=4;var xt=[];xt[qa]=2,xt[$n]=2,xt[Wa]=2,xt[nn]=4,xt[Un]=.5,xt[jn]=.5,xt[Vn]=1,xt[zn]=1,xt[Ha]=.5,xt[Ya]=1,xt[Ka]=1,xt[Qa]=.5,xt[Za]=.25,xt[Ja]=.5,xt[ei]=.25,xt[ti]=.5;function li(n){return Array.isArray(n)&&(n.length===0||typeof n[0]=="number")}function hi(n){if(!Array.isArray(n))return!1;var c=n.length;return!(c===0||!it(n[0]))}function ar(n){return Object.prototype.toString.call(n)}function di(n){return ar(n)===ii}function mi(n){return ar(n)===oi}function Rf(n){return ar(n)===si}function Lf(n){return ar(n)===fi}function Cf(n){return ar(n)===ui}function Of(n){return ar(n)===ci}function Qn(n){if(!n)return!1;var c=ar(n);return Sf.indexOf(c)>=0?!0:li(n)||hi(n)||Pt(n)}function pi(n){return On[Object.prototype.toString.call(n)]|0}function Ff(n,c){var v=c.length;switch(n.type){case vr:case Xn:case qn:case Ir:var N=ut.allocType(n.type,v);N.set(c),n.data=N;break;case pr:n.data=za(c);break;default:m.raise("unsupported texture type, must specify a typed array")}}function vi(n,c){return ut.allocType(n.type===pr?Ir:n.type,c)}function yi(n,c){n.type===pr?(n.data=za(c),ut.freeType(c)):n.data=c}function Mf(n,c,v,N,V,I){for(var k=n.width,K=n.height,Z=n.channels,re=k*K*Z,J=vi(n,re),ie=0,ue=0;ue<K;++ue)for(var Q=0;Q<k;++Q)for(var oe=0;oe<Z;++oe)J[ie++]=c[v*Q+N*ue+V*oe+I];yi(n,J)}function sn(n,c,v,N,V,I){var k;if(typeof xt[n]<"u"?k=xt[n]:k=$t[n]*_r[c],I&&(k*=6),V){for(var K=0,Z=v;Z>=1;)K+=k*Z*Z,Z/=2;return K}else return k*v*N}function Df(n,c,v,N,V,I,k){var K={"don't care":an,"dont care":an,nice:bf,fast:_f},Z={repeat:hf,clamp:Wn,mirror:df},re={nearest:Hn,linear:vf},J=o({mipmap:Kn,"nearest mipmap nearest":Yn,"linear mipmap nearest":ri,"nearest mipmap linear":ni,"linear mipmap linear":Kn},re),ie={none:0,browser:ai},ue={uint8:vr,rgba4:of,rgb565:ff,"rgb5 a1":sf},Q={alpha:Nn,luminance:Dr,"luminance alpha":rn,rgb:tn,rgba:nr,rgba4:qa,"rgb5 a1":$n,rgb565:Wa},oe={};c.ext_srgb&&(Q.srgb=Bn,Q.srgba=Pn),c.oes_texture_float&&(ue.float32=ue.float=Ir),c.oes_texture_half_float&&(ue.float16=ue["half float"]=pr),c.webgl_depth_texture&&(o(Q,{depth:kn,"depth stencil":nn}),o(ue,{uint16:Xn,uint32:qn,"depth stencil":uf})),c.webgl_compressed_texture_s3tc&&o(oe,{"rgb s3tc dxt1":Un,"rgba s3tc dxt1":jn,"rgba s3tc dxt3":Vn,"rgba s3tc dxt5":zn}),c.webgl_compressed_texture_atc&&o(oe,{"rgb atc":Ha,"rgba atc explicit alpha":Ya,"rgba atc interpolated alpha":Ka}),c.webgl_compressed_texture_pvrtc&&o(oe,{"rgb pvrtc 4bppv1":Qa,"rgb pvrtc 2bppv1":Za,"rgba pvrtc 4bppv1":Ja,"rgba pvrtc 2bppv1":ei}),c.webgl_compressed_texture_etc1&&(oe["rgb etc1"]=ti);var L=Array.prototype.slice.call(n.getParameter(af));Object.keys(oe).forEach(function(p){var $=oe[p];L.indexOf($)>=0&&(Q[p]=$)});var B=Object.keys(Q);v.textureFormats=B;var te=[];Object.keys(Q).forEach(function(p){var $=Q[p];te[$]=p});var he=[];Object.keys(ue).forEach(function(p){var $=ue[p];he[$]=p});var W=[];Object.keys(re).forEach(function(p){var $=re[p];W[$]=p});var de=[];Object.keys(J).forEach(function(p){var $=J[p];de[$]=p});var Y=[];Object.keys(Z).forEach(function(p){var $=Z[p];Y[$]=p});var se=B.reduce(function(p,$){var M=Q[$];return M===Dr||M===Nn||M===Dr||M===rn||M===kn||M===nn||c.ext_srgb&&(M===Bn||M===Pn)?p[M]=M:M===$n||$.indexOf("rgba")>=0?p[M]=nr:p[M]=tn,p},{});function H(){this.internalformat=nr,this.format=nr,this.type=vr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ai,this.width=0,this.height=0,this.channels=0}function fe(p,$){p.internalformat=$.internalformat,p.format=$.format,p.type=$.type,p.compressed=$.compressed,p.premultiplyAlpha=$.premultiplyAlpha,p.flipY=$.flipY,p.unpackAlignment=$.unpackAlignment,p.colorSpace=$.colorSpace,p.width=$.width,p.height=$.height,p.channels=$.channels}function Ee(p,$){if(!(typeof $!="object"||!$)){if("premultiplyAlpha"in $&&(m.type($.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),p.premultiplyAlpha=$.premultiplyAlpha),"flipY"in $&&(m.type($.flipY,"boolean","invalid texture flip"),p.flipY=$.flipY),"alignment"in $&&(m.oneOf($.alignment,[1,2,4,8],"invalid texture unpack alignment"),p.unpackAlignment=$.alignment),"colorSpace"in $&&(m.parameter($.colorSpace,ie,"invalid colorSpace"),p.colorSpace=ie[$.colorSpace]),"type"in $){var M=$.type;m(c.oes_texture_float||!(M==="float"||M==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),m(c.oes_texture_half_float||!(M==="half float"||M==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),m(c.webgl_depth_texture||!(M==="uint16"||M==="uint32"||M==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),m.parameter(M,ue,"invalid texture type"),p.type=ue[M]}var me=p.width,Pe=p.height,h=p.channels,u=!1;"shape"in $?(m(Array.isArray($.shape)&&$.shape.length>=2,"shape must be an array"),me=$.shape[0],Pe=$.shape[1],$.shape.length===3&&(h=$.shape[2],m(h>0&&h<=4,"invalid number of channels"),u=!0),m(me>=0&&me<=v.maxTextureSize,"invalid width"),m(Pe>=0&&Pe<=v.maxTextureSize,"invalid height")):("radius"in $&&(me=Pe=$.radius,m(me>=0&&me<=v.maxTextureSize,"invalid radius")),"width"in $&&(me=$.width,m(me>=0&&me<=v.maxTextureSize,"invalid width")),"height"in $&&(Pe=$.height,m(Pe>=0&&Pe<=v.maxTextureSize,"invalid height")),"channels"in $&&(h=$.channels,m(h>0&&h<=4,"invalid number of channels"),u=!0)),p.width=me|0,p.height=Pe|0,p.channels=h|0;var _=!1;if("format"in $){var R=$.format;m(c.webgl_depth_texture||!(R==="depth"||R==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),m.parameter(R,Q,"invalid texture format");var C=p.internalformat=Q[R];p.format=se[C],R in ue&&("type"in $||(p.type=ue[R])),R in oe&&(p.compressed=!0),_=!0}!u&&_?p.channels=$t[p.format]:u&&!_?p.channels!==on[p.format]&&(p.format=p.internalformat=on[p.channels]):_&&u&&m(p.channels===$t[p.format],"number of channels inconsistent with specified format")}}function Re(p){n.pixelStorei(xf,p.flipY),n.pixelStorei(Tf,p.premultiplyAlpha),n.pixelStorei(Af,p.colorSpace),n.pixelStorei(Ef,p.unpackAlignment)}function ce(){H.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ne(p,$){var M=null;if(Qn($)?M=$:$&&(m.type($,"object","invalid pixel data type"),Ee(p,$),"x"in $&&(p.xOffset=$.x|0),"y"in $&&(p.yOffset=$.y|0),Qn($.data)&&(M=$.data)),m(!p.compressed||M instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),$.copy){m(!M,"can not specify copy and data field for the same texture");var me=V.viewportWidth,Pe=V.viewportHeight;p.width=p.width||me-p.xOffset,p.height=p.height||Pe-p.yOffset,p.needsCopy=!0,m(p.xOffset>=0&&p.xOffset<me&&p.yOffset>=0&&p.yOffset<Pe&&p.width>0&&p.width<=me&&p.height>0&&p.height<=Pe,"copy texture read out of bounds")}else if(!M)p.width=p.width||1,p.height=p.height||1,p.channels=p.channels||4;else if(r(M))p.channels=p.channels||4,p.data=M,!("type"in $)&&p.type===vr&&(p.type=pi(M));else if(li(M))p.channels=p.channels||4,Ff(p,M),p.alignment=1,p.needsFree=!0;else if(Pt(M)){var h=M.data;!Array.isArray(h)&&p.type===vr&&(p.type=pi(h));var u=M.shape,_=M.stride,R,C,E,b,A,d;u.length===3?(E=u[2],d=_[2]):(m(u.length===2,"invalid ndarray pixel data, must be 2 or 3D"),E=1,d=1),R=u[0],C=u[1],b=_[0],A=_[1],p.alignment=1,p.width=R,p.height=C,p.channels=E,p.format=p.internalformat=on[E],p.needsFree=!0,Mf(p,h,b,A,d,M.offset)}else if(di(M)||mi(M)||Rf(M))di(M)||mi(M)?p.element=M:p.element=M.canvas,p.width=p.element.width,p.height=p.element.height,p.channels=4;else if(Lf(M))p.element=M,p.width=M.width,p.height=M.height,p.channels=4;else if(Cf(M))p.element=M,p.width=M.naturalWidth,p.height=M.naturalHeight,p.channels=4;else if(Of(M))p.element=M,p.width=M.videoWidth,p.height=M.videoHeight,p.channels=4;else if(hi(M)){var y=p.width||M[0].length,l=p.height||M.length,w=p.channels;it(M[0][0])?w=w||M[0][0].length:w=w||1;for(var F=Qr.shape(M),j=1,z=0;z<F.length;++z)j*=F[z];var U=vi(p,j);Qr.flatten(M,F,"",U),yi(p,U),p.alignment=1,p.width=y,p.height=l,p.channels=w,p.format=p.internalformat=on[w],p.needsFree=!0}p.type===Ir?m(v.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):p.type===pr&&m(v.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function X(p,$,M){var me=p.element,Pe=p.data,h=p.internalformat,u=p.format,_=p.type,R=p.width,C=p.height;Re(p),me?n.texImage2D($,M,u,u,_,me):p.compressed?n.compressedTexImage2D($,M,h,R,C,0,Pe):p.needsCopy?(N(),n.copyTexImage2D($,M,u,p.xOffset,p.yOffset,R,C,0)):n.texImage2D($,M,u,R,C,0,u,_,Pe||null)}function we(p,$,M,me,Pe){var h=p.element,u=p.data,_=p.internalformat,R=p.format,C=p.type,E=p.width,b=p.height;Re(p),h?n.texSubImage2D($,Pe,M,me,R,C,h):p.compressed?n.compressedTexSubImage2D($,Pe,M,me,_,E,b,u):p.needsCopy?(N(),n.copyTexSubImage2D($,Pe,M,me,p.xOffset,p.yOffset,E,b)):n.texSubImage2D($,Pe,M,me,E,b,R,C,u)}var De=[];function ye(){return De.pop()||new ce}function Be(p){p.needsFree&&ut.freeType(p.data),ce.call(p),De.push(p)}function Le(){H.call(this),this.genMipmaps=!1,this.mipmapHint=an,this.mipmask=0,this.images=Array(16)}function ke(p,$,M){var me=p.images[0]=ye();p.mipmask=1,me.width=p.width=$,me.height=p.height=M,me.channels=p.channels=4}function Ye(p,$){var M=null;if(Qn($))M=p.images[0]=ye(),fe(M,p),ne(M,$),p.mipmask=1;else if(Ee(p,$),Array.isArray($.mipmap))for(var me=$.mipmap,Pe=0;Pe<me.length;++Pe)M=p.images[Pe]=ye(),fe(M,p),M.width>>=Pe,M.height>>=Pe,ne(M,me[Pe]),p.mipmask|=1<<Pe;else M=p.images[0]=ye(),fe(M,p),ne(M,$),p.mipmask=1;fe(p,p.images[0]),p.compressed&&(p.internalformat===Un||p.internalformat===jn||p.internalformat===Vn||p.internalformat===zn)&&m(p.width%4===0&&p.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function lt(p,$){for(var M=p.images,me=0;me<M.length;++me){if(!M[me])return;X(M[me],$,me)}}var vt=[];function je(){var p=vt.pop()||new Le;H.call(p),p.mipmask=0;for(var $=0;$<16;++$)p.images[$]=null;return p}function dt(p){for(var $=p.images,M=0;M<$.length;++M)$[M]&&Be($[M]),$[M]=null;vt.push(p)}function rt(){this.minFilter=Hn,this.magFilter=Hn,this.wrapS=Wn,this.wrapT=Wn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=an}function ht(p,$){if("min"in $){var M=$.min;m.parameter(M,J),p.minFilter=J[M],wf.indexOf(p.minFilter)>=0&&!("faces"in $)&&(p.genMipmaps=!0)}if("mag"in $){var me=$.mag;m.parameter(me,re),p.magFilter=re[me]}var Pe=p.wrapS,h=p.wrapT;if("wrap"in $){var u=$.wrap;typeof u=="string"?(m.parameter(u,Z),Pe=h=Z[u]):Array.isArray(u)&&(m.parameter(u[0],Z),m.parameter(u[1],Z),Pe=Z[u[0]],h=Z[u[1]])}else{if("wrapS"in $){var _=$.wrapS;m.parameter(_,Z),Pe=Z[_]}if("wrapT"in $){var R=$.wrapT;m.parameter(R,Z),h=Z[R]}}if(p.wrapS=Pe,p.wrapT=h,"anisotropic"in $){var C=$.anisotropic;m(typeof C=="number"&&C>=1&&C<=v.maxAnisotropic,"aniso samples must be between 1 and "),p.anisotropic=$.anisotropic}if("mipmap"in $){var E=!1;switch(typeof $.mipmap){case"string":m.parameter($.mipmap,K,"invalid mipmap hint"),p.mipmapHint=K[$.mipmap],p.genMipmaps=!0,E=!0;break;case"boolean":E=p.genMipmaps=$.mipmap;break;case"object":m(Array.isArray($.mipmap),"invalid mipmap type"),p.genMipmaps=!1,E=!0;break;default:m.raise("invalid mipmap type")}E&&!("min"in $)&&(p.minFilter=Yn)}}function mt(p,$){n.texParameteri($,pf,p.minFilter),n.texParameteri($,mf,p.magFilter),n.texParameteri($,cf,p.wrapS),n.texParameteri($,lf,p.wrapT),c.ext_texture_filter_anisotropic&&n.texParameteri($,gf,p.anisotropic),p.genMipmaps&&(n.hint(yf,p.mipmapHint),n.generateMipmap($))}var pt=0,yt={},Tt=v.maxTextureUnits,ot=Array(Tt).map(function(){return null});function Ie(p){H.call(this),this.mipmask=0,this.internalformat=nr,this.id=pt++,this.refCount=1,this.target=p,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new rt,k.profile&&(this.stats={size:0})}function At(p){n.activeTexture(Gr),n.bindTexture(p.target,p.texture)}function Ze(){var p=ot[0];p?n.bindTexture(p.target,p.texture):n.bindTexture(Vt,null)}function Te(p){var $=p.texture;m($,"must not double destroy texture");var M=p.unit,me=p.target;M>=0&&(n.activeTexture(Gr+M),n.bindTexture(me,null),ot[M]=null),n.deleteTexture($),p.texture=null,p.params=null,p.pixels=null,p.refCount=0,delete yt[p.id],I.textureCount--}o(Ie.prototype,{bind:function(){var p=this;p.bindCount+=1;var $=p.unit;if($<0){for(var M=0;M<Tt;++M){var me=ot[M];if(me){if(me.bindCount>0)continue;me.unit=-1}ot[M]=p,$=M;break}$>=Tt&&m.raise("insufficient number of texture units"),k.profile&&I.maxTextureUnits<$+1&&(I.maxTextureUnits=$+1),p.unit=$,n.activeTexture(Gr+$),n.bindTexture(p.target,p.texture)}return $},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Te(this)}});function Ue(p,$){var M=new Ie(Vt);yt[M.id]=M,I.textureCount++;function me(u,_){var R=M.texInfo;rt.call(R);var C=je();return typeof u=="number"?typeof _=="number"?ke(C,u|0,_|0):ke(C,u|0,u|0):u?(m.type(u,"object","invalid arguments to regl.texture"),ht(R,u),Ye(C,u)):ke(C,1,1),R.genMipmaps&&(C.mipmask=(C.width<<1)-1),M.mipmask=C.mipmask,fe(M,C),m.texture2D(R,C,v),M.internalformat=C.internalformat,me.width=C.width,me.height=C.height,At(M),lt(C,Vt),mt(R,Vt),Ze(),dt(C),k.profile&&(M.stats.size=sn(M.internalformat,M.type,C.width,C.height,R.genMipmaps,!1)),me.format=te[M.internalformat],me.type=he[M.type],me.mag=W[R.magFilter],me.min=de[R.minFilter],me.wrapS=Y[R.wrapS],me.wrapT=Y[R.wrapT],me}function Pe(u,_,R,C){m(!!u,"must specify image data");var E=_|0,b=R|0,A=C|0,d=ye();return fe(d,M),d.width=0,d.height=0,ne(d,u),d.width=d.width||(M.width>>A)-E,d.height=d.height||(M.height>>A)-b,m(M.type===d.type&&M.format===d.format&&M.internalformat===d.internalformat,"incompatible format for texture.subimage"),m(E>=0&&b>=0&&E+d.width<=M.width&&b+d.height<=M.height,"texture.subimage write out of bounds"),m(M.mipmask&1<<A,"missing mipmap data"),m(d.data||d.element||d.needsCopy,"missing image data"),At(M),we(d,Vt,E,b,A),Ze(),Be(d),me}function h(u,_){var R=u|0,C=_|0||R;if(R===M.width&&C===M.height)return me;me.width=M.width=R,me.height=M.height=C,At(M);for(var E=0;M.mipmask>>E;++E){var b=R>>E,A=C>>E;if(!b||!A)break;n.texImage2D(Vt,E,M.format,b,A,0,M.format,M.type,null)}return Ze(),k.profile&&(M.stats.size=sn(M.internalformat,M.type,R,C,!1,!1)),me}return me(p,$),me.subimage=Pe,me.resize=h,me._reglType="texture2d",me._texture=M,k.profile&&(me.stats=M.stats),me.destroy=function(){M.decRef()},me}function Xe(p,$,M,me,Pe,h){var u=new Ie(Gn);yt[u.id]=u,I.cubeCount++;var _=new Array(6);function R(b,A,d,y,l,w){var F,j=u.texInfo;for(rt.call(j),F=0;F<6;++F)_[F]=je();if(typeof b=="number"||!b){var z=b|0||1;for(F=0;F<6;++F)ke(_[F],z,z)}else if(typeof b=="object")if(A)Ye(_[0],b),Ye(_[1],A),Ye(_[2],d),Ye(_[3],y),Ye(_[4],l),Ye(_[5],w);else if(ht(j,b),Ee(u,b),"faces"in b){var U=b.faces;for(m(Array.isArray(U)&&U.length===6,"cube faces must be a length 6 array"),F=0;F<6;++F)m(typeof U[F]=="object"&&!!U[F],"invalid input for cube map face"),fe(_[F],u),Ye(_[F],U[F])}else for(F=0;F<6;++F)Ye(_[F],b);else m.raise("invalid arguments to cube map");for(fe(u,_[0]),v.npotTextureCube||m(Xa(u.width)&&Xa(u.height),"your browser does not support non power or two texture dimensions"),j.genMipmaps?u.mipmask=(_[0].width<<1)-1:u.mipmask=_[0].mipmask,m.textureCube(u,j,_,v),u.internalformat=_[0].internalformat,R.width=_[0].width,R.height=_[0].height,At(u),F=0;F<6;++F)lt(_[F],en+F);for(mt(j,Gn),Ze(),k.profile&&(u.stats.size=sn(u.internalformat,u.type,R.width,R.height,j.genMipmaps,!0)),R.format=te[u.internalformat],R.type=he[u.type],R.mag=W[j.magFilter],R.min=de[j.minFilter],R.wrapS=Y[j.wrapS],R.wrapT=Y[j.wrapT],F=0;F<6;++F)dt(_[F]);return R}function C(b,A,d,y,l){m(!!A,"must specify image data"),m(typeof b=="number"&&b===(b|0)&&b>=0&&b<6,"invalid face");var w=d|0,F=y|0,j=l|0,z=ye();return fe(z,u),z.width=0,z.height=0,ne(z,A),z.width=z.width||(u.width>>j)-w,z.height=z.height||(u.height>>j)-F,m(u.type===z.type&&u.format===z.format&&u.internalformat===z.internalformat,"incompatible format for texture.subimage"),m(w>=0&&F>=0&&w+z.width<=u.width&&F+z.height<=u.height,"texture.subimage write out of bounds"),m(u.mipmask&1<<j,"missing mipmap data"),m(z.data||z.element||z.needsCopy,"missing image data"),At(u),we(z,en+b,w,F,j),Ze(),Be(z),R}function E(b){var A=b|0;if(A!==u.width){R.width=u.width=A,R.height=u.height=A,At(u);for(var d=0;d<6;++d)for(var y=0;u.mipmask>>y;++y)n.texImage2D(en+d,y,u.format,A>>y,A>>y,0,u.format,u.type,null);return Ze(),k.profile&&(u.stats.size=sn(u.internalformat,u.type,R.width,R.height,!1,!0)),R}}return R(p,$,M,me,Pe,h),R.subimage=C,R.resize=E,R._reglType="textureCube",R._texture=u,k.profile&&(R.stats=u.stats),R.destroy=function(){u.decRef()},R}function st(){for(var p=0;p<Tt;++p)n.activeTexture(Gr+p),n.bindTexture(Vt,null),ot[p]=null;Gt(yt).forEach(Te),I.cubeCount=0,I.textureCount=0}k.profile&&(I.getTotalTextureSize=function(){var p=0;return Object.keys(yt).forEach(function($){p+=yt[$].stats.size}),p});function Xt(){for(var p=0;p<Tt;++p){var $=ot[p];$&&($.bindCount=0,$.unit=-1,ot[p]=null)}Gt(yt).forEach(function(M){M.texture=n.createTexture(),n.bindTexture(M.target,M.texture);for(var me=0;me<32;++me)if(M.mipmask&1<<me)if(M.target===Vt)n.texImage2D(Vt,me,M.internalformat,M.width>>me,M.height>>me,0,M.internalformat,M.type,null);else for(var Pe=0;Pe<6;++Pe)n.texImage2D(en+Pe,me,M.internalformat,M.width>>me,M.height>>me,0,M.internalformat,M.type,null);mt(M.texInfo,M.target)})}function lr(){for(var p=0;p<Tt;++p){var $=ot[p];$&&($.bindCount=0,$.unit=-1,ot[p]=null),n.activeTexture(Gr+p),n.bindTexture(Vt,null),n.bindTexture(Gn,null)}}return{create2D:Ue,createCube:Xe,clear:st,getTexture:function(p){return null},restore:Xt,refresh:lr}}var Yt=36161,fn=32854,_i=32855,bi=36194,gi=33189,Ei=36168,xi=34041,Ti=35907,Ai=34836,wi=34842,Si=34843,Ut=[];Ut[fn]=2,Ut[_i]=2,Ut[bi]=2,Ut[gi]=2,Ut[Ei]=1,Ut[xi]=4,Ut[Ti]=4,Ut[Ai]=16,Ut[wi]=8,Ut[Si]=6;function Ri(n,c,v){return Ut[n]*c*v}var If=function(n,c,v,N,V){var I={rgba4:fn,rgb565:bi,"rgb5 a1":_i,depth:gi,stencil:Ei,"depth stencil":xi};c.ext_srgb&&(I.srgba=Ti),c.ext_color_buffer_half_float&&(I.rgba16f=wi,I.rgb16f=Si),c.webgl_color_buffer_float&&(I.rgba32f=Ai);var k=[];Object.keys(I).forEach(function(Q){var oe=I[Q];k[oe]=Q});var K=0,Z={};function re(Q){this.id=K++,this.refCount=1,this.renderbuffer=Q,this.format=fn,this.width=0,this.height=0,V.profile&&(this.stats={size:0})}re.prototype.decRef=function(){--this.refCount<=0&&J(this)};function J(Q){var oe=Q.renderbuffer;m(oe,"must not double destroy renderbuffer"),n.bindRenderbuffer(Yt,null),n.deleteRenderbuffer(oe),Q.renderbuffer=null,Q.refCount=0,delete Z[Q.id],N.renderbufferCount--}function ie(Q,oe){var L=new re(n.createRenderbuffer());Z[L.id]=L,N.renderbufferCount++;function B(he,W){var de=0,Y=0,se=fn;if(typeof he=="object"&&he){var H=he;if("shape"in H){var fe=H.shape;m(Array.isArray(fe)&&fe.length>=2,"invalid renderbuffer shape"),de=fe[0]|0,Y=fe[1]|0}else"radius"in H&&(de=Y=H.radius|0),"width"in H&&(de=H.width|0),"height"in H&&(Y=H.height|0);"format"in H&&(m.parameter(H.format,I,"invalid renderbuffer format"),se=I[H.format])}else typeof he=="number"?(de=he|0,typeof W=="number"?Y=W|0:Y=de):he?m.raise("invalid arguments to renderbuffer constructor"):de=Y=1;if(m(de>0&&Y>0&&de<=v.maxRenderbufferSize&&Y<=v.maxRenderbufferSize,"invalid renderbuffer size"),!(de===L.width&&Y===L.height&&se===L.format))return B.width=L.width=de,B.height=L.height=Y,L.format=se,n.bindRenderbuffer(Yt,L.renderbuffer),n.renderbufferStorage(Yt,se,de,Y),m(n.getError()===0,"invalid render buffer format"),V.profile&&(L.stats.size=Ri(L.format,L.width,L.height)),B.format=k[L.format],B}function te(he,W){var de=he|0,Y=W|0||de;return de===L.width&&Y===L.height||(m(de>0&&Y>0&&de<=v.maxRenderbufferSize&&Y<=v.maxRenderbufferSize,"invalid renderbuffer size"),B.width=L.width=de,B.height=L.height=Y,n.bindRenderbuffer(Yt,L.renderbuffer),n.renderbufferStorage(Yt,L.format,de,Y),m(n.getError()===0,"invalid render buffer format"),V.profile&&(L.stats.size=Ri(L.format,L.width,L.height))),B}return B(Q,oe),B.resize=te,B._reglType="renderbuffer",B._renderbuffer=L,V.profile&&(B.stats=L.stats),B.destroy=function(){L.decRef()},B}V.profile&&(N.getTotalRenderbufferSize=function(){var Q=0;return Object.keys(Z).forEach(function(oe){Q+=Z[oe].stats.size}),Q});function ue(){Gt(Z).forEach(function(Q){Q.renderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(Yt,Q.renderbuffer),n.renderbufferStorage(Yt,Q.format,Q.width,Q.height)}),n.bindRenderbuffer(Yt,null)}return{create:ie,clear:function(){Gt(Z).forEach(J)},restore:ue}},qt=36160,Zn=36161,ir=3553,un=34069,Li=36064,Ci=36096,Oi=36128,Fi=33306,Mi=36053,Gf=36054,Nf=36055,$f=36057,kf=36061,Bf=36193,Pf=5121,Uf=5126,Di=6407,Ii=6408,jf=6402,Vf=[Di,Ii],Jn=[];Jn[Ii]=4,Jn[Di]=3;var cn=[];cn[Pf]=1,cn[Uf]=4,cn[Bf]=2;var zf=32854,Xf=32855,qf=36194,Wf=33189,Hf=36168,Gi=34041,Yf=35907,Kf=34836,Qf=34842,Zf=34843,Jf=[zf,Xf,qf,Yf,Qf,Zf,Kf],br={};br[Mi]="complete",br[Gf]="incomplete attachment",br[$f]="incomplete dimensions",br[Nf]="incomplete, missing attachment",br[kf]="unsupported";function eu(n,c,v,N,V,I){var k={cur:null,next:null,dirty:!1,setFBO:null},K=["rgba"],Z=["rgba4","rgb565","rgb5 a1"];c.ext_srgb&&Z.push("srgba"),c.ext_color_buffer_half_float&&Z.push("rgba16f","rgb16f"),c.webgl_color_buffer_float&&Z.push("rgba32f");var re=["uint8"];c.oes_texture_half_float&&re.push("half float","float16"),c.oes_texture_float&&re.push("float","float32");function J(ce,ne,X){this.target=ce,this.texture=ne,this.renderbuffer=X;var we=0,De=0;ne?(we=ne.width,De=ne.height):X&&(we=X.width,De=X.height),this.width=we,this.height=De}function ie(ce){ce&&(ce.texture&&ce.texture._texture.decRef(),ce.renderbuffer&&ce.renderbuffer._renderbuffer.decRef())}function ue(ce,ne,X){if(ce)if(ce.texture){var we=ce.texture._texture,De=Math.max(1,we.width),ye=Math.max(1,we.height);m(De===ne&&ye===X,"inconsistent width/height for supplied texture"),we.refCount+=1}else{var Be=ce.renderbuffer._renderbuffer;m(Be.width===ne&&Be.height===X,"inconsistent width/height for renderbuffer"),Be.refCount+=1}}function Q(ce,ne){ne&&(ne.texture?n.framebufferTexture2D(qt,ce,ne.target,ne.texture._texture.texture,0):n.framebufferRenderbuffer(qt,ce,Zn,ne.renderbuffer._renderbuffer.renderbuffer))}function oe(ce){var ne=ir,X=null,we=null,De=ce;typeof ce=="object"&&(De=ce.data,"target"in ce&&(ne=ce.target|0)),m.type(De,"function","invalid attachment data");var ye=De._reglType;return ye==="texture2d"?(X=De,m(ne===ir)):ye==="textureCube"?(X=De,m(ne>=un&&ne<un+6,"invalid cube map target")):ye==="renderbuffer"?(we=De,ne=Zn):m.raise("invalid regl object for attachment"),new J(ne,X,we)}function L(ce,ne,X,we,De){if(X){var ye=N.create2D({width:ce,height:ne,format:we,type:De});return ye._texture.refCount=0,new J(ir,ye,null)}else{var Be=V.create({width:ce,height:ne,format:we});return Be._renderbuffer.refCount=0,new J(Zn,null,Be)}}function B(ce){return ce&&(ce.texture||ce.renderbuffer)}function te(ce,ne,X){ce&&(ce.texture?ce.texture.resize(ne,X):ce.renderbuffer&&ce.renderbuffer.resize(ne,X),ce.width=ne,ce.height=X)}var he=0,W={};function de(){this.id=he++,W[this.id]=this,this.framebuffer=n.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Y(ce){ce.colorAttachments.forEach(ie),ie(ce.depthAttachment),ie(ce.stencilAttachment),ie(ce.depthStencilAttachment)}function se(ce){var ne=ce.framebuffer;m(ne,"must not double destroy framebuffer"),n.deleteFramebuffer(ne),ce.framebuffer=null,I.framebufferCount--,delete W[ce.id]}function H(ce){var ne;n.bindFramebuffer(qt,ce.framebuffer);var X=ce.colorAttachments;for(ne=0;ne<X.length;++ne)Q(Li+ne,X[ne]);for(ne=X.length;ne<v.maxColorAttachments;++ne)n.framebufferTexture2D(qt,Li+ne,ir,null,0);n.framebufferTexture2D(qt,Fi,ir,null,0),n.framebufferTexture2D(qt,Ci,ir,null,0),n.framebufferTexture2D(qt,Oi,ir,null,0),Q(Ci,ce.depthAttachment),Q(Oi,ce.stencilAttachment),Q(Fi,ce.depthStencilAttachment);var we=n.checkFramebufferStatus(qt);!n.isContextLost()&&we!==Mi&&m.raise("framebuffer configuration not supported, status = "+br[we]),n.bindFramebuffer(qt,k.next?k.next.framebuffer:null),k.cur=k.next,n.getError()}function fe(ce,ne){var X=new de;I.framebufferCount++;function we(ye,Be){var Le;m(k.next!==X,"can not update framebuffer which is currently in use");var ke=0,Ye=0,lt=!0,vt=!0,je=null,dt=!0,rt="rgba",ht="uint8",mt=1,pt=null,yt=null,Tt=null,ot=!1;if(typeof ye=="number")ke=ye|0,Ye=Be|0||ke;else if(!ye)ke=Ye=1;else{m.type(ye,"object","invalid arguments for framebuffer");var Ie=ye;if("shape"in Ie){var At=Ie.shape;m(Array.isArray(At)&&At.length>=2,"invalid shape for framebuffer"),ke=At[0],Ye=At[1]}else"radius"in Ie&&(ke=Ye=Ie.radius),"width"in Ie&&(ke=Ie.width),"height"in Ie&&(Ye=Ie.height);("color"in Ie||"colors"in Ie)&&(je=Ie.color||Ie.colors,Array.isArray(je)&&m(je.length===1||c.webgl_draw_buffers,"multiple render targets not supported")),je||("colorCount"in Ie&&(mt=Ie.colorCount|0,m(mt>0,"invalid color buffer count")),"colorTexture"in Ie&&(dt=!!Ie.colorTexture,rt="rgba4"),"colorType"in Ie&&(ht=Ie.colorType,dt?(m(c.oes_texture_float||!(ht==="float"||ht==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),m(c.oes_texture_half_float||!(ht==="half float"||ht==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ht==="half float"||ht==="float16"?(m(c.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),rt="rgba16f"):(ht==="float"||ht==="float32")&&(m(c.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),rt="rgba32f"),m.oneOf(ht,re,"invalid color type")),"colorFormat"in Ie&&(rt=Ie.colorFormat,K.indexOf(rt)>=0?dt=!0:Z.indexOf(rt)>=0?dt=!1:dt?m.oneOf(Ie.colorFormat,K,"invalid color format for texture"):m.oneOf(Ie.colorFormat,Z,"invalid color format for renderbuffer"))),("depthTexture"in Ie||"depthStencilTexture"in Ie)&&(ot=!!(Ie.depthTexture||Ie.depthStencilTexture),m(!ot||c.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ie&&(typeof Ie.depth=="boolean"?lt=Ie.depth:(pt=Ie.depth,vt=!1)),"stencil"in Ie&&(typeof Ie.stencil=="boolean"?vt=Ie.stencil:(yt=Ie.stencil,lt=!1)),"depthStencil"in Ie&&(typeof Ie.depthStencil=="boolean"?lt=vt=Ie.depthStencil:(Tt=Ie.depthStencil,lt=!1,vt=!1))}var Ze=null,Te=null,Ue=null,Xe=null;if(Array.isArray(je))Ze=je.map(oe);else if(je)Ze=[oe(je)];else for(Ze=new Array(mt),Le=0;Le<mt;++Le)Ze[Le]=L(ke,Ye,dt,rt,ht);m(c.webgl_draw_buffers||Ze.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),m(Ze.length<=v.maxColorAttachments,"too many color attachments, not supported"),ke=ke||Ze[0].width,Ye=Ye||Ze[0].height,pt?Te=oe(pt):lt&&!vt&&(Te=L(ke,Ye,ot,"depth","uint32")),yt?Ue=oe(yt):vt&&!lt&&(Ue=L(ke,Ye,!1,"stencil","uint8")),Tt?Xe=oe(Tt):!pt&&!yt&&vt&&lt&&(Xe=L(ke,Ye,ot,"depth stencil","depth stencil")),m(!!pt+!!yt+!!Tt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var st=null;for(Le=0;Le<Ze.length;++Le)if(ue(Ze[Le],ke,Ye),m(!Ze[Le]||Ze[Le].texture&&Vf.indexOf(Ze[Le].texture._texture.format)>=0||Ze[Le].renderbuffer&&Jf.indexOf(Ze[Le].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Le+" is invalid"),Ze[Le]&&Ze[Le].texture){var Xt=Jn[Ze[Le].texture._texture.format]*cn[Ze[Le].texture._texture.type];st===null?st=Xt:m(st===Xt,"all color attachments much have the same number of bits per pixel.")}return ue(Te,ke,Ye),m(!Te||Te.texture&&Te.texture._texture.format===jf||Te.renderbuffer&&Te.renderbuffer._renderbuffer.format===Wf,"invalid depth attachment for framebuffer object"),ue(Ue,ke,Ye),m(!Ue||Ue.renderbuffer&&Ue.renderbuffer._renderbuffer.format===Hf,"invalid stencil attachment for framebuffer object"),ue(Xe,ke,Ye),m(!Xe||Xe.texture&&Xe.texture._texture.format===Gi||Xe.renderbuffer&&Xe.renderbuffer._renderbuffer.format===Gi,"invalid depth-stencil attachment for framebuffer object"),Y(X),X.width=ke,X.height=Ye,X.colorAttachments=Ze,X.depthAttachment=Te,X.stencilAttachment=Ue,X.depthStencilAttachment=Xe,we.color=Ze.map(B),we.depth=B(Te),we.stencil=B(Ue),we.depthStencil=B(Xe),we.width=X.width,we.height=X.height,H(X),we}function De(ye,Be){m(k.next!==X,"can not resize a framebuffer which is currently in use");var Le=Math.max(ye|0,1),ke=Math.max(Be|0||Le,1);if(Le===X.width&&ke===X.height)return we;for(var Ye=X.colorAttachments,lt=0;lt<Ye.length;++lt)te(Ye[lt],Le,ke);return te(X.depthAttachment,Le,ke),te(X.stencilAttachment,Le,ke),te(X.depthStencilAttachment,Le,ke),X.width=we.width=Le,X.height=we.height=ke,H(X),we}return we(ce,ne),o(we,{resize:De,_reglType:"framebuffer",_framebuffer:X,destroy:function(){se(X),Y(X)},use:function(ye){k.setFBO({framebuffer:we},ye)}})}function Ee(ce){var ne=Array(6);function X(De){var ye;m(ne.indexOf(k.next)<0,"can not update framebuffer which is currently in use");var Be={color:null},Le=0,ke=null,Ye="rgba",lt="uint8",vt=1;if(typeof De=="number")Le=De|0;else if(!De)Le=1;else{m.type(De,"object","invalid arguments for framebuffer");var je=De;if("shape"in je){var dt=je.shape;m(Array.isArray(dt)&&dt.length>=2,"invalid shape for framebuffer"),m(dt[0]===dt[1],"cube framebuffer must be square"),Le=dt[0]}else"radius"in je&&(Le=je.radius|0),"width"in je?(Le=je.width|0,"height"in je&&m(je.height===Le,"must be square")):"height"in je&&(Le=je.height|0);("color"in je||"colors"in je)&&(ke=je.color||je.colors,Array.isArray(ke)&&m(ke.length===1||c.webgl_draw_buffers,"multiple render targets not supported")),ke||("colorCount"in je&&(vt=je.colorCount|0,m(vt>0,"invalid color buffer count")),"colorType"in je&&(m.oneOf(je.colorType,re,"invalid color type"),lt=je.colorType),"colorFormat"in je&&(Ye=je.colorFormat,m.oneOf(je.colorFormat,K,"invalid color format for texture"))),"depth"in je&&(Be.depth=je.depth),"stencil"in je&&(Be.stencil=je.stencil),"depthStencil"in je&&(Be.depthStencil=je.depthStencil)}var rt;if(ke)if(Array.isArray(ke))for(rt=[],ye=0;ye<ke.length;++ye)rt[ye]=ke[ye];else rt=[ke];else{rt=Array(vt);var ht={radius:Le,format:Ye,type:lt};for(ye=0;ye<vt;++ye)rt[ye]=N.createCube(ht)}for(Be.color=Array(rt.length),ye=0;ye<rt.length;++ye){var mt=rt[ye];m(typeof mt=="function"&&mt._reglType==="textureCube","invalid cube map"),Le=Le||mt.width,m(mt.width===Le&&mt.height===Le,"invalid cube map shape"),Be.color[ye]={target:un,data:rt[ye]}}for(ye=0;ye<6;++ye){for(var pt=0;pt<rt.length;++pt)Be.color[pt].target=un+ye;ye>0&&(Be.depth=ne[0].depth,Be.stencil=ne[0].stencil,Be.depthStencil=ne[0].depthStencil),ne[ye]?ne[ye](Be):ne[ye]=fe(Be)}return o(X,{width:Le,height:Le,color:rt})}function we(De){var ye,Be=De|0;if(m(Be>0&&Be<=v.maxCubeMapSize,"invalid radius for cube fbo"),Be===X.width)return X;var Le=X.color;for(ye=0;ye<Le.length;++ye)Le[ye].resize(Be);for(ye=0;ye<6;++ye)ne[ye].resize(Be);return X.width=X.height=Be,X}return X(ce),o(X,{faces:ne,resize:we,_reglType:"framebufferCube",destroy:function(){ne.forEach(function(De){De.destroy()})}})}function Re(){k.cur=null,k.next=null,k.dirty=!0,Gt(W).forEach(function(ce){ce.framebuffer=n.createFramebuffer(),H(ce)})}return o(k,{getFramebuffer:function(ce){if(typeof ce=="function"&&ce._reglType==="framebuffer"){var ne=ce._framebuffer;if(ne instanceof de)return ne}return null},create:fe,createCube:Ee,clear:function(){Gt(W).forEach(se)},restore:Re})}var tu=5126,Ni=34962;function ea(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=tu,this.offset=0,this.stride=0,this.divisor=0}function ru(n,c,v,N,V){for(var I=v.maxAttributes,k=new Array(I),K=0;K<I;++K)k[K]=new ea;var Z=0,re={},J={Record:ea,scope:{},state:k,currentVAO:null,targetVAO:null,restore:ue()?W:function(){},createVAO:de,getVAO:oe,destroyBuffer:ie,setVAO:ue()?L:B,clear:ue()?te:function(){}};function ie(Y){for(var se=0;se<k.length;++se){var H=k[se];H.buffer===Y&&(n.disableVertexAttribArray(se),H.buffer=null)}}function ue(){return c.oes_vertex_array_object}function Q(){return c.angle_instanced_arrays}function oe(Y){return typeof Y=="function"&&Y._vao?Y._vao:null}function L(Y){if(Y!==J.currentVAO){var se=ue();Y?se.bindVertexArrayOES(Y.vao):se.bindVertexArrayOES(null),J.currentVAO=Y}}function B(Y){if(Y!==J.currentVAO){if(Y)Y.bindAttrs();else for(var se=Q(),H=0;H<k.length;++H){var fe=k[H];fe.buffer?(n.enableVertexAttribArray(H),n.vertexAttribPointer(H,fe.size,fe.type,fe.normalized,fe.stride,fe.offfset),se&&fe.divisor&&se.vertexAttribDivisorANGLE(H,fe.divisor)):(n.disableVertexAttribArray(H),n.vertexAttrib4f(H,fe.x,fe.y,fe.z,fe.w))}J.currentVAO=Y}}function te(){Gt(re).forEach(function(Y){Y.destroy()})}function he(){this.id=++Z,this.attributes=[];var Y=ue();Y?this.vao=Y.createVertexArrayOES():this.vao=null,re[this.id]=this,this.buffers=[]}he.prototype.bindAttrs=function(){for(var Y=Q(),se=this.attributes,H=0;H<se.length;++H){var fe=se[H];fe.buffer?(n.enableVertexAttribArray(H),n.bindBuffer(Ni,fe.buffer.buffer),n.vertexAttribPointer(H,fe.size,fe.type,fe.normalized,fe.stride,fe.offset),Y&&fe.divisor&&Y.vertexAttribDivisorANGLE(H,fe.divisor)):(n.disableVertexAttribArray(H),n.vertexAttrib4f(H,fe.x,fe.y,fe.z,fe.w))}for(var Ee=se.length;Ee<I;++Ee)n.disableVertexAttribArray(Ee)},he.prototype.refresh=function(){var Y=ue();Y&&(Y.bindVertexArrayOES(this.vao),this.bindAttrs(),J.currentVAO=this)},he.prototype.destroy=function(){if(this.vao){var Y=ue();this===J.currentVAO&&(J.currentVAO=null,Y.bindVertexArrayOES(null)),Y.deleteVertexArrayOES(this.vao),this.vao=null}re[this.id]&&(delete re[this.id],N.vaoCount-=1)};function W(){var Y=ue();Y&&Gt(re).forEach(function(se){se.refresh()})}function de(Y){var se=new he;N.vaoCount+=1;function H(fe){m(Array.isArray(fe),"arguments to vertex array constructor must be an array"),m(fe.length<I,"too many attributes"),m(fe.length>0,"must specify at least one attribute");var Ee={},Re=se.attributes;Re.length=fe.length;for(var ce=0;ce<fe.length;++ce){var ne=fe[ce],X=Re[ce]=new ea,we=ne.data||ne;if(Array.isArray(we)||r(we)||Pt(we)){var De;se.buffers[ce]&&(De=se.buffers[ce],r(we)&&De._buffer.byteLength>=we.byteLength?De.subdata(we):(De.destroy(),se.buffers[ce]=null)),se.buffers[ce]||(De=se.buffers[ce]=V.create(ne,Ni,!1,!0)),X.buffer=V.getBuffer(De),X.size=X.buffer.dimension|0,X.normalized=!1,X.type=X.buffer.dtype,X.offset=0,X.stride=0,X.divisor=0,X.state=1,Ee[ce]=1}else V.getBuffer(ne)?(X.buffer=V.getBuffer(ne),X.size=X.buffer.dimension|0,X.normalized=!1,X.type=X.buffer.dtype,X.offset=0,X.stride=0,X.divisor=0,X.state=1):V.getBuffer(ne.buffer)?(X.buffer=V.getBuffer(ne.buffer),X.size=(+ne.size||X.buffer.dimension)|0,X.normalized=!!ne.normalized||!1,"type"in ne?(m.parameter(ne.type,tr,"invalid buffer type"),X.type=tr[ne.type]):X.type=X.buffer.dtype,X.offset=(ne.offset||0)|0,X.stride=(ne.stride||0)|0,X.divisor=(ne.divisor||0)|0,X.state=1,m(X.size>=1&&X.size<=4,"size must be between 1 and 4"),m(X.offset>=0,"invalid offset"),m(X.stride>=0&&X.stride<=255,"stride must be between 0 and 255"),m(X.divisor>=0,"divisor must be positive"),m(!X.divisor||!!c.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ne?(m(ce>0,"first attribute must not be a constant"),X.x=+ne.x||0,X.y=+ne.y||0,X.z=+ne.z||0,X.w=+ne.w||0,X.state=2):m(!1,"invalid attribute spec for location "+ce)}for(var ye=0;ye<se.buffers.length;++ye)!Ee[ye]&&se.buffers[ye]&&(se.buffers[ye].destroy(),se.buffers[ye]=null);return se.refresh(),H}return H.destroy=function(){for(var fe=0;fe<se.buffers.length;++fe)se.buffers[fe]&&se.buffers[fe].destroy();se.buffers.length=0,se.destroy()},H._vao=se,H._reglType="vao",H(Y)}return J}var $i=35632,nu=35633,au=35718,iu=35721;function ou(n,c,v,N){var V={},I={};function k(L,B,te,he){this.name=L,this.id=B,this.location=te,this.info=he}function K(L,B){for(var te=0;te<L.length;++te)if(L[te].id===B.id){L[te].location=B.location;return}L.push(B)}function Z(L,B,te){var he=L===$i?V:I,W=he[B];if(!W){var de=c.str(B);W=n.createShader(L),n.shaderSource(W,de),n.compileShader(W),m.shaderError(n,W,de,L,te),he[B]=W}return W}var re={},J=[],ie=0;function ue(L,B){this.id=ie++,this.fragId=L,this.vertId=B,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,N.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Q(L,B,te){var he,W,de=Z($i,L.fragId),Y=Z(nu,L.vertId),se=L.program=n.createProgram();if(n.attachShader(se,de),n.attachShader(se,Y),te)for(he=0;he<te.length;++he){var H=te[he];n.bindAttribLocation(se,H[0],H[1])}n.linkProgram(se),m.linkError(n,se,c.str(L.fragId),c.str(L.vertId),B);var fe=n.getProgramParameter(se,au);N.profile&&(L.stats.uniformsCount=fe);var Ee=L.uniforms;for(he=0;he<fe;++he)if(W=n.getActiveUniform(se,he),W)if(W.size>1)for(var Re=0;Re<W.size;++Re){var ce=W.name.replace("[0]","["+Re+"]");K(Ee,new k(ce,c.id(ce),n.getUniformLocation(se,ce),W))}else K(Ee,new k(W.name,c.id(W.name),n.getUniformLocation(se,W.name),W));var ne=n.getProgramParameter(se,iu);N.profile&&(L.stats.attributesCount=ne);var X=L.attributes;for(he=0;he<ne;++he)W=n.getActiveAttrib(se,he),W&&K(X,new k(W.name,c.id(W.name),n.getAttribLocation(se,W.name),W))}N.profile&&(v.getMaxUniformsCount=function(){var L=0;return J.forEach(function(B){B.stats.uniformsCount>L&&(L=B.stats.uniformsCount)}),L},v.getMaxAttributesCount=function(){var L=0;return J.forEach(function(B){B.stats.attributesCount>L&&(L=B.stats.attributesCount)}),L});function oe(){V={},I={};for(var L=0;L<J.length;++L)Q(J[L],null,J[L].attributes.map(function(B){return[B.location,B.name]}))}return{clear:function(){var L=n.deleteShader.bind(n);Gt(V).forEach(L),V={},Gt(I).forEach(L),I={},J.forEach(function(B){n.deleteProgram(B.program)}),J.length=0,re={},v.shaderCount=0},program:function(L,B,te,he){m.command(L>=0,"missing vertex shader",te),m.command(B>=0,"missing fragment shader",te);var W=re[B];W||(W=re[B]={});var de=W[L];if(de&&(de.refCount++,!he))return de;var Y=new ue(B,L);return v.shaderCount++,Q(Y,te,he),de||(W[L]=Y),J.push(Y),o(Y,{destroy:function(){if(Y.refCount--,Y.refCount<=0){n.deleteProgram(Y.program);var se=J.indexOf(Y);J.splice(se,1),v.shaderCount--}W[Y.vertId].refCount<=0&&(n.deleteShader(I[Y.vertId]),delete I[Y.vertId],delete re[Y.fragId][Y.vertId]),Object.keys(re[Y.fragId]).length||(n.deleteShader(V[Y.fragId]),delete V[Y.fragId],delete re[Y.fragId])}})},restore:oe,shader:Z,frag:-1,vert:-1}}var su=6408,Nr=5121,fu=3333,ln=5126;function uu(n,c,v,N,V,I,k){function K(J){var ie;c.next===null?(m(V.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ie=Nr):(m(c.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ie=c.next.colorAttachments[0].texture._texture.type,I.oes_texture_float?(m(ie===Nr||ie===ln,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ie===ln&&m(k.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):m(ie===Nr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var ue=0,Q=0,oe=N.framebufferWidth,L=N.framebufferHeight,B=null;r(J)?B=J:J&&(m.type(J,"object","invalid arguments to regl.read()"),ue=J.x|0,Q=J.y|0,m(ue>=0&&ue<N.framebufferWidth,"invalid x offset for regl.read"),m(Q>=0&&Q<N.framebufferHeight,"invalid y offset for regl.read"),oe=(J.width||N.framebufferWidth-ue)|0,L=(J.height||N.framebufferHeight-Q)|0,B=J.data||null),B&&(ie===Nr?m(B instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ie===ln&&m(B instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),m(oe>0&&oe+ue<=N.framebufferWidth,"invalid width for read pixels"),m(L>0&&L+Q<=N.framebufferHeight,"invalid height for read pixels"),v();var te=oe*L*4;return B||(ie===Nr?B=new Uint8Array(te):ie===ln&&(B=B||new Float32Array(te))),m.isTypedArray(B,"data buffer for regl.read() must be a typedarray"),m(B.byteLength>=te,"data buffer for regl.read() too small"),n.pixelStorei(fu,4),n.readPixels(ue,Q,oe,L,su,ie,B),B}function Z(J){var ie;return c.setFBO({framebuffer:J.framebuffer},function(){ie=K(J)}),ie}function re(J){return!J||!("framebuffer"in J)?K(J):Z(J)}return re}function gr(n){return Array.prototype.slice.call(n)}function Er(n){return gr(n).join("")}function cu(){var n=0,c=[],v=[];function N(ie){for(var ue=0;ue<v.length;++ue)if(v[ue]===ie)return c[ue];var Q="g"+n++;return c.push(Q),v.push(ie),Q}function V(){var ie=[];function ue(){ie.push.apply(ie,gr(arguments))}var Q=[];function oe(){var L="v"+n++;return Q.push(L),arguments.length>0&&(ie.push(L,"="),ie.push.apply(ie,gr(arguments)),ie.push(";")),L}return o(ue,{def:oe,toString:function(){return Er([Q.length>0?"var "+Q.join(",")+";":"",Er(ie)])}})}function I(){var ie=V(),ue=V(),Q=ie.toString,oe=ue.toString;function L(B,te){ue(B,te,"=",ie.def(B,te),";")}return o(function(){ie.apply(ie,gr(arguments))},{def:ie.def,entry:ie,exit:ue,save:L,set:function(B,te,he){L(B,te),ie(B,te,"=",he,";")},toString:function(){return Q()+oe()}})}function k(){var ie=Er(arguments),ue=I(),Q=I(),oe=ue.toString,L=Q.toString;return o(ue,{then:function(){return ue.apply(ue,gr(arguments)),this},else:function(){return Q.apply(Q,gr(arguments)),this},toString:function(){var B=L();return B&&(B="else{"+B+"}"),Er(["if(",ie,"){",oe(),"}",B])}})}var K=V(),Z={};function re(ie,ue){var Q=[];function oe(){var W="a"+Q.length;return Q.push(W),W}ue=ue||0;for(var L=0;L<ue;++L)oe();var B=I(),te=B.toString,he=Z[ie]=o(B,{arg:oe,toString:function(){return Er(["function(",Q.join(),"){",te(),"}"])}});return he}function J(){var ie=['"use strict";',K,"return {"];Object.keys(Z).forEach(function(oe){ie.push('"',oe,'":',Z[oe].toString(),",")}),ie.push("}");var ue=Er(ie).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Q=Function.apply(null,c.concat(ue));return Q.apply(null,v)}return{global:K,link:N,block:V,proc:re,scope:I,cond:k,compile:J}}var xr="xyzw".split(""),ki=5121,Tr=1,ta=2,ra=0,na=1,aa=2,ia=3,hn=4,Bi=5,Pi=6,Ui="dither",ji="blend.enable",Vi="blend.color",oa="blend.equation",sa="blend.func",zi="depth.enable",Xi="depth.func",qi="depth.range",Wi="depth.mask",fa="colorMask",Hi="cull.enable",Yi="cull.face",ua="frontFace",ca="lineWidth",Ki="polygonOffset.enable",la="polygonOffset.offset",Qi="sample.alpha",Zi="sample.enable",ha="sample.coverage",Ji="stencil.enable",eo="stencil.mask",da="stencil.func",ma="stencil.opFront",$r="stencil.opBack",to="scissor.enable",dn="scissor.box",Wt="viewport",kr="profile",or="framebuffer",Br="vert",Pr="frag",sr="elements",fr="primitive",ur="count",mn="offset",pn="instances",Ur="vao",pa="Width",va="Height",Ar=or+pa,wr=or+va,lu=Wt+pa,hu=Wt+va,ro="drawingBuffer",no=ro+pa,ao=ro+va,du=[sa,oa,da,ma,$r,ha,Wt,dn,la],Sr=34962,mu=34963,pu=35632,vu=35633,io=3553,yu=34067,_u=2884,bu=3042,gu=3024,Eu=2960,xu=2929,Tu=3089,Au=32823,wu=32926,Su=32928,ya=5126,vn=35664,yn=35665,_n=35666,_a=5124,bn=35667,gn=35668,En=35669,ba=35670,xn=35671,Tn=35672,An=35673,jr=35674,Vr=35675,zr=35676,Xr=35678,qr=35680,oo=4,Wr=1028,cr=1029,so=2304,ga=2305,Ru=32775,Lu=32776,Cu=519,Kt=7680,fo=0,uo=1,co=32774,Ou=513,lo=36160,Fu=36064,zt={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ho=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Rr={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Qt={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},mo={frag:pu,vert:vu},Ea={cw:so,ccw:ga};function wn(n){return Array.isArray(n)||r(n)||Pt(n)}function po(n){return n.sort(function(c,v){return c===Wt?-1:v===Wt?1:c<v?-1:1})}function St(n,c,v,N){this.thisDep=n,this.contextDep=c,this.propDep=v,this.append=N}function Zt(n){return n&&!(n.thisDep||n.contextDep||n.propDep)}function ct(n){return new St(!1,!1,!1,n)}function Ct(n,c){var v=n.type;if(v===ra){var N=n.data.length;return new St(!0,N>=1,N>=2,c)}else if(v===hn){var V=n.data;return new St(V.thisDep,V.contextDep,V.propDep,c)}else{if(v===Bi)return new St(!1,!1,!1,c);if(v===Pi){for(var I=!1,k=!1,K=!1,Z=0;Z<n.data.length;++Z){var re=n.data[Z];if(re.type===na)K=!0;else if(re.type===aa)k=!0;else if(re.type===ia)I=!0;else if(re.type===ra){I=!0;var J=re.data;J>=1&&(k=!0),J>=2&&(K=!0)}else re.type===hn&&(I=I||re.data.thisDep,k=k||re.data.contextDep,K=K||re.data.propDep)}return new St(I,k,K,c)}else return new St(v===ia,v===aa,v===na,c)}}var vo=new St(!1,!1,!1,function(){});function Mu(n,c,v,N,V,I,k,K,Z,re,J,ie,ue,Q,oe){var L=re.Record,B={add:32774,subtract:32778,"reverse subtract":32779};v.ext_blend_minmax&&(B.min=Ru,B.max=Lu);var te=v.angle_instanced_arrays,he=v.webgl_draw_buffers,W={dirty:!0,profile:oe.profile},de={},Y=[],se={},H={};function fe(h){return h.replace(".","_")}function Ee(h,u,_){var R=fe(h);Y.push(h),de[R]=W[R]=!!_,se[R]=u}function Re(h,u,_){var R=fe(h);Y.push(h),Array.isArray(_)?(W[R]=_.slice(),de[R]=_.slice()):W[R]=de[R]=_,H[R]=u}Ee(Ui,gu),Ee(ji,bu),Re(Vi,"blendColor",[0,0,0,0]),Re(oa,"blendEquationSeparate",[co,co]),Re(sa,"blendFuncSeparate",[uo,fo,uo,fo]),Ee(zi,xu,!0),Re(Xi,"depthFunc",Ou),Re(qi,"depthRange",[0,1]),Re(Wi,"depthMask",!0),Re(fa,fa,[!0,!0,!0,!0]),Ee(Hi,_u),Re(Yi,"cullFace",cr),Re(ua,ua,ga),Re(ca,ca,1),Ee(Ki,Au),Re(la,"polygonOffset",[0,0]),Ee(Qi,wu),Ee(Zi,Su),Re(ha,"sampleCoverage",[1,!1]),Ee(Ji,Eu),Re(eo,"stencilMask",-1),Re(da,"stencilFunc",[Cu,0,-1]),Re(ma,"stencilOpSeparate",[Wr,Kt,Kt,Kt]),Re($r,"stencilOpSeparate",[cr,Kt,Kt,Kt]),Ee(to,Tu),Re(dn,"scissor",[0,0,n.drawingBufferWidth,n.drawingBufferHeight]),Re(Wt,Wt,[0,0,n.drawingBufferWidth,n.drawingBufferHeight]);var ce={gl:n,context:ue,strings:c,next:de,current:W,draw:ie,elements:I,buffer:V,shader:J,attributes:re.state,vao:re,uniforms:Z,framebuffer:K,extensions:v,timer:Q,isBufferArgs:wn},ne={primTypes:hr,compareFuncs:Rr,blendFuncs:zt,blendEquations:B,stencilOps:Qt,glTypes:tr,orientationType:Ea};m.optional(function(){ce.isArrayLike=it}),he&&(ne.backBuffer=[cr],ne.drawBuffer=Lt(N.maxDrawbuffers,function(h){return h===0?[0]:Lt(h,function(u){return Fu+u})}));var X=0;function we(){var h=cu(),u=h.link,_=h.global;h.id=X++,h.batchId="0";var R=u(ce),C=h.shared={props:"a0"};Object.keys(ce).forEach(function(y){C[y]=_.def(R,".",y)}),m.optional(function(){h.CHECK=u(m),h.commandStr=m.guessCommand(),h.command=u(h.commandStr),h.assert=function(y,l,w){y("if(!(",l,"))",this.CHECK,".commandRaise(",u(w),",",this.command,");")},ne.invalidBlendCombinations=ho});var E=h.next={},b=h.current={};Object.keys(H).forEach(function(y){Array.isArray(W[y])&&(E[y]=_.def(C.next,".",y),b[y]=_.def(C.current,".",y))});var A=h.constants={};Object.keys(ne).forEach(function(y){A[y]=_.def(JSON.stringify(ne[y]))}),h.invoke=function(y,l){switch(l.type){case ra:var w=["this",C.context,C.props,h.batchId];return y.def(u(l.data),".call(",w.slice(0,Math.max(l.data.length+1,4)),")");case na:return y.def(C.props,l.data);case aa:return y.def(C.context,l.data);case ia:return y.def("this",l.data);case hn:return l.data.append(h,y),l.data.ref;case Bi:return l.data.toString();case Pi:return l.data.map(function(F){return h.invoke(y,F)})}},h.attribCache={};var d={};return h.scopeAttrib=function(y){var l=c.id(y);if(l in d)return d[l];var w=re.scope[l];w||(w=re.scope[l]=new L);var F=d[l]=u(w);return F},h}function De(h){var u=h.static,_=h.dynamic,R;if(kr in u){var C=!!u[kr];R=ct(function(b,A){return C}),R.enable=C}else if(kr in _){var E=_[kr];R=Ct(E,function(b,A){return b.invoke(A,E)})}return R}function ye(h,u){var _=h.static,R=h.dynamic;if(or in _){var C=_[or];return C?(C=K.getFramebuffer(C),m.command(C,"invalid framebuffer object"),ct(function(b,A){var d=b.link(C),y=b.shared;A.set(y.framebuffer,".next",d);var l=y.context;return A.set(l,"."+Ar,d+".width"),A.set(l,"."+wr,d+".height"),d})):ct(function(b,A){var d=b.shared;A.set(d.framebuffer,".next","null");var y=d.context;return A.set(y,"."+Ar,y+"."+no),A.set(y,"."+wr,y+"."+ao),"null"})}else if(or in R){var E=R[or];return Ct(E,function(b,A){var d=b.invoke(A,E),y=b.shared,l=y.framebuffer,w=A.def(l,".getFramebuffer(",d,")");m.optional(function(){b.assert(A,"!"+d+"||"+w,"invalid framebuffer object")}),A.set(l,".next",w);var F=y.context;return A.set(F,"."+Ar,w+"?"+w+".width:"+F+"."+no),A.set(F,"."+wr,w+"?"+w+".height:"+F+"."+ao),w})}else return null}function Be(h,u,_){var R=h.static,C=h.dynamic;function E(d){if(d in R){var y=R[d];m.commandType(y,"object","invalid "+d,_.commandStr);var l=!0,w=y.x|0,F=y.y|0,j,z;return"width"in y?(j=y.width|0,m.command(j>=0,"invalid "+d,_.commandStr)):l=!1,"height"in y?(z=y.height|0,m.command(z>=0,"invalid "+d,_.commandStr)):l=!1,new St(!l&&u&&u.thisDep,!l&&u&&u.contextDep,!l&&u&&u.propDep,function(be,Ge){var _e=be.shared.context,Ae=j;"width"in y||(Ae=Ge.def(_e,".",Ar,"-",w));var Ce=z;return"height"in y||(Ce=Ge.def(_e,".",wr,"-",F)),[w,F,Ae,Ce]})}else if(d in C){var U=C[d],ee=Ct(U,function(be,Ge){var _e=be.invoke(Ge,U);m.optional(function(){be.assert(Ge,_e+"&&typeof "+_e+'==="object"',"invalid "+d)});var Ae=be.shared.context,Ce=Ge.def(_e,".x|0"),Ke=Ge.def(_e,".y|0"),nt=Ge.def('"width" in ',_e,"?",_e,".width|0:","(",Ae,".",Ar,"-",Ce,")"),Rt=Ge.def('"height" in ',_e,"?",_e,".height|0:","(",Ae,".",wr,"-",Ke,")");return m.optional(function(){be.assert(Ge,nt+">=0&&"+Rt+">=0","invalid "+d)}),[Ce,Ke,nt,Rt]});return u&&(ee.thisDep=ee.thisDep||u.thisDep,ee.contextDep=ee.contextDep||u.contextDep,ee.propDep=ee.propDep||u.propDep),ee}else return u?new St(u.thisDep,u.contextDep,u.propDep,function(be,Ge){var _e=be.shared.context;return[0,0,Ge.def(_e,".",Ar),Ge.def(_e,".",wr)]}):null}var b=E(Wt);if(b){var A=b;b=new St(b.thisDep,b.contextDep,b.propDep,function(d,y){var l=A.append(d,y),w=d.shared.context;return y.set(w,"."+lu,l[2]),y.set(w,"."+hu,l[3]),l})}return{viewport:b,scissor_box:E(dn)}}function Le(h,u){var _=h.static,R=typeof _[Pr]=="string"&&typeof _[Br]=="string";if(R){if(Object.keys(u.dynamic).length>0)return null;var C=u.static,E=Object.keys(C);if(E.length>0&&typeof C[E[0]]=="number"){for(var b=[],A=0;A<E.length;++A)m(typeof C[E[A]]=="number","must specify all vertex attribute locations when using vaos"),b.push([C[E[A]]|0,E[A]]);return b}}return null}function ke(h,u,_){var R=h.static,C=h.dynamic;function E(l){if(l in R){var w=c.id(R[l]);m.optional(function(){J.shader(mo[l],w,m.guessCommand())});var F=ct(function(){return w});return F.id=w,F}else if(l in C){var j=C[l];return Ct(j,function(z,U){var ee=z.invoke(U,j),be=U.def(z.shared.strings,".id(",ee,")");return m.optional(function(){U(z.shared.shader,".shader(",mo[l],",",be,",",z.command,");")}),be})}return null}var b=E(Pr),A=E(Br),d=null,y;return Zt(b)&&Zt(A)?(d=J.program(A.id,b.id,null,_),y=ct(function(l,w){return l.link(d)})):y=new St(b&&b.thisDep||A&&A.thisDep,b&&b.contextDep||A&&A.contextDep,b&&b.propDep||A&&A.propDep,function(l,w){var F=l.shared.shader,j;b?j=b.append(l,w):j=w.def(F,".",Pr);var z;A?z=A.append(l,w):z=w.def(F,".",Br);var U=F+".program("+z+","+j;return m.optional(function(){U+=","+l.command}),w.def(U+")")}),{frag:b,vert:A,progVar:y,program:d}}function Ye(h,u){var _=h.static,R=h.dynamic;function C(){if(sr in _){var l=_[sr];wn(l)?l=I.getElements(I.create(l,!0)):l&&(l=I.getElements(l),m.command(l,"invalid elements",u.commandStr));var w=ct(function(j,z){if(l){var U=j.link(l);return j.ELEMENTS=U,U}return j.ELEMENTS=null,null});return w.value=l,w}else if(sr in R){var F=R[sr];return Ct(F,function(j,z){var U=j.shared,ee=U.isBufferArgs,be=U.elements,Ge=j.invoke(z,F),_e=z.def("null"),Ae=z.def(ee,"(",Ge,")"),Ce=j.cond(Ae).then(_e,"=",be,".createStream(",Ge,");").else(_e,"=",be,".getElements(",Ge,");");return m.optional(function(){j.assert(Ce.else,"!"+Ge+"||"+_e,"invalid elements")}),z.entry(Ce),z.exit(j.cond(Ae).then(be,".destroyStream(",_e,");")),j.ELEMENTS=_e,_e})}return null}var E=C();function b(){if(fr in _){var l=_[fr];return m.commandParameter(l,hr,"invalid primitve",u.commandStr),ct(function(F,j){return hr[l]})}else if(fr in R){var w=R[fr];return Ct(w,function(F,j){var z=F.constants.primTypes,U=F.invoke(j,w);return m.optional(function(){F.assert(j,U+" in "+z,"invalid primitive, must be one of "+Object.keys(hr))}),j.def(z,"[",U,"]")})}else if(E)return Zt(E)?E.value?ct(function(F,j){return j.def(F.ELEMENTS,".primType")}):ct(function(){return oo}):new St(E.thisDep,E.contextDep,E.propDep,function(F,j){var z=F.ELEMENTS;return j.def(z,"?",z,".primType:",oo)});return null}function A(l,w){if(l in _){var F=_[l]|0;return m.command(!w||F>=0,"invalid "+l,u.commandStr),ct(function(z,U){return w&&(z.OFFSET=F),F})}else if(l in R){var j=R[l];return Ct(j,function(z,U){var ee=z.invoke(U,j);return w&&(z.OFFSET=ee,m.optional(function(){z.assert(U,ee+">=0","invalid "+l)})),ee})}else if(w&&E)return ct(function(z,U){return z.OFFSET="0",0});return null}var d=A(mn,!0);function y(){if(ur in _){var l=_[ur]|0;return m.command(typeof l=="number"&&l>=0,"invalid vertex count",u.commandStr),ct(function(){return l})}else if(ur in R){var w=R[ur];return Ct(w,function(z,U){var ee=z.invoke(U,w);return m.optional(function(){z.assert(U,"typeof "+ee+'==="number"&&'+ee+">=0&&"+ee+"===("+ee+"|0)","invalid vertex count")}),ee})}else if(E)if(Zt(E)){if(E)return d?new St(d.thisDep,d.contextDep,d.propDep,function(z,U){var ee=U.def(z.ELEMENTS,".vertCount-",z.OFFSET);return m.optional(function(){z.assert(U,ee+">=0","invalid vertex offset/element buffer too small")}),ee}):ct(function(z,U){return U.def(z.ELEMENTS,".vertCount")});var F=ct(function(){return-1});return m.optional(function(){F.MISSING=!0}),F}else{var j=new St(E.thisDep||d.thisDep,E.contextDep||d.contextDep,E.propDep||d.propDep,function(z,U){var ee=z.ELEMENTS;return z.OFFSET?U.def(ee,"?",ee,".vertCount-",z.OFFSET,":-1"):U.def(ee,"?",ee,".vertCount:-1")});return m.optional(function(){j.DYNAMIC=!0}),j}return null}return{elements:E,primitive:b(),count:y(),instances:A(pn,!1),offset:d}}function lt(h,u){var _=h.static,R=h.dynamic,C={};return Y.forEach(function(E){var b=fe(E);function A(d,y){if(E in _){var l=d(_[E]);C[b]=ct(function(){return l})}else if(E in R){var w=R[E];C[b]=Ct(w,function(F,j){return y(F,j,F.invoke(j,w))})}}switch(E){case Hi:case ji:case Ui:case Ji:case zi:case to:case Ki:case Qi:case Zi:case Wi:return A(function(d){return m.commandType(d,"boolean",E,u.commandStr),d},function(d,y,l){return m.optional(function(){d.assert(y,"typeof "+l+'==="boolean"',"invalid flag "+E,d.commandStr)}),l});case Xi:return A(function(d){return m.commandParameter(d,Rr,"invalid "+E,u.commandStr),Rr[d]},function(d,y,l){var w=d.constants.compareFuncs;return m.optional(function(){d.assert(y,l+" in "+w,"invalid "+E+", must be one of "+Object.keys(Rr))}),y.def(w,"[",l,"]")});case qi:return A(function(d){return m.command(it(d)&&d.length===2&&typeof d[0]=="number"&&typeof d[1]=="number"&&d[0]<=d[1],"depth range is 2d array",u.commandStr),d},function(d,y,l){m.optional(function(){d.assert(y,d.shared.isArrayLike+"("+l+")&&"+l+".length===2&&typeof "+l+'[0]==="number"&&typeof '+l+'[1]==="number"&&'+l+"[0]<="+l+"[1]","depth range must be a 2d array")});var w=y.def("+",l,"[0]"),F=y.def("+",l,"[1]");return[w,F]});case sa:return A(function(d){m.commandType(d,"object","blend.func",u.commandStr);var y="srcRGB"in d?d.srcRGB:d.src,l="srcAlpha"in d?d.srcAlpha:d.src,w="dstRGB"in d?d.dstRGB:d.dst,F="dstAlpha"in d?d.dstAlpha:d.dst;return m.commandParameter(y,zt,b+".srcRGB",u.commandStr),m.commandParameter(l,zt,b+".srcAlpha",u.commandStr),m.commandParameter(w,zt,b+".dstRGB",u.commandStr),m.commandParameter(F,zt,b+".dstAlpha",u.commandStr),m.command(ho.indexOf(y+", "+w)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+y+", "+w+")",u.commandStr),[zt[y],zt[w],zt[l],zt[F]]},function(d,y,l){var w=d.constants.blendFuncs;m.optional(function(){d.assert(y,l+"&&typeof "+l+'==="object"',"invalid blend func, must be an object")});function F(_e,Ae){var Ce=y.def('"',_e,Ae,'" in ',l,"?",l,".",_e,Ae,":",l,".",_e);return m.optional(function(){d.assert(y,Ce+" in "+w,"invalid "+E+"."+_e+Ae+", must be one of "+Object.keys(zt))}),Ce}var j=F("src","RGB"),z=F("dst","RGB");m.optional(function(){var _e=d.constants.invalidBlendCombinations;d.assert(y,_e+".indexOf("+j+'+", "+'+z+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var U=y.def(w,"[",j,"]"),ee=y.def(w,"[",F("src","Alpha"),"]"),be=y.def(w,"[",z,"]"),Ge=y.def(w,"[",F("dst","Alpha"),"]");return[U,be,ee,Ge]});case oa:return A(function(d){if(typeof d=="string")return m.commandParameter(d,B,"invalid "+E,u.commandStr),[B[d],B[d]];if(typeof d=="object")return m.commandParameter(d.rgb,B,E+".rgb",u.commandStr),m.commandParameter(d.alpha,B,E+".alpha",u.commandStr),[B[d.rgb],B[d.alpha]];m.commandRaise("invalid blend.equation",u.commandStr)},function(d,y,l){var w=d.constants.blendEquations,F=y.def(),j=y.def(),z=d.cond("typeof ",l,'==="string"');return m.optional(function(){function U(ee,be,Ge){d.assert(ee,Ge+" in "+w,"invalid "+be+", must be one of "+Object.keys(B))}U(z.then,E,l),d.assert(z.else,l+"&&typeof "+l+'==="object"',"invalid "+E),U(z.else,E+".rgb",l+".rgb"),U(z.else,E+".alpha",l+".alpha")}),z.then(F,"=",j,"=",w,"[",l,"];"),z.else(F,"=",w,"[",l,".rgb];",j,"=",w,"[",l,".alpha];"),y(z),[F,j]});case Vi:return A(function(d){return m.command(it(d)&&d.length===4,"blend.color must be a 4d array",u.commandStr),Lt(4,function(y){return+d[y]})},function(d,y,l){return m.optional(function(){d.assert(y,d.shared.isArrayLike+"("+l+")&&"+l+".length===4","blend.color must be a 4d array")}),Lt(4,function(w){return y.def("+",l,"[",w,"]")})});case eo:return A(function(d){return m.commandType(d,"number",b,u.commandStr),d|0},function(d,y,l){return m.optional(function(){d.assert(y,"typeof "+l+'==="number"',"invalid stencil.mask")}),y.def(l,"|0")});case da:return A(function(d){m.commandType(d,"object",b,u.commandStr);var y=d.cmp||"keep",l=d.ref||0,w="mask"in d?d.mask:-1;return m.commandParameter(y,Rr,E+".cmp",u.commandStr),m.commandType(l,"number",E+".ref",u.commandStr),m.commandType(w,"number",E+".mask",u.commandStr),[Rr[y],l,w]},function(d,y,l){var w=d.constants.compareFuncs;m.optional(function(){function U(){d.assert(y,Array.prototype.join.call(arguments,""),"invalid stencil.func")}U(l+"&&typeof ",l,'==="object"'),U('!("cmp" in ',l,")||(",l,".cmp in ",w,")")});var F=y.def('"cmp" in ',l,"?",w,"[",l,".cmp]",":",Kt),j=y.def(l,".ref|0"),z=y.def('"mask" in ',l,"?",l,".mask|0:-1");return[F,j,z]});case ma:case $r:return A(function(d){m.commandType(d,"object",b,u.commandStr);var y=d.fail||"keep",l=d.zfail||"keep",w=d.zpass||"keep";return m.commandParameter(y,Qt,E+".fail",u.commandStr),m.commandParameter(l,Qt,E+".zfail",u.commandStr),m.commandParameter(w,Qt,E+".zpass",u.commandStr),[E===$r?cr:Wr,Qt[y],Qt[l],Qt[w]]},function(d,y,l){var w=d.constants.stencilOps;m.optional(function(){d.assert(y,l+"&&typeof "+l+'==="object"',"invalid "+E)});function F(j){return m.optional(function(){d.assert(y,'!("'+j+'" in '+l+")||("+l+"."+j+" in "+w+")","invalid "+E+"."+j+", must be one of "+Object.keys(Qt))}),y.def('"',j,'" in ',l,"?",w,"[",l,".",j,"]:",Kt)}return[E===$r?cr:Wr,F("fail"),F("zfail"),F("zpass")]});case la:return A(function(d){m.commandType(d,"object",b,u.commandStr);var y=d.factor|0,l=d.units|0;return m.commandType(y,"number",b+".factor",u.commandStr),m.commandType(l,"number",b+".units",u.commandStr),[y,l]},function(d,y,l){m.optional(function(){d.assert(y,l+"&&typeof "+l+'==="object"',"invalid "+E)});var w=y.def(l,".factor|0"),F=y.def(l,".units|0");return[w,F]});case Yi:return A(function(d){var y=0;return d==="front"?y=Wr:d==="back"&&(y=cr),m.command(!!y,b,u.commandStr),y},function(d,y,l){return m.optional(function(){d.assert(y,l+'==="front"||'+l+'==="back"',"invalid cull.face")}),y.def(l,'==="front"?',Wr,":",cr)});case ca:return A(function(d){return m.command(typeof d=="number"&&d>=N.lineWidthDims[0]&&d<=N.lineWidthDims[1],"invalid line width, must be a positive number between "+N.lineWidthDims[0]+" and "+N.lineWidthDims[1],u.commandStr),d},function(d,y,l){return m.optional(function(){d.assert(y,"typeof "+l+'==="number"&&'+l+">="+N.lineWidthDims[0]+"&&"+l+"<="+N.lineWidthDims[1],"invalid line width")}),l});case ua:return A(function(d){return m.commandParameter(d,Ea,b,u.commandStr),Ea[d]},function(d,y,l){return m.optional(function(){d.assert(y,l+'==="cw"||'+l+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),y.def(l+'==="cw"?'+so+":"+ga)});case fa:return A(function(d){return m.command(it(d)&&d.length===4,"color.mask must be length 4 array",u.commandStr),d.map(function(y){return!!y})},function(d,y,l){return m.optional(function(){d.assert(y,d.shared.isArrayLike+"("+l+")&&"+l+".length===4","invalid color.mask")}),Lt(4,function(w){return"!!"+l+"["+w+"]"})});case ha:return A(function(d){m.command(typeof d=="object"&&d,b,u.commandStr);var y="value"in d?d.value:1,l=!!d.invert;return m.command(typeof y=="number"&&y>=0&&y<=1,"sample.coverage.value must be a number between 0 and 1",u.commandStr),[y,l]},function(d,y,l){m.optional(function(){d.assert(y,l+"&&typeof "+l+'==="object"',"invalid sample.coverage")});var w=y.def('"value" in ',l,"?+",l,".value:1"),F=y.def("!!",l,".invert");return[w,F]})}}),C}function vt(h,u){var _=h.static,R=h.dynamic,C={};return Object.keys(_).forEach(function(E){var b=_[E],A;if(typeof b=="number"||typeof b=="boolean")A=ct(function(){return b});else if(typeof b=="function"){var d=b._reglType;d==="texture2d"||d==="textureCube"?A=ct(function(y){return y.link(b)}):d==="framebuffer"||d==="framebufferCube"?(m.command(b.color.length>0,'missing color attachment for framebuffer sent to uniform "'+E+'"',u.commandStr),A=ct(function(y){return y.link(b.color[0])})):m.commandRaise('invalid data for uniform "'+E+'"',u.commandStr)}else it(b)?A=ct(function(y){var l=y.global.def("[",Lt(b.length,function(w){return m.command(typeof b[w]=="number"||typeof b[w]=="boolean","invalid uniform "+E,y.commandStr),b[w]}),"]");return l}):m.commandRaise('invalid or missing data for uniform "'+E+'"',u.commandStr);A.value=b,C[E]=A}),Object.keys(R).forEach(function(E){var b=R[E];C[E]=Ct(b,function(A,d){return A.invoke(d,b)})}),C}function je(h,u){var _=h.static,R=h.dynamic,C={};return Object.keys(_).forEach(function(E){var b=_[E],A=c.id(E),d=new L;if(wn(b))d.state=Tr,d.buffer=V.getBuffer(V.create(b,Sr,!1,!0)),d.type=0;else{var y=V.getBuffer(b);if(y)d.state=Tr,d.buffer=y,d.type=0;else if(m.command(typeof b=="object"&&b,"invalid data for attribute "+E,u.commandStr),"constant"in b){var l=b.constant;d.buffer="null",d.state=ta,typeof l=="number"?d.x=l:(m.command(it(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+E,u.commandStr),xr.forEach(function(be,Ge){Ge<l.length&&(d[be]=l[Ge])}))}else{wn(b.buffer)?y=V.getBuffer(V.create(b.buffer,Sr,!1,!0)):y=V.getBuffer(b.buffer),m.command(!!y,'missing buffer for attribute "'+E+'"',u.commandStr);var w=b.offset|0;m.command(w>=0,'invalid offset for attribute "'+E+'"',u.commandStr);var F=b.stride|0;m.command(F>=0&&F<256,'invalid stride for attribute "'+E+'", must be integer betweeen [0, 255]',u.commandStr);var j=b.size|0;m.command(!("size"in b)||j>0&&j<=4,'invalid size for attribute "'+E+'", must be 1,2,3,4',u.commandStr);var z=!!b.normalized,U=0;"type"in b&&(m.commandParameter(b.type,tr,"invalid type for attribute "+E,u.commandStr),U=tr[b.type]);var ee=b.divisor|0;"divisor"in b&&(m.command(ee===0||te,'cannot specify divisor for attribute "'+E+'", instancing not supported',u.commandStr),m.command(ee>=0,'invalid divisor for attribute "'+E+'"',u.commandStr)),m.optional(function(){var be=u.commandStr,Ge=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(b).forEach(function(_e){m.command(Ge.indexOf(_e)>=0,'unknown parameter "'+_e+'" for attribute pointer "'+E+'" (valid parameters are '+Ge+")",be)})}),d.buffer=y,d.state=Tr,d.size=j,d.normalized=z,d.type=U||y.dtype,d.offset=w,d.stride=F,d.divisor=ee}}C[E]=ct(function(be,Ge){var _e=be.attribCache;if(A in _e)return _e[A];var Ae={isStream:!1};return Object.keys(d).forEach(function(Ce){Ae[Ce]=d[Ce]}),d.buffer&&(Ae.buffer=be.link(d.buffer),Ae.type=Ae.type||Ae.buffer+".dtype"),_e[A]=Ae,Ae})}),Object.keys(R).forEach(function(E){var b=R[E];function A(d,y){var l=d.invoke(y,b),w=d.shared,F=d.constants,j=w.isBufferArgs,z=w.buffer;m.optional(function(){d.assert(y,l+"&&(typeof "+l+'==="object"||typeof '+l+'==="function")&&('+j+"("+l+")||"+z+".getBuffer("+l+")||"+z+".getBuffer("+l+".buffer)||"+j+"("+l+'.buffer)||("constant" in '+l+"&&(typeof "+l+'.constant==="number"||'+w.isArrayLike+"("+l+".constant))))",'invalid dynamic attribute "'+E+'"')});var U={isStream:y.def(!1)},ee=new L;ee.state=Tr,Object.keys(ee).forEach(function(Ae){U[Ae]=y.def(""+ee[Ae])});var be=U.buffer,Ge=U.type;y("if(",j,"(",l,")){",U.isStream,"=true;",be,"=",z,".createStream(",Sr,",",l,");",Ge,"=",be,".dtype;","}else{",be,"=",z,".getBuffer(",l,");","if(",be,"){",Ge,"=",be,".dtype;",'}else if("constant" in ',l,"){",U.state,"=",ta,";","if(typeof "+l+'.constant === "number"){',U[xr[0]],"=",l,".constant;",xr.slice(1).map(function(Ae){return U[Ae]}).join("="),"=0;","}else{",xr.map(function(Ae,Ce){return U[Ae]+"="+l+".constant.length>"+Ce+"?"+l+".constant["+Ce+"]:0;"}).join(""),"}}else{","if(",j,"(",l,".buffer)){",be,"=",z,".createStream(",Sr,",",l,".buffer);","}else{",be,"=",z,".getBuffer(",l,".buffer);","}",Ge,'="type" in ',l,"?",F.glTypes,"[",l,".type]:",be,".dtype;",U.normalized,"=!!",l,".normalized;");function _e(Ae){y(U[Ae],"=",l,".",Ae,"|0;")}return _e("size"),_e("offset"),_e("stride"),_e("divisor"),y("}}"),y.exit("if(",U.isStream,"){",z,".destroyStream(",be,");","}"),U}C[E]=Ct(b,A)}),C}function dt(h,u){var _=h.static,R=h.dynamic;if(Ur in _){var C=_[Ur];return C!==null&&re.getVAO(C)===null&&(C=re.createVAO(C)),ct(function(b){return b.link(re.getVAO(C))})}else if(Ur in R){var E=R[Ur];return Ct(E,function(b,A){var d=b.invoke(A,E);return A.def(b.shared.vao+".getVAO("+d+")")})}return null}function rt(h){var u=h.static,_=h.dynamic,R={};return Object.keys(u).forEach(function(C){var E=u[C];R[C]=ct(function(b,A){return typeof E=="number"||typeof E=="boolean"?""+E:b.link(E)})}),Object.keys(_).forEach(function(C){var E=_[C];R[C]=Ct(E,function(b,A){return b.invoke(A,E)})}),R}function ht(h,u,_,R,C){var E=h.static,b=h.dynamic;m.optional(function(){var _e=[or,Br,Pr,sr,fr,mn,ur,pn,kr,Ur].concat(Y);function Ae(Ce){Object.keys(Ce).forEach(function(Ke){m.command(_e.indexOf(Ke)>=0,'unknown parameter "'+Ke+'"',C.commandStr)})}Ae(E),Ae(b)});var A=Le(h,u),d=ye(h),y=Be(h,d,C),l=Ye(h,C),w=lt(h,C),F=ke(h,C,A);function j(_e){var Ae=y[_e];Ae&&(w[_e]=Ae)}j(Wt),j(fe(dn));var z=Object.keys(w).length>0,U={framebuffer:d,draw:l,shader:F,state:w,dirty:z,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(U.profile=De(h),U.uniforms=vt(_,C),U.drawVAO=U.scopeVAO=dt(h),!U.drawVAO&&F.program&&!A&&v.angle_instanced_arrays){var ee=!0,be=F.program.attributes.map(function(_e){var Ae=u.static[_e];return ee=ee&&!!Ae,Ae});if(ee&&be.length>0){var Ge=re.getVAO(re.createVAO(be));U.drawVAO=new St(null,null,null,function(_e,Ae){return _e.link(Ge)}),U.useVAO=!0}}return A?U.useVAO=!0:U.attributes=je(u,C),U.context=rt(R),U}function mt(h,u,_){var R=h.shared,C=R.context,E=h.scope();Object.keys(_).forEach(function(b){u.save(C,"."+b);var A=_[b],d=A.append(h,u);Array.isArray(d)?E(C,".",b,"=[",d.join(),"];"):E(C,".",b,"=",d,";")}),u(E)}function pt(h,u,_,R){var C=h.shared,E=C.gl,b=C.framebuffer,A;he&&(A=u.def(C.extensions,".webgl_draw_buffers"));var d=h.constants,y=d.drawBuffer,l=d.backBuffer,w;_?w=_.append(h,u):w=u.def(b,".next"),R||u("if(",w,"!==",b,".cur){"),u("if(",w,"){",E,".bindFramebuffer(",lo,",",w,".framebuffer);"),he&&u(A,".drawBuffersWEBGL(",y,"[",w,".colorAttachments.length]);"),u("}else{",E,".bindFramebuffer(",lo,",null);"),he&&u(A,".drawBuffersWEBGL(",l,");"),u("}",b,".cur=",w,";"),R||u("}")}function yt(h,u,_){var R=h.shared,C=R.gl,E=h.current,b=h.next,A=R.current,d=R.next,y=h.cond(A,".dirty");Y.forEach(function(l){var w=fe(l);if(!(w in _.state)){var F,j;if(w in b){F=b[w],j=E[w];var z=Lt(W[w].length,function(ee){return y.def(F,"[",ee,"]")});y(h.cond(z.map(function(ee,be){return ee+"!=="+j+"["+be+"]"}).join("||")).then(C,".",H[w],"(",z,");",z.map(function(ee,be){return j+"["+be+"]="+ee}).join(";"),";"))}else{F=y.def(d,".",w);var U=h.cond(F,"!==",A,".",w);y(U),w in se?U(h.cond(F).then(C,".enable(",se[w],");").else(C,".disable(",se[w],");"),A,".",w,"=",F,";"):U(C,".",H[w],"(",F,");",A,".",w,"=",F,";")}}}),Object.keys(_.state).length===0&&y(A,".dirty=false;"),u(y)}function Tt(h,u,_,R){var C=h.shared,E=h.current,b=C.current,A=C.gl;po(Object.keys(_)).forEach(function(d){var y=_[d];if(!(R&&!R(y))){var l=y.append(h,u);if(se[d]){var w=se[d];Zt(y)?l?u(A,".enable(",w,");"):u(A,".disable(",w,");"):u(h.cond(l).then(A,".enable(",w,");").else(A,".disable(",w,");")),u(b,".",d,"=",l,";")}else if(it(l)){var F=E[d];u(A,".",H[d],"(",l,");",l.map(function(j,z){return F+"["+z+"]="+j}).join(";"),";")}else u(A,".",H[d],"(",l,");",b,".",d,"=",l,";")}})}function ot(h,u){te&&(h.instancing=u.def(h.shared.extensions,".angle_instanced_arrays"))}function Ie(h,u,_,R,C){var E=h.shared,b=h.stats,A=E.current,d=E.timer,y=_.profile;function l(){return typeof performance>"u"?"Date.now()":"performance.now()"}var w,F;function j(_e){w=u.def(),_e(w,"=",l(),";"),typeof C=="string"?_e(b,".count+=",C,";"):_e(b,".count++;"),Q&&(R?(F=u.def(),_e(F,"=",d,".getNumPendingQueries();")):_e(d,".beginQuery(",b,");"))}function z(_e){_e(b,".cpuTime+=",l(),"-",w,";"),Q&&(R?_e(d,".pushScopeStats(",F,",",d,".getNumPendingQueries(),",b,");"):_e(d,".endQuery();"))}function U(_e){var Ae=u.def(A,".profile");u(A,".profile=",_e,";"),u.exit(A,".profile=",Ae,";")}var ee;if(y){if(Zt(y)){y.enable?(j(u),z(u.exit),U("true")):U("false");return}ee=y.append(h,u),U(ee)}else ee=u.def(A,".profile");var be=h.block();j(be),u("if(",ee,"){",be,"}");var Ge=h.block();z(Ge),u.exit("if(",ee,"){",Ge,"}")}function At(h,u,_,R,C){var E=h.shared;function b(d){switch(d){case vn:case bn:case xn:return 2;case yn:case gn:case Tn:return 3;case _n:case En:case An:return 4;default:return 1}}function A(d,y,l){var w=E.gl,F=u.def(d,".location"),j=u.def(E.attributes,"[",F,"]"),z=l.state,U=l.buffer,ee=[l.x,l.y,l.z,l.w],be=["buffer","normalized","offset","stride"];function Ge(){u("if(!",j,".buffer){",w,".enableVertexAttribArray(",F,");}");var Ae=l.type,Ce;if(l.size?Ce=u.def(l.size,"||",y):Ce=y,u("if(",j,".type!==",Ae,"||",j,".size!==",Ce,"||",be.map(function(nt){return j+"."+nt+"!=="+l[nt]}).join("||"),"){",w,".bindBuffer(",Sr,",",U,".buffer);",w,".vertexAttribPointer(",[F,Ce,Ae,l.normalized,l.stride,l.offset],");",j,".type=",Ae,";",j,".size=",Ce,";",be.map(function(nt){return j+"."+nt+"="+l[nt]+";"}).join(""),"}"),te){var Ke=l.divisor;u("if(",j,".divisor!==",Ke,"){",h.instancing,".vertexAttribDivisorANGLE(",[F,Ke],");",j,".divisor=",Ke,";}")}}function _e(){u("if(",j,".buffer){",w,".disableVertexAttribArray(",F,");",j,".buffer=null;","}if(",xr.map(function(Ae,Ce){return j+"."+Ae+"!=="+ee[Ce]}).join("||"),"){",w,".vertexAttrib4f(",F,",",ee,");",xr.map(function(Ae,Ce){return j+"."+Ae+"="+ee[Ce]+";"}).join(""),"}")}z===Tr?Ge():z===ta?_e():(u("if(",z,"===",Tr,"){"),Ge(),u("}else{"),_e(),u("}"))}R.forEach(function(d){var y=d.name,l=_.attributes[y],w;if(l){if(!C(l))return;w=l.append(h,u)}else{if(!C(vo))return;var F=h.scopeAttrib(y);m.optional(function(){h.assert(u,F+".state","missing attribute "+y)}),w={},Object.keys(new L).forEach(function(j){w[j]=u.def(F,".",j)})}A(h.link(d),b(d.info.type),w)})}function Ze(h,u,_,R,C){for(var E=h.shared,b=E.gl,A,d=0;d<R.length;++d){var y=R[d],l=y.name,w=y.info.type,F=_.uniforms[l],j=h.link(y),z=j+".location",U;if(F){if(!C(F))continue;if(Zt(F)){var ee=F.value;if(m.command(ee!==null&&typeof ee<"u",'missing uniform "'+l+'"',h.commandStr),w===Xr||w===qr){m.command(typeof ee=="function"&&(w===Xr&&(ee._reglType==="texture2d"||ee._reglType==="framebuffer")||w===qr&&(ee._reglType==="textureCube"||ee._reglType==="framebufferCube")),"invalid texture for uniform "+l,h.commandStr);var be=h.link(ee._texture||ee.color[0]._texture);u(b,".uniform1i(",z,",",be+".bind());"),u.exit(be,".unbind();")}else if(w===jr||w===Vr||w===zr){m.optional(function(){m.command(it(ee),"invalid matrix for uniform "+l,h.commandStr),m.command(w===jr&&ee.length===4||w===Vr&&ee.length===9||w===zr&&ee.length===16,"invalid length for matrix uniform "+l,h.commandStr)});var Ge=h.global.def("new Float32Array(["+Array.prototype.slice.call(ee)+"])"),_e=2;w===Vr?_e=3:w===zr&&(_e=4),u(b,".uniformMatrix",_e,"fv(",z,",false,",Ge,");")}else{switch(w){case ya:m.commandType(ee,"number","uniform "+l,h.commandStr),A="1f";break;case vn:m.command(it(ee)&&ee.length===2,"uniform "+l,h.commandStr),A="2f";break;case yn:m.command(it(ee)&&ee.length===3,"uniform "+l,h.commandStr),A="3f";break;case _n:m.command(it(ee)&&ee.length===4,"uniform "+l,h.commandStr),A="4f";break;case ba:m.commandType(ee,"boolean","uniform "+l,h.commandStr),A="1i";break;case _a:m.commandType(ee,"number","uniform "+l,h.commandStr),A="1i";break;case xn:m.command(it(ee)&&ee.length===2,"uniform "+l,h.commandStr),A="2i";break;case bn:m.command(it(ee)&&ee.length===2,"uniform "+l,h.commandStr),A="2i";break;case Tn:m.command(it(ee)&&ee.length===3,"uniform "+l,h.commandStr),A="3i";break;case gn:m.command(it(ee)&&ee.length===3,"uniform "+l,h.commandStr),A="3i";break;case An:m.command(it(ee)&&ee.length===4,"uniform "+l,h.commandStr),A="4i";break;case En:m.command(it(ee)&&ee.length===4,"uniform "+l,h.commandStr),A="4i";break}u(b,".uniform",A,"(",z,",",it(ee)?Array.prototype.slice.call(ee):ee,");")}continue}else U=F.append(h,u)}else{if(!C(vo))continue;U=u.def(E.uniforms,"[",c.id(l),"]")}w===Xr?(m(!Array.isArray(U),"must specify a scalar prop for textures"),u("if(",U,"&&",U,'._reglType==="framebuffer"){',U,"=",U,".color[0];","}")):w===qr&&(m(!Array.isArray(U),"must specify a scalar prop for cube maps"),u("if(",U,"&&",U,'._reglType==="framebufferCube"){',U,"=",U,".color[0];","}")),m.optional(function(){function Rt(jt,To){h.assert(u,jt,'bad data or missing for uniform "'+l+'".  '+To)}function xa(jt){m(!Array.isArray(U),"must not specify an array type for uniform"),Rt("typeof "+U+'==="'+jt+'"',"invalid type, expected "+jt)}function kt(jt,To){Array.isArray(U)?m(U.length===jt,"must have length "+jt):Rt(E.isArrayLike+"("+U+")&&"+U+".length==="+jt,"invalid vector, should have length "+jt,h.commandStr)}function xo(jt){m(!Array.isArray(U),"must not specify a value type"),Rt("typeof "+U+'==="function"&&'+U+'._reglType==="texture'+(jt===io?"2d":"Cube")+'"',"invalid texture type",h.commandStr)}switch(w){case _a:xa("number");break;case bn:kt(2);break;case gn:kt(3);break;case En:kt(4);break;case ya:xa("number");break;case vn:kt(2);break;case yn:kt(3);break;case _n:kt(4);break;case ba:xa("boolean");break;case xn:kt(2);break;case Tn:kt(3);break;case An:kt(4);break;case jr:kt(4);break;case Vr:kt(9);break;case zr:kt(16);break;case Xr:xo(io);break;case qr:xo(yu);break}});var Ae=1;switch(w){case Xr:case qr:var Ce=u.def(U,"._texture");u(b,".uniform1i(",z,",",Ce,".bind());"),u.exit(Ce,".unbind();");continue;case _a:case ba:A="1i";break;case bn:case xn:A="2i",Ae=2;break;case gn:case Tn:A="3i",Ae=3;break;case En:case An:A="4i",Ae=4;break;case ya:A="1f";break;case vn:A="2f",Ae=2;break;case yn:A="3f",Ae=3;break;case _n:A="4f",Ae=4;break;case jr:A="Matrix2fv";break;case Vr:A="Matrix3fv";break;case zr:A="Matrix4fv";break}if(u(b,".uniform",A,"(",z,","),A.charAt(0)==="M"){var Ke=Math.pow(w-jr+2,2),nt=h.global.def("new Float32Array(",Ke,")");Array.isArray(U)?u("false,(",Lt(Ke,function(Rt){return nt+"["+Rt+"]="+U[Rt]}),",",nt,")"):u("false,(Array.isArray(",U,")||",U," instanceof Float32Array)?",U,":(",Lt(Ke,function(Rt){return nt+"["+Rt+"]="+U+"["+Rt+"]"}),",",nt,")")}else Ae>1?u(Lt(Ae,function(Rt){return Array.isArray(U)?U[Rt]:U+"["+Rt+"]"})):(m(!Array.isArray(U),"uniform value must not be an array"),u(U));u(");")}}function Te(h,u,_,R){var C=h.shared,E=C.gl,b=C.draw,A=R.draw;function d(){var Ce=A.elements,Ke,nt=u;return Ce?((Ce.contextDep&&R.contextDynamic||Ce.propDep)&&(nt=_),Ke=Ce.append(h,nt)):Ke=nt.def(b,".",sr),Ke&&nt("if("+Ke+")"+E+".bindBuffer("+mu+","+Ke+".buffer.buffer);"),Ke}function y(){var Ce=A.count,Ke,nt=u;return Ce?((Ce.contextDep&&R.contextDynamic||Ce.propDep)&&(nt=_),Ke=Ce.append(h,nt),m.optional(function(){Ce.MISSING&&h.assert(u,"false","missing vertex count"),Ce.DYNAMIC&&h.assert(nt,Ke+">=0","missing vertex count")})):(Ke=nt.def(b,".",ur),m.optional(function(){h.assert(nt,Ke+">=0","missing vertex count")})),Ke}var l=d();function w(Ce){var Ke=A[Ce];return Ke?Ke.contextDep&&R.contextDynamic||Ke.propDep?Ke.append(h,_):Ke.append(h,u):u.def(b,".",Ce)}var F=w(fr),j=w(mn),z=y();if(typeof z=="number"){if(z===0)return}else _("if(",z,"){"),_.exit("}");var U,ee;te&&(U=w(pn),ee=h.instancing);var be=l+".type",Ge=A.elements&&Zt(A.elements);function _e(){function Ce(){_(ee,".drawElementsInstancedANGLE(",[F,z,be,j+"<<(("+be+"-"+ki+")>>1)",U],");")}function Ke(){_(ee,".drawArraysInstancedANGLE(",[F,j,z,U],");")}l?Ge?Ce():(_("if(",l,"){"),Ce(),_("}else{"),Ke(),_("}")):Ke()}function Ae(){function Ce(){_(E+".drawElements("+[F,z,be,j+"<<(("+be+"-"+ki+")>>1)"]+");")}function Ke(){_(E+".drawArrays("+[F,j,z]+");")}l?Ge?Ce():(_("if(",l,"){"),Ce(),_("}else{"),Ke(),_("}")):Ke()}te&&(typeof U!="number"||U>=0)?typeof U=="string"?(_("if(",U,">0){"),_e(),_("}else if(",U,"<0){"),Ae(),_("}")):_e():Ae()}function Ue(h,u,_,R,C){var E=we(),b=E.proc("body",C);return m.optional(function(){E.commandStr=u.commandStr,E.command=E.link(u.commandStr)}),te&&(E.instancing=b.def(E.shared.extensions,".angle_instanced_arrays")),h(E,b,_,R),E.compile().body}function Xe(h,u,_,R){ot(h,u),_.useVAO?_.drawVAO?u(h.shared.vao,".setVAO(",_.drawVAO.append(h,u),");"):u(h.shared.vao,".setVAO(",h.shared.vao,".targetVAO);"):(u(h.shared.vao,".setVAO(null);"),At(h,u,_,R.attributes,function(){return!0})),Ze(h,u,_,R.uniforms,function(){return!0}),Te(h,u,u,_)}function st(h,u){var _=h.proc("draw",1);ot(h,_),mt(h,_,u.context),pt(h,_,u.framebuffer),yt(h,_,u),Tt(h,_,u.state),Ie(h,_,u,!1,!0);var R=u.shader.progVar.append(h,_);if(_(h.shared.gl,".useProgram(",R,".program);"),u.shader.program)Xe(h,_,u,u.shader.program);else{_(h.shared.vao,".setVAO(null);");var C=h.global.def("{}"),E=_.def(R,".id"),b=_.def(C,"[",E,"]");_(h.cond(b).then(b,".call(this,a0);").else(b,"=",C,"[",E,"]=",h.link(function(A){return Ue(Xe,h,u,A,1)}),"(",R,");",b,".call(this,a0);"))}Object.keys(u.state).length>0&&_(h.shared.current,".dirty=true;")}function Xt(h,u,_,R){h.batchId="a1",ot(h,u);function C(){return!0}At(h,u,_,R.attributes,C),Ze(h,u,_,R.uniforms,C),Te(h,u,u,_)}function lr(h,u,_,R){ot(h,u);var C=_.contextDep,E=u.def(),b="a0",A="a1",d=u.def();h.shared.props=d,h.batchId=E;var y=h.scope(),l=h.scope();u(y.entry,"for(",E,"=0;",E,"<",A,";++",E,"){",d,"=",b,"[",E,"];",l,"}",y.exit);function w(be){return be.contextDep&&C||be.propDep}function F(be){return!w(be)}if(_.needsContext&&mt(h,l,_.context),_.needsFramebuffer&&pt(h,l,_.framebuffer),Tt(h,l,_.state,w),_.profile&&w(_.profile)&&Ie(h,l,_,!1,!0),R)_.useVAO?_.drawVAO?w(_.drawVAO)?l(h.shared.vao,".setVAO(",_.drawVAO.append(h,l),");"):y(h.shared.vao,".setVAO(",_.drawVAO.append(h,y),");"):y(h.shared.vao,".setVAO(",h.shared.vao,".targetVAO);"):(y(h.shared.vao,".setVAO(null);"),At(h,y,_,R.attributes,F),At(h,l,_,R.attributes,w)),Ze(h,y,_,R.uniforms,F),Ze(h,l,_,R.uniforms,w),Te(h,y,l,_);else{var j=h.global.def("{}"),z=_.shader.progVar.append(h,l),U=l.def(z,".id"),ee=l.def(j,"[",U,"]");l(h.shared.gl,".useProgram(",z,".program);","if(!",ee,"){",ee,"=",j,"[",U,"]=",h.link(function(be){return Ue(Xt,h,_,be,2)}),"(",z,");}",ee,".call(this,a0[",E,"],",E,");")}}function p(h,u){var _=h.proc("batch",2);h.batchId="0",ot(h,_);var R=!1,C=!0;Object.keys(u.context).forEach(function(j){R=R||u.context[j].propDep}),R||(mt(h,_,u.context),C=!1);var E=u.framebuffer,b=!1;E?(E.propDep?R=b=!0:E.contextDep&&R&&(b=!0),b||pt(h,_,E)):pt(h,_,null),u.state.viewport&&u.state.viewport.propDep&&(R=!0);function A(j){return j.contextDep&&R||j.propDep}yt(h,_,u),Tt(h,_,u.state,function(j){return!A(j)}),(!u.profile||!A(u.profile))&&Ie(h,_,u,!1,"a1"),u.contextDep=R,u.needsContext=C,u.needsFramebuffer=b;var d=u.shader.progVar;if(d.contextDep&&R||d.propDep)lr(h,_,u,null);else{var y=d.append(h,_);if(_(h.shared.gl,".useProgram(",y,".program);"),u.shader.program)lr(h,_,u,u.shader.program);else{_(h.shared.vao,".setVAO(null);");var l=h.global.def("{}"),w=_.def(y,".id"),F=_.def(l,"[",w,"]");_(h.cond(F).then(F,".call(this,a0,a1);").else(F,"=",l,"[",w,"]=",h.link(function(j){return Ue(lr,h,u,j,2)}),"(",y,");",F,".call(this,a0,a1);"))}}Object.keys(u.state).length>0&&_(h.shared.current,".dirty=true;")}function $(h,u){var _=h.proc("scope",3);h.batchId="a2";var R=h.shared,C=R.current;mt(h,_,u.context),u.framebuffer&&u.framebuffer.append(h,_),po(Object.keys(u.state)).forEach(function(b){var A=u.state[b],d=A.append(h,_);it(d)?d.forEach(function(y,l){_.set(h.next[b],"["+l+"]",y)}):_.set(R.next,"."+b,d)}),Ie(h,_,u,!0,!0),[sr,mn,ur,pn,fr].forEach(function(b){var A=u.draw[b];A&&_.set(R.draw,"."+b,""+A.append(h,_))}),Object.keys(u.uniforms).forEach(function(b){var A=u.uniforms[b].append(h,_);Array.isArray(A)&&(A="["+A.join()+"]"),_.set(R.uniforms,"["+c.id(b)+"]",A)}),Object.keys(u.attributes).forEach(function(b){var A=u.attributes[b].append(h,_),d=h.scopeAttrib(b);Object.keys(new L).forEach(function(y){_.set(d,"."+y,A[y])})}),u.scopeVAO&&_.set(R.vao,".targetVAO",u.scopeVAO.append(h,_));function E(b){var A=u.shader[b];A&&_.set(R.shader,"."+b,A.append(h,_))}E(Br),E(Pr),Object.keys(u.state).length>0&&(_(C,".dirty=true;"),_.exit(C,".dirty=true;")),_("a1(",h.shared.context,",a0,",h.batchId,");")}function M(h){if(!(typeof h!="object"||it(h))){for(var u=Object.keys(h),_=0;_<u.length;++_)if(It.isDynamic(h[u[_]]))return!0;return!1}}function me(h,u,_){var R=u.static[_];if(!R||!M(R))return;var C=h.global,E=Object.keys(R),b=!1,A=!1,d=!1,y=h.global.def("{}");E.forEach(function(w){var F=R[w];if(It.isDynamic(F)){typeof F=="function"&&(F=R[w]=It.unbox(F));var j=Ct(F,null);b=b||j.thisDep,d=d||j.propDep,A=A||j.contextDep}else{switch(C(y,".",w,"="),typeof F){case"number":C(F);break;case"string":C('"',F,'"');break;case"object":Array.isArray(F)&&C("[",F.join(),"]");break;default:C(h.link(F));break}C(";")}});function l(w,F){E.forEach(function(j){var z=R[j];if(It.isDynamic(z)){var U=w.invoke(F,z);F(y,".",j,"=",U,";")}})}u.dynamic[_]=new It.DynamicVariable(hn,{thisDep:b,contextDep:A,propDep:d,ref:y,append:l}),delete u.static[_]}function Pe(h,u,_,R,C){var E=we();E.stats=E.link(C),Object.keys(u.static).forEach(function(A){me(E,u,A)}),du.forEach(function(A){me(E,h,A)});var b=ht(h,u,_,R,E);return st(E,b),$(E,b),p(E,b),o(E.compile(),{destroy:function(){b.shader.program.destroy()}})}return{next:de,current:W,procs:function(){var h=we(),u=h.proc("poll"),_=h.proc("refresh"),R=h.block();u(R),_(R);var C=h.shared,E=C.gl,b=C.next,A=C.current;R(A,".dirty=false;"),pt(h,u),pt(h,_,null,!0);var d;te&&(d=h.link(te)),v.oes_vertex_array_object&&_(h.link(v.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var y=0;y<N.maxAttributes;++y){var l=_.def(C.attributes,"[",y,"]"),w=h.cond(l,".buffer");w.then(E,".enableVertexAttribArray(",y,");",E,".bindBuffer(",Sr,",",l,".buffer.buffer);",E,".vertexAttribPointer(",y,",",l,".size,",l,".type,",l,".normalized,",l,".stride,",l,".offset);").else(E,".disableVertexAttribArray(",y,");",E,".vertexAttrib4f(",y,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;"),_(w),te&&_(d,".vertexAttribDivisorANGLE(",y,",",l,".divisor);")}return _(h.shared.vao,".currentVAO=null;",h.shared.vao,".setVAO(",h.shared.vao,".targetVAO);"),Object.keys(se).forEach(function(F){var j=se[F],z=R.def(b,".",F),U=h.block();U("if(",z,"){",E,".enable(",j,")}else{",E,".disable(",j,")}",A,".",F,"=",z,";"),_(U),u("if(",z,"!==",A,".",F,"){",U,"}")}),Object.keys(H).forEach(function(F){var j=H[F],z=W[F],U,ee,be=h.block();if(be(E,".",j,"("),it(z)){var Ge=z.length;U=h.global.def(b,".",F),ee=h.global.def(A,".",F),be(Lt(Ge,function(_e){return U+"["+_e+"]"}),");",Lt(Ge,function(_e){return ee+"["+_e+"]="+U+"["+_e+"];"}).join("")),u("if(",Lt(Ge,function(_e){return U+"["+_e+"]!=="+ee+"["+_e+"]"}).join("||"),"){",be,"}")}else U=R.def(b,".",F),ee=R.def(A,".",F),be(U,");",A,".",F,"=",U,";"),u("if(",U,"!==",ee,"){",be,"}");_(be)}),h.compile()}(),compile:Pe}}function Du(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Iu=34918,Gu=34919,yo=35007,Nu=function(n,c){if(!c.ext_disjoint_timer_query)return null;var v=[];function N(){return v.pop()||c.ext_disjoint_timer_query.createQueryEXT()}function V(te){v.push(te)}var I=[];function k(te){var he=N();c.ext_disjoint_timer_query.beginQueryEXT(yo,he),I.push(he),Q(I.length-1,I.length,te)}function K(){c.ext_disjoint_timer_query.endQueryEXT(yo)}function Z(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var re=[];function J(){return re.pop()||new Z}function ie(te){re.push(te)}var ue=[];function Q(te,he,W){var de=J();de.startQueryIndex=te,de.endQueryIndex=he,de.sum=0,de.stats=W,ue.push(de)}var oe=[],L=[];function B(){var te,he,W=I.length;if(W!==0){L.length=Math.max(L.length,W+1),oe.length=Math.max(oe.length,W+1),oe[0]=0,L[0]=0;var de=0;for(te=0,he=0;he<I.length;++he){var Y=I[he];c.ext_disjoint_timer_query.getQueryObjectEXT(Y,Gu)?(de+=c.ext_disjoint_timer_query.getQueryObjectEXT(Y,Iu),V(Y)):I[te++]=Y,oe[he+1]=de,L[he+1]=te}for(I.length=te,te=0,he=0;he<ue.length;++he){var se=ue[he],H=se.startQueryIndex,fe=se.endQueryIndex;se.sum+=oe[fe]-oe[H];var Ee=L[H],Re=L[fe];Re===Ee?(se.stats.gpuTime+=se.sum/1e6,ie(se)):(se.startQueryIndex=Ee,se.endQueryIndex=Re,ue[te++]=se)}ue.length=te}}return{beginQuery:k,endQuery:K,pushScopeStats:Q,update:B,getNumPendingQueries:function(){return I.length},clear:function(){v.push.apply(v,I);for(var te=0;te<v.length;te++)c.ext_disjoint_timer_query.deleteQueryEXT(v[te]);I.length=0,v.length=0},restore:function(){I.length=0,v.length=0}}},$u=16384,ku=256,Bu=1024,Pu=34962,_o="webglcontextlost",bo="webglcontextrestored",go=1,Uu=2,ju=3;function Eo(n,c){for(var v=0;v<n.length;++v)if(n[v]===c)return v;return-1}function Vu(n){var c=ko(n);if(!c)return null;var v=c.gl,N=v.getContextAttributes(),V=v.isContextLost(),I=Bo(v,c);if(!I)return null;var k=Do(),K=Du(),Z=I.extensions,re=Nu(v,Z),J=La(),ie=v.drawingBufferWidth,ue=v.drawingBufferHeight,Q={tick:0,time:0,viewportWidth:ie,viewportHeight:ue,framebufferWidth:ie,framebufferHeight:ue,drawingBufferWidth:ie,drawingBufferHeight:ue,pixelRatio:c.pixelRatio},oe={},L={elements:null,primitive:4,count:-1,offset:0,instances:-1},B=Ss(v,Z),te=js(v,K,c,W),he=ru(v,Z,B,K,te);function W(Te){return he.destroyBuffer(Te)}var de=tf(v,Z,te,K),Y=ou(v,k,K,c),se=Df(v,Z,B,function(){Ee.procs.poll()},Q,K,c),H=If(v,Z,B,K,c),fe=eu(v,Z,B,se,H,K),Ee=Mu(v,k,Z,B,te,de,se,fe,oe,he,Y,L,Q,re,c),Re=uu(v,fe,Ee.procs.poll,Q,N,Z,B),ce=Ee.next,ne=v.canvas,X=[],we=[],De=[],ye=[c.onDestroy],Be=null;function Le(){if(X.length===0){re&&re.update(),Be=null;return}Be=Rn.next(Le),Tt();for(var Te=X.length-1;Te>=0;--Te){var Ue=X[Te];Ue&&Ue(Q,null,0)}v.flush(),re&&re.update()}function ke(){!Be&&X.length>0&&(Be=Rn.next(Le))}function Ye(){Be&&(Rn.cancel(Le),Be=null)}function lt(Te){Te.preventDefault(),V=!0,Ye(),we.forEach(function(Ue){Ue()})}function vt(Te){v.getError(),V=!1,I.restore(),Y.restore(),te.restore(),se.restore(),H.restore(),fe.restore(),he.restore(),re&&re.restore(),Ee.procs.refresh(),ke(),De.forEach(function(Ue){Ue()})}ne&&(ne.addEventListener(_o,lt,!1),ne.addEventListener(bo,vt,!1));function je(){X.length=0,Ye(),ne&&(ne.removeEventListener(_o,lt),ne.removeEventListener(bo,vt)),Y.clear(),fe.clear(),H.clear(),se.clear(),de.clear(),te.clear(),he.clear(),re&&re.clear(),ye.forEach(function(Te){Te()})}function dt(Te){m(!!Te,"invalid args to regl({...})"),m.type(Te,"object","invalid args to regl({...})");function Ue(C){var E=o({},C);delete E.uniforms,delete E.attributes,delete E.context,delete E.vao,"stencil"in E&&E.stencil.op&&(E.stencil.opBack=E.stencil.opFront=E.stencil.op,delete E.stencil.op);function b(A){if(A in E){var d=E[A];delete E[A],Object.keys(d).forEach(function(y){E[A+"."+y]=d[y]})}}return b("blend"),b("depth"),b("cull"),b("stencil"),b("polygonOffset"),b("scissor"),b("sample"),"vao"in C&&(E.vao=C.vao),E}function Xe(C,E){var b={},A={};return Object.keys(C).forEach(function(d){var y=C[d];if(It.isDynamic(y)){A[d]=It.unbox(y,d);return}else if(E&&Array.isArray(y)){for(var l=0;l<y.length;++l)if(It.isDynamic(y[l])){A[d]=It.unbox(y,d);return}}b[d]=y}),{dynamic:A,static:b}}var st=Xe(Te.context||{},!0),Xt=Xe(Te.uniforms||{},!0),lr=Xe(Te.attributes||{},!1),p=Xe(Ue(Te),!1),$={gpuTime:0,cpuTime:0,count:0},M=Ee.compile(p,lr,Xt,st,$),me=M.draw,Pe=M.batch,h=M.scope,u=[];function _(C){for(;u.length<C;)u.push(null);return u}function R(C,E){var b;if(V&&m.raise("context lost"),typeof C=="function")return h.call(this,null,C,0);if(typeof E=="function")if(typeof C=="number")for(b=0;b<C;++b)h.call(this,null,E,b);else if(Array.isArray(C))for(b=0;b<C.length;++b)h.call(this,C[b],E,b);else return h.call(this,C,E,0);else if(typeof C=="number"){if(C>0)return Pe.call(this,_(C|0),C|0)}else if(Array.isArray(C)){if(C.length)return Pe.call(this,C,C.length)}else return me.call(this,C)}return o(R,{stats:$,destroy:function(){M.destroy()}})}var rt=fe.setFBO=dt({framebuffer:It.define.call(null,go,"framebuffer")});function ht(Te,Ue){var Xe=0;Ee.procs.poll();var st=Ue.color;st&&(v.clearColor(+st[0]||0,+st[1]||0,+st[2]||0,+st[3]||0),Xe|=$u),"depth"in Ue&&(v.clearDepth(+Ue.depth),Xe|=ku),"stencil"in Ue&&(v.clearStencil(Ue.stencil|0),Xe|=Bu),m(!!Xe,"called regl.clear with no buffer specified"),v.clear(Xe)}function mt(Te){if(m(typeof Te=="object"&&Te,"regl.clear() takes an object as input"),"framebuffer"in Te)if(Te.framebuffer&&Te.framebuffer_reglType==="framebufferCube")for(var Ue=0;Ue<6;++Ue)rt(o({framebuffer:Te.framebuffer.faces[Ue]},Te),ht);else rt(Te,ht);else ht(null,Te)}function pt(Te){m.type(Te,"function","regl.frame() callback must be a function"),X.push(Te);function Ue(){var Xe=Eo(X,Te);m(Xe>=0,"cannot cancel a frame twice");function st(){var Xt=Eo(X,st);X[Xt]=X[X.length-1],X.length-=1,X.length<=0&&Ye()}X[Xe]=st}return ke(),{cancel:Ue}}function yt(){var Te=ce.viewport,Ue=ce.scissor_box;Te[0]=Te[1]=Ue[0]=Ue[1]=0,Q.viewportWidth=Q.framebufferWidth=Q.drawingBufferWidth=Te[2]=Ue[2]=v.drawingBufferWidth,Q.viewportHeight=Q.framebufferHeight=Q.drawingBufferHeight=Te[3]=Ue[3]=v.drawingBufferHeight}function Tt(){Q.tick+=1,Q.time=Ie(),yt(),Ee.procs.poll()}function ot(){se.refresh(),yt(),Ee.procs.refresh(),re&&re.update()}function Ie(){return(La()-J)/1e3}ot();function At(Te,Ue){m.type(Ue,"function","listener callback must be a function");var Xe;switch(Te){case"frame":return pt(Ue);case"lost":Xe=we;break;case"restore":Xe=De;break;case"destroy":Xe=ye;break;default:m.raise("invalid event, must be one of frame,lost,restore,destroy")}return Xe.push(Ue),{cancel:function(){for(var st=0;st<Xe.length;++st)if(Xe[st]===Ue){Xe[st]=Xe[Xe.length-1],Xe.pop();return}}}}var Ze=o(dt,{clear:mt,prop:It.define.bind(null,go),context:It.define.bind(null,Uu),this:It.define.bind(null,ju),draw:dt({}),buffer:function(Te){return te.create(Te,Pu,!1,!1)},elements:function(Te){return de.create(Te,!1)},texture:se.create2D,cube:se.createCube,renderbuffer:H.create,framebuffer:fe.create,framebufferCube:fe.createCube,vao:he.createVAO,attributes:N,frame:pt,on:At,limits:B,hasExtension:function(Te){return B.extensions.indexOf(Te.toLowerCase())>=0},read:Re,destroy:je,_gl:v,_refresh:ot,poll:function(){Tt(),re&&re.update()},now:Ie,stats:K});return c.onDone(null,Ze),Ze}return Vu})})(regl$1);var reglExports=regl$1.exports;const regl=getDefaultExportFromCjs(reglExports),Mouse=mouseListen();class HydraRenderer{constructor({pb:t=null,width:r=1280,height:o=720,numSources:s=4,numOutputs:f=4,makeGlobal:g=!0,autoLoop:S=!0,detectAudio:P=!0,enableStreamCapture:G=!0,canvas:le,precision:pe,extendTransforms:Se={}}={}){if(ArrayUtils.init(),this.pb=t,this.width=r,this.height=o,this.renderAll=!1,this.detectAudio=P,this._initCanvas(le),global.window.test="hi",this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:Mouse,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update:Ne=>{},hush:this.hush.bind(this),tick:this.tick.bind(this)},g&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,pe&&["lowp","mediump","highp"].includes(pe.toLowerCase()))this.precision=pe.toLowerCase();else{let Ne=(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=Ne?"highp":"mediump"}if(this.extendTransforms=Se,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(f),this._initSources(s),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},G)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new VideoRecorder(this.captureStream)}catch(Ne){console.warn(`[hydra-synth warning]
new MediaSource() is not currently supported on iOS.`),console.error(Ne)}P&&this._initAudio(),S&&loop(this.tick.bind(this)).start(),this.sandbox=new EvalSandbox(this.synth,g,["speed","update","bpm","fps"])}eval(t){this.sandbox.eval(t)}getScreenImage(t){this.imageCallback=t,this.saveFrame=!0}hush(){this.s.forEach(t=>{t.clear()}),this.o.forEach(t=>{this.synth.solid(0,0,0,0).out(t)}),this.synth.render(this.o[0]),this.sandbox.set("update",t=>{})}loadScript(t=""){return new Promise((o,s)=>{var f=document.createElement("script");f.onload=function(){console.log(`loaded script ${t}`),o()},f.onerror=g=>{console.log(`error loading script ${t}`,"log-error"),o()},f.src=t,document.head.appendChild(f)})}setResolution(t,r){this.canvas.width=t,this.canvas.height=r,this.width=t,this.height=r,this.sandbox.set("width",t),this.sandbox.set("height",r),console.log(this.width),this.o.forEach(o=>{o.resize(t,r)}),this.s.forEach(o=>{o.resize(t,r)}),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(t){const r=document.createElement("a");r.style.display="none";let o=new Date;r.download=`hydra-${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}-${o.getHours()}.${o.getMinutes()}.${o.getSeconds()}.png`,document.body.appendChild(r);var s=this;this.canvas.toBlob(f=>{s.imageCallback?(s.imageCallback(f),delete s.imageCallback):(r.href=URL.createObjectURL(f),console.log(r.href),r.click())},"image/png"),setTimeout(()=>{document.body.removeChild(r),window.URL.revokeObjectURL(r.href)},300)}_initAudio(){this.synth.a=new Audio({numBins:4,parentEl:this.canvas.parentNode})}_initCanvas(t){t?(this.canvas=t,this.width=t.width,this.height=t.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=regl({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(t){const r=this;this.o=Array(t).fill().map((o,s)=>{var f=new Output({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${s}`});return f.id=s,r.synth["o"+s]=f,f}),this.output=this.o[0]}_initSources(t){this.s=[];for(var r=0;r<t;r++)this.createSource(r)}createSource(t){let r=new HydraSource({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${t}`});return this.synth["s"+this.s.length]=r,this.s.push(r),r}_generateGlslTransforms(){var t=this;this.generator=new GeneratorFactory({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({type:r,method:o,synth:s})=>{r==="add"&&(t.synth[o]=s.generators[o],t.sandbox&&t.sandbox.add(o))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(t){t?(this.output=t,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(t,r){if(this.sandbox.tick(),this.detectAudio===!0&&this.synth.a.tick(),this.sandbox.set("time",this.synth.time+=t*.001*this.synth.speed),this.timeSinceLastUpdate+=t,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(o){console.log(o)}for(let o=0;o<this.s.length;o++)this.s[o].tick(this.synth.time);for(let o=0;o<this.o.length;o++)this.o[o].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}this.saveFrame===!0&&(this.canvasToImage(),this.saveFrame=!1)}}const mainCss$1=css`
position: absolute;
top: 0px;
left: 0px;
width: 100%;
height: 100%;
canvas {
  width: 100%;
  height: 100%;
}
`;class Map extends Component{constructor(t,r,o){super(t),this.local=r.components[t]={},this.state=r}load(t){console.log("loading hydra",t,this.canvas);const r=t.querySelector("canvas");r.width=400,r.height=400,this.state.hydra==null&&(this.state.hydra=new HydraRenderer({canvas:r,detectAudio:!1,width:r.width,height:r.height}))}update(){return!1}createElement(t){return html$1`
      <div class="hydra-holder ${mainCss$1}">
        <canvas class="hydra-canvas"></canvas>
      </div>
    `}}const mainCss=css`
  width: 100%;
  height: 100vh;

  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  justify-content: center;
  align-items: center;
  align-content: center;
  div.msg {
    color: pink;
    background-color: white;
    font-size: 1.3em;
    border: solid black;
    text-align: center;
    padding: 5px;
    &:hover {
      background-color: lightgrey;
      color: black;
    }
  }
  .hydra-holder {
    z-index: -1;
  }
`;function main(e,t){let r=e.hover?"hello beautiful people":"hover over me";return html$1`
    <div class=${mainCss}>
      <div class="msg" onmouseover=${o} onmouseout=${s}>
        ${r}
      </div>
      ${e.cache(Map,"my-hydra").render(e,t)}
    </div>
  `;function o(f){src(o0).modulate(osc(6,0,1.5).brightness(-.5).modulate(noise(3).sub(gradient()),1),.01).out(),e.hover=!0,t("render")}function s(f){osc(30,.1,1.5).out(),e.hover=!1,t("render")}}const app=choo$1({hash:!0});app.route("/*",notFound);function notFound(){return html$1`
    <div>
      <a href="/">
        404 with love ❤ back to top!
      </a>
    </div>
  `}app.route("/",main);app.mount("#choomount");app.emitter.on("DOMContentLoaded",()=>{osc(30,.1,1.5).out()});
